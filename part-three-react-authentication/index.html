<!DOCTYPE html>
<html>

  <head>
  
    <title>Microservices with Docker, Flask, and React - React Authentication</title>
  
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <link
    rel="stylesheet" href="//cdnjs.cloudflare.com/ajax/libs/materialize/0.97.3/css/materialize.min.css"
  >
  <link
    rel="stylesheet"
    href="https://fonts.googleapis.com/icon?family=Material+Icons"
  >
  <link
    rel="stylesheet"
    href="//maxcdn.bootstrapcdn.com/font-awesome/4.7.0/css/font-awesome.min.css"
  >
  <link
    href="//fonts.googleapis.com/css?family=Merriweather:900,900italic,300,300italic"
    rel="stylesheet"
    type="text/css"
  >
  <link
    href="//fonts.googleapis.com/css?family=Lato:900,300"
    rel="stylesheet"
    type="text/css"
  >
  <link
    href="//cdn-images.mailchimp.com/embedcode/classic-10_7.css"
    rel="stylesheet"
    type="text/css"
  >
  <link href="/assets/css/styles.css" rel="stylesheet">
  <script
    src="//code.jquery.com/jquery-2.2.4.min.js"
    integrity="sha256-BbhdlvQf/xTY9gja0Dq3HiwQF8LaCRTXxZKRutelT44="
    crossorigin="anonymous"
  ></script>
  <script
    type="text/javascript"
    src="/assets/js/main.js"
  ></script>
</head>


  <body>

    <nav class="red darken-1">
  <div class="nav-wrapper">
    <a href="/" class="brand-logo center hide-on-small-and-down">
      Test Driven Development Courses
    </a>
    <a href="/" class="brand-logo hide-on-med-and-up">
      TDD Courses
    </a>
    <ul class="right">
      <li class="hide-on-med-and-down">
        <a  href="/course-contents">Contents</a>
      </li>
      <li class="hide-on-large-only">
        <a href="/course-contents">TOC</a>
      </li>
    </ul>
  </div>
</nav>


    <br>

    <div class="container">
      <div class="row">

        <div class="col m3 hide-on-small-and-down">
  <br>
  <div id="toc-block" class="collection hide-on-small-and-down">
    <ul class="collapsible collapsible-accordion">
      
        
          <li>
            <h5 data-part="1" class="collapsible-header  waves-effect waves-teal">
              Part 1
            </h5>
            <div class="collapsible-body">
        
        <ul>
          <li>
            <a
              class="collection-item"
              href="/part-one-intro"
            >Introduction</a>
          </li>
        </ul>
      
        
        <ul>
          <li>
            <a
              class="collection-item"
              href="/part-one-getting-started"
            >Getting Started</a>
          </li>
        </ul>
      
        
        <ul>
          <li>
            <a
              class="collection-item"
              href="/part-one-docker-config"
            >Docker Config</a>
          </li>
        </ul>
      
        
        <ul>
          <li>
            <a
              class="collection-item"
              href="/part-one-postgres-setup"
            >Postgres Setup</a>
          </li>
        </ul>
      
        
        <ul>
          <li>
            <a
              class="collection-item"
              href="/part-one-test-setup"
            >Test Setup</a>
          </li>
        </ul>
      
        
        <ul>
          <li>
            <a
              class="collection-item"
              href="/part-one-flask-blueprints"
            >Flask Blueprints</a>
          </li>
        </ul>
      
        
        <ul>
          <li>
            <a
              class="collection-item"
              href="/part-one-restful-routes"
            >RESTful Routes</a>
          </li>
        </ul>
      
        
        <ul>
          <li>
            <a
              class="collection-item"
              href="/part-one-aws-deployment"
            >Deployment</a>
          </li>
        </ul>
      
        
        <ul>
          <li>
            <a
              class="collection-item"
              href="/part-one-jinja-templates"
            >Jinja Templates</a>
          </li>
        </ul>
      
        
        <ul>
          <li>
            <a
              class="collection-item"
              href="/part-one-workflow"
            >Workflow</a>
          </li>
        </ul>
      
        
          <li>
            <h5 data-part="2" class="collapsible-header  waves-effect waves-teal">
              Part 2
            </h5>
            <div class="collapsible-body">
        
        <ul>
          <li>
            <a
              class="collection-item"
              href="/part-two-intro"
            >Introduction</a>
          </li>
        </ul>
      
        
        <ul>
          <li>
            <a
              class="collection-item"
              href="/part-two-project-refactor"
            >Project Refactor</a>
          </li>
        </ul>
      
        
        <ul>
          <li>
            <a
              class="collection-item"
              href="/part-two-code-coverage"
            >Code Coverage</a>
          </li>
        </ul>
      
        
        <ul>
          <li>
            <a
              class="collection-item"
              href="/part-two-continuous-integration"
            >Continuous Integration</a>
          </li>
        </ul>
      
        
        <ul>
          <li>
            <a
              class="collection-item"
              href="/part-two-react-setup"
            >React Setup</a>
          </li>
        </ul>
      
        
        <ul>
          <li>
            <a
              class="collection-item"
              href="/part-two-flask-deployment"
            >Flask Deployment</a>
          </li>
        </ul>
      
        
        <ul>
          <li>
            <a
              class="collection-item"
              href="/part-two-react-forms"
            >React Forms</a>
          </li>
        </ul>
      
        
        <ul>
          <li>
            <a
              class="collection-item"
              href="/part-two-react-docker"
            >React and Docker</a>
          </li>
        </ul>
      
        
        <ul>
          <li>
            <a
              class="collection-item"
              href="/part-two-flask-refactor"
            >Flask Refactor</a>
          </li>
        </ul>
      
        
          <li>
            <h5 data-part="3" class="collapsible-header  waves-effect waves-teal">
              Part 3
            </h5>
            <div class="collapsible-body">
        
        <ul>
          <li>
            <a
              class="collection-item"
              href="/part-three-intro"
            >Introduction</a>
          </li>
        </ul>
      
        
        <ul>
          <li>
            <a
              class="collection-item"
              href="/part-three-flask-migrate"
            >Flask Migrate</a>
          </li>
        </ul>
      
        
        <ul>
          <li>
            <a
              class="collection-item"
              href="/part-three-flask-bcrypt"
            >Flask Bcrypt</a>
          </li>
        </ul>
      
        
        <ul>
          <li>
            <a
              class="collection-item"
              href="/part-three-jwt-setup"
            >JWT Setup</a>
          </li>
        </ul>
      
        
        <ul>
          <li>
            <a
              class="collection-item"
              href="/part-three-auth-routes"
            >Auth Routes</a>
          </li>
        </ul>
      
        
        <ul>
          <li>
            <a
              class="collection-item"
              href="/part-three-react-router"
            >React Router</a>
          </li>
        </ul>
      
        
        <ul>
          <li>
            <a
              class="collection-item"
              href="/part-three-react-bootstrap"
            >React Bootstrap</a>
          </li>
        </ul>
      
        
        <ul>
          <li>
            <a
              class="collection-item"
              href="/part-three-react-authentication"
            >React Authentication</a>
          </li>
        </ul>
      
        
        <ul>
          <li>
            <a
              class="collection-item"
              href="/part-three-authorization"
            >Authorization</a>
          </li>
        </ul>
      
        
        <ul>
          <li>
            <a
              class="collection-item"
              href="/part-three-update-component"
            >Update Component</a>
          </li>
        </ul>
      
        
        <ul>
          <li>
            <a
              class="collection-item"
              href="/part-three-update-docker"
            >Update Docker</a>
          </li>
        </ul>
      
        
          <li>
            <h5 data-part="4" class="collapsible-header  waves-effect waves-teal">
              Part 4
            </h5>
            <div class="collapsible-body">
        
        <ul>
          <li>
            <a
              class="collection-item"
              href="/part-four-intro"
            >Introduction</a>
          </li>
        </ul>
      
        
        <ul>
          <li>
            <a
              class="collection-item"
              href="/part-four-e2e-test-setup"
            >End-to-End Test Setup</a>
          </li>
        </ul>
      
        
        <ul>
          <li>
            <a
              class="collection-item"
              href="/part-four-e2e-test-specs"
            >e2e Test Specs</a>
          </li>
        </ul>
      
        
        <ul>
          <li>
            <a
              class="collection-item"
              href="/part-four-react-component-refactor"
            >React Component Refactor</a>
          </li>
        </ul>
      
        
        <ul>
          <li>
            <a
              class="collection-item"
              href="/part-four-react-form-validation"
            >React Form Validation</a>
          </li>
        </ul>
      
        
        <ul>
          <li>
            <a
              class="collection-item"
              href="/part-four-react-flash-messages"
            >React Flash Messaging</a>
          </li>
        </ul>
      
        
        <ul>
          <li>
            <a
              class="collection-item"
              href="/part-four-staging-environment"
            >Staging Environment</a>
          </li>
        </ul>
      
        
          <li>
            <h5 data-part="5" class="collapsible-header  waves-effect waves-teal">
              Part 5
            </h5>
            <div class="collapsible-body">
        
        <ul>
          <li>
            <a
              class="collection-item"
              href="/part-five-intro"
            >Introduction</a>
          </li>
        </ul>
      
    </div>
  </li>
    </ul>
  </div>
</div>


        <div class="col m9 hide-on-small-and-down">

          <h2>React Authentication</h2>

          <p>Let&#39;s add some methods to handle a user signing up, logging in, and logging out...</p>

<hr>

<p>With the <code>Form</code> component set up, we can now configure the methods to:</p>

<ol>
<li>Handle form submit event</li>
<li>Obtain user input</li>
<li>Send AJAX request</li>
<li>Update the page</li>
</ol>

<blockquote>
<p>These steps should look familiar since we already went through this process in the <a href="/part-two-react-forms/">React Forms</a> lesson. Put yourself to test and implement the code yourself before going through this lesson.</p>
</blockquote>

<h4 id="handle-form-submit-event">Handle form submit event</h4>

<p>Turn to <em>Form.jsx</em>. Which method gets fired on the form submit?</p>
<div class="highlight"><pre><code class="language-javascript" data-lang="javascript"><span class="o">&lt;</span><span class="nx">form</span> <span class="nx">onSubmit</span><span class="o">=</span><span class="p">{</span> <span class="p">(</span><span class="nx">event</span><span class="p">)</span> <span class="o">=&gt;</span> <span class="nx">props</span><span class="p">.</span><span class="nx">handleUserFormSubmit</span><span class="p">(</span><span class="nx">event</span><span class="p">)</span> <span class="p">}</span><span class="o">&gt;</span>
</code></pre></div>
<p>Add the method to the <code>App</code> component:</p>
<div class="highlight"><pre><code class="language-javascript" data-lang="javascript"><span class="nx">handleUserFormSubmit</span><span class="p">(</span><span class="nx">event</span><span class="p">)</span> <span class="p">{</span>
  <span class="nx">event</span><span class="p">.</span><span class="nx">preventDefault</span><span class="p">();</span>
  <span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="s1">&#39;sanity check!&#39;</span><span class="p">)</span>
<span class="p">}</span>
</code></pre></div>
<p>And then pass it down via the <code>props</code>:</p>
<div class="highlight"><pre><code class="language-javascript" data-lang="javascript"><span class="o">&lt;</span><span class="nx">Route</span> <span class="nx">exact</span> <span class="nx">path</span><span class="o">=</span><span class="s1">&#39;/register&#39;</span> <span class="nx">render</span><span class="o">=</span><span class="p">{()</span> <span class="o">=&gt;</span> <span class="p">(</span>
  <span class="o">&lt;</span><span class="nx">Form</span>
    <span class="nx">formType</span><span class="o">=</span><span class="p">{</span><span class="s1">&#39;Register&#39;</span><span class="p">}</span>
    <span class="nx">formData</span><span class="o">=</span><span class="p">{</span><span class="k">this</span><span class="p">.</span><span class="nx">state</span><span class="p">.</span><span class="nx">formData</span><span class="p">}</span>
    <span class="nx">handleUserFormSubmit</span><span class="o">=</span><span class="p">{</span><span class="k">this</span><span class="p">.</span><span class="nx">handleUserFormSubmit</span><span class="p">.</span><span class="nx">bind</span><span class="p">(</span><span class="k">this</span><span class="p">)}</span>
  <span class="o">/&gt;</span>
<span class="p">)}</span> <span class="o">/&gt;</span>
<span class="o">&lt;</span><span class="nx">Route</span> <span class="nx">exact</span> <span class="nx">path</span><span class="o">=</span><span class="s1">&#39;/login&#39;</span> <span class="nx">render</span><span class="o">=</span><span class="p">{()</span> <span class="o">=&gt;</span> <span class="p">(</span>
  <span class="o">&lt;</span><span class="nx">Form</span>
    <span class="nx">formType</span><span class="o">=</span><span class="p">{</span><span class="s1">&#39;Login&#39;</span><span class="p">}</span>
    <span class="nx">formData</span><span class="o">=</span><span class="p">{</span><span class="k">this</span><span class="p">.</span><span class="nx">state</span><span class="p">.</span><span class="nx">formData</span><span class="p">}</span>
    <span class="nx">handleUserFormSubmit</span><span class="o">=</span><span class="p">{</span><span class="k">this</span><span class="p">.</span><span class="nx">handleUserFormSubmit</span><span class="p">.</span><span class="nx">bind</span><span class="p">(</span><span class="k">this</span><span class="p">)}</span>
  <span class="o">/&gt;</span>
<span class="p">)}</span> <span class="o">/&gt;</span>
</code></pre></div>
<p>Test it out in the browser. You should see <code>sanity check!</code> in the JavaScript console on form submit for both forms. Remove the <code>console.log(&#39;sanity check!&#39;)</code> when done.</p>

<h4 id="obtain-user-input">Obtain user input</h4>

<p>Next, to get the user inputs, add the following method to <code>App</code>:</p>
<div class="highlight"><pre><code class="language-javascript" data-lang="javascript"><span class="nx">handleFormChange</span><span class="p">(</span><span class="nx">event</span><span class="p">)</span> <span class="p">{</span>
  <span class="kr">const</span> <span class="nx">obj</span> <span class="o">=</span> <span class="k">this</span><span class="p">.</span><span class="nx">state</span><span class="p">.</span><span class="nx">formData</span><span class="p">;</span>
  <span class="nx">obj</span><span class="p">[</span><span class="nx">event</span><span class="p">.</span><span class="nx">target</span><span class="p">.</span><span class="nx">name</span><span class="p">]</span> <span class="o">=</span> <span class="nx">event</span><span class="p">.</span><span class="nx">target</span><span class="p">.</span><span class="nx">value</span><span class="p">;</span>
  <span class="k">this</span><span class="p">.</span><span class="nx">setState</span><span class="p">(</span><span class="nx">obj</span><span class="p">);</span>
<span class="p">}</span>
</code></pre></div>
<p>Pass it down on the <code>props</code>:</p>
<div class="highlight"><pre><code class="language-javascript" data-lang="javascript"><span class="nx">handleFormChange</span><span class="o">=</span><span class="p">{</span><span class="k">this</span><span class="p">.</span><span class="nx">handleFormChange</span><span class="p">.</span><span class="nx">bind</span><span class="p">(</span><span class="k">this</span><span class="p">)}</span>
</code></pre></div>
<p>Add a <code>console.log()</code> to the method - <code>console.log(this.state.formData);</code> - to ensure it works when you test it in the browser. Remove it once done.</p>

<p>What&#39;s next? AJAX!</p>

<h4 id="send-ajax-request">Send AJAX request</h4>

<p>Update the <code>handleUserFormSubmit</code> method to send the data to the user service on a successful form submit:</p>
<div class="highlight"><pre><code class="language-javascript" data-lang="javascript"><span class="nx">handleUserFormSubmit</span><span class="p">(</span><span class="nx">event</span><span class="p">)</span> <span class="p">{</span>
  <span class="nx">event</span><span class="p">.</span><span class="nx">preventDefault</span><span class="p">();</span>
  <span class="kr">const</span> <span class="nx">formType</span> <span class="o">=</span> <span class="nb">window</span><span class="p">.</span><span class="nx">location</span><span class="p">.</span><span class="nx">href</span><span class="p">.</span><span class="nx">split</span><span class="p">(</span><span class="s1">&#39;/&#39;</span><span class="p">).</span><span class="nx">reverse</span><span class="p">()[</span><span class="mi">0</span><span class="p">];</span>
  <span class="kd">let</span> <span class="nx">data</span><span class="p">;</span>
  <span class="k">if</span> <span class="p">(</span><span class="nx">formType</span> <span class="o">===</span> <span class="s1">&#39;login&#39;</span><span class="p">)</span> <span class="p">{</span>
    <span class="nx">data</span> <span class="o">=</span> <span class="p">{</span>
      <span class="nx">email</span><span class="o">:</span> <span class="k">this</span><span class="p">.</span><span class="nx">state</span><span class="p">.</span><span class="nx">formData</span><span class="p">.</span><span class="nx">email</span><span class="p">,</span>
      <span class="nx">password</span><span class="o">:</span> <span class="k">this</span><span class="p">.</span><span class="nx">state</span><span class="p">.</span><span class="nx">formData</span><span class="p">.</span><span class="nx">password</span>
    <span class="p">}</span>
  <span class="p">}</span>
  <span class="k">if</span> <span class="p">(</span><span class="nx">formType</span> <span class="o">===</span> <span class="s1">&#39;register&#39;</span><span class="p">)</span> <span class="p">{</span>
    <span class="nx">data</span> <span class="o">=</span> <span class="p">{</span>
      <span class="nx">username</span><span class="o">:</span> <span class="k">this</span><span class="p">.</span><span class="nx">state</span><span class="p">.</span><span class="nx">formData</span><span class="p">.</span><span class="nx">email</span><span class="p">,</span>
      <span class="nx">email</span><span class="o">:</span> <span class="k">this</span><span class="p">.</span><span class="nx">state</span><span class="p">.</span><span class="nx">formData</span><span class="p">.</span><span class="nx">email</span><span class="p">,</span>
      <span class="nx">password</span><span class="o">:</span> <span class="k">this</span><span class="p">.</span><span class="nx">state</span><span class="p">.</span><span class="nx">formData</span><span class="p">.</span><span class="nx">password</span>
    <span class="p">}</span>
  <span class="p">}</span>
  <span class="kr">const</span> <span class="nx">url</span> <span class="o">=</span> <span class="err">`</span><span class="nx">$</span><span class="p">{</span><span class="nx">process</span><span class="p">.</span><span class="nx">env</span><span class="p">.</span><span class="nx">REACT_APP_USERS_SERVICE_URL</span><span class="p">}</span><span class="o">/</span><span class="nx">auth</span><span class="o">/</span><span class="nx">$</span><span class="p">{</span><span class="nx">formType</span><span class="p">}</span><span class="err">`</span>
  <span class="nx">axios</span><span class="p">.</span><span class="nx">post</span><span class="p">(</span><span class="nx">url</span><span class="p">,</span> <span class="nx">data</span><span class="p">)</span>
  <span class="p">.</span><span class="nx">then</span><span class="p">((</span><span class="nx">res</span><span class="p">)</span> <span class="o">=&gt;</span> <span class="p">{</span>
    <span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="nx">res</span><span class="p">.</span><span class="nx">data</span><span class="p">);</span>
  <span class="p">})</span>
  <span class="p">.</span><span class="k">catch</span><span class="p">((</span><span class="nx">err</span><span class="p">)</span> <span class="o">=&gt;</span> <span class="p">{</span> <span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="nx">err</span><span class="p">);</span> <span class="p">})</span>
<span class="p">}</span>
</code></pre></div>
<p>Test the user registration out. If you have everything set up correctly, you should see an object in the JavaScript console with an auth token:</p>
<div class="highlight"><pre><code class="language-text" data-lang="text">{
  auth_token: &quot;eyJ0eXAiOiJKV1QiLCJhbGciOiJIUzI1NiJ9.eyJleHAiOjE0OTc3NTM2ODMsImlhdCI6MTQ5Nzc1MzY3OCwic3ViIjo0fQ.vcRFb5v3znHkz8An12QUxrgXsLqoKv93kIsMf-pdfVw&quot;,
  message: &quot;Successfully registered.&quot;,
  status: &quot;success&quot;
}
</code></pre></div>
<p>Test logging in as well. Again, you should see the very same object in the console.</p>

<h4 id="update-the-page">Update the page</h4>

<p>After a user register or logs in, we need to:</p>

<ol>
<li>Clear the <code>formData</code> object</li>
<li>Save the auth token in the browser&#39;s <a href="https://developer.mozilla.org/en-US/docs/Web/API/Storage/LocalStorage">LocalStorage</a></li>
<li>Update the state to indicate that the user is authenticated</li>
<li>Redirect the user to <code>/</code></li>
</ol>

<p>First, to clear the form, update the <code>.then</code> within <code>handleUserFormSubmit()</code>:</p>
<div class="highlight"><pre><code class="language-javascript" data-lang="javascript"><span class="p">.</span><span class="nx">then</span><span class="p">((</span><span class="nx">res</span><span class="p">)</span> <span class="o">=&gt;</span> <span class="p">{</span>
  <span class="k">this</span><span class="p">.</span><span class="nx">setState</span><span class="p">({</span>
    <span class="nx">formData</span><span class="o">:</span> <span class="p">{</span><span class="nx">username</span><span class="o">:</span> <span class="s1">&#39;&#39;</span><span class="p">,</span> <span class="nx">email</span><span class="o">:</span> <span class="s1">&#39;&#39;</span><span class="p">,</span> <span class="nx">password</span><span class="o">:</span> <span class="s1">&#39;&#39;</span> <span class="p">},</span>
    <span class="nx">username</span><span class="o">:</span> <span class="s1">&#39;&#39;</span><span class="p">,</span>
    <span class="nx">email</span><span class="o">:</span> <span class="s1">&#39;&#39;</span>
  <span class="p">});</span>
<span class="p">})</span>
</code></pre></div>
<p>Try this out. After you register or log in, the field inputs should be cleared since we set the properties in the <code>formData</code> object to empty strings.</p>

<blockquote>
<p>What happens if you enter data for the registration form but <em>don&#39;t</em> submit it and then navigate to the login form? The fields should remain. Is this okay? Should we clear the state on page load? Your call. You could simply update the state within the <code>componentWillMount</code> lifecycle method.</p>
</blockquote>

<p>Next, let&#39;s save the auth token in LocalStorage so that we can use it for subsequent API calls that require a user to be authenticated. To do this, add the following code to the <code>.then</code>, just below the <code>setState</code>:</p>
<div class="highlight"><pre><code class="language-javascript" data-lang="javascript"><span class="nb">window</span><span class="p">.</span><span class="nx">localStorage</span><span class="p">.</span><span class="nx">setItem</span><span class="p">(</span><span class="s1">&#39;authToken&#39;</span><span class="p">,</span> <span class="nx">res</span><span class="p">.</span><span class="nx">data</span><span class="p">.</span><span class="nx">auth_token</span><span class="p">);</span>
</code></pre></div>
<p>Try logging in again. After a successful login, open the Application tab within <a href="https://developer.chrome.com/devtools">Chrome DevTools</a>. Click the arrow before <a href="https://developers.google.com/web/tools/chrome-devtools/manage-data/local-storage">LocalStorage</a> and select <code>http://localhost:3000</code>. You should see a key of <code>authToken</code> with a value of the actual token in the pane.</p>

<p>Instead of always checking LocalStorage for the auth token, let&#39;s add a boolean to the state so we can quickly tell if there us a user authenticated.</p>

<p>Add an <code>isAuthenticated</code> property to the state:</p>
<div class="highlight"><pre><code class="language-javascript" data-lang="javascript"><span class="k">this</span><span class="p">.</span><span class="nx">state</span> <span class="o">=</span> <span class="p">{</span>
  <span class="nx">users</span><span class="o">:</span> <span class="p">[],</span>
  <span class="nx">username</span><span class="o">:</span> <span class="s1">&#39;&#39;</span><span class="p">,</span>
  <span class="nx">email</span><span class="o">:</span> <span class="s1">&#39;&#39;</span><span class="p">,</span>
  <span class="nx">title</span><span class="o">:</span> <span class="s1">&#39;TestDriven.io&#39;</span><span class="p">,</span>
  <span class="nx">formData</span><span class="o">:</span> <span class="p">{</span>
    <span class="nx">username</span><span class="o">:</span> <span class="s1">&#39;&#39;</span><span class="p">,</span>
    <span class="nx">email</span><span class="o">:</span> <span class="s1">&#39;&#39;</span><span class="p">,</span>
    <span class="nx">password</span><span class="o">:</span> <span class="s1">&#39;&#39;</span>
  <span class="p">},</span>
  <span class="nx">isAuthenticated</span><span class="o">:</span> <span class="kc">false</span>
<span class="p">}</span>
</code></pre></div>
<p>Now, we can update the state in the <code>.then</code> within <code>handleUserFormSubmit()</code>:</p>
<div class="highlight"><pre><code class="language-javascript" data-lang="javascript"><span class="k">this</span><span class="p">.</span><span class="nx">setState</span><span class="p">({</span>
  <span class="nx">formData</span><span class="o">:</span> <span class="p">{</span><span class="nx">username</span><span class="o">:</span> <span class="s1">&#39;&#39;</span><span class="p">,</span> <span class="nx">email</span><span class="o">:</span> <span class="s1">&#39;&#39;</span><span class="p">,</span> <span class="nx">password</span><span class="o">:</span> <span class="s1">&#39;&#39;</span> <span class="p">},</span>
  <span class="nx">username</span><span class="o">:</span> <span class="s1">&#39;&#39;</span><span class="p">,</span>
  <span class="nx">email</span><span class="o">:</span> <span class="s1">&#39;&#39;</span><span class="p">,</span>
  <span class="nx">isAuthenticated</span><span class="o">:</span> <span class="kc">true</span>
<span class="p">});</span>
</code></pre></div>
<p>Finally, to redirect the user after a successful log in or registration, pass <code>isAuthenticated</code> through to the <code>Form</code> component:</p>
<div class="highlight"><pre><code class="language-javascript" data-lang="javascript"><span class="o">&lt;</span><span class="nx">Route</span> <span class="nx">exact</span> <span class="nx">path</span><span class="o">=</span><span class="s1">&#39;/register&#39;</span> <span class="nx">render</span><span class="o">=</span><span class="p">{()</span> <span class="o">=&gt;</span> <span class="p">(</span>
  <span class="o">&lt;</span><span class="nx">Form</span>
    <span class="nx">formType</span><span class="o">=</span><span class="p">{</span><span class="s1">&#39;Register&#39;</span><span class="p">}</span>
    <span class="nx">formData</span><span class="o">=</span><span class="p">{</span><span class="k">this</span><span class="p">.</span><span class="nx">state</span><span class="p">.</span><span class="nx">formData</span><span class="p">}</span>
    <span class="nx">handleFormChange</span><span class="o">=</span><span class="p">{</span><span class="k">this</span><span class="p">.</span><span class="nx">handleFormChange</span><span class="p">.</span><span class="nx">bind</span><span class="p">(</span><span class="k">this</span><span class="p">)}</span>
    <span class="nx">handleUserFormSubmit</span><span class="o">=</span><span class="p">{</span><span class="k">this</span><span class="p">.</span><span class="nx">handleUserFormSubmit</span><span class="p">.</span><span class="nx">bind</span><span class="p">(</span><span class="k">this</span><span class="p">)}</span>
    <span class="nx">isAuthenticated</span><span class="o">=</span><span class="p">{</span><span class="k">this</span><span class="p">.</span><span class="nx">state</span><span class="p">.</span><span class="nx">isAuthenticated</span><span class="p">}</span>
  <span class="o">/&gt;</span>
<span class="p">)}</span> <span class="o">/&gt;</span>
<span class="o">&lt;</span><span class="nx">Route</span> <span class="nx">exact</span> <span class="nx">path</span><span class="o">=</span><span class="s1">&#39;/login&#39;</span> <span class="nx">render</span><span class="o">=</span><span class="p">{()</span> <span class="o">=&gt;</span> <span class="p">(</span>
  <span class="o">&lt;</span><span class="nx">Form</span>
    <span class="nx">formType</span><span class="o">=</span><span class="p">{</span><span class="s1">&#39;Login&#39;</span><span class="p">}</span>
    <span class="nx">formData</span><span class="o">=</span><span class="p">{</span><span class="k">this</span><span class="p">.</span><span class="nx">state</span><span class="p">.</span><span class="nx">formData</span><span class="p">}</span>
    <span class="nx">handleFormChange</span><span class="o">=</span><span class="p">{</span><span class="k">this</span><span class="p">.</span><span class="nx">handleFormChange</span><span class="p">.</span><span class="nx">bind</span><span class="p">(</span><span class="k">this</span><span class="p">)}</span>
    <span class="nx">handleUserFormSubmit</span><span class="o">=</span><span class="p">{</span><span class="k">this</span><span class="p">.</span><span class="nx">handleUserFormSubmit</span><span class="p">.</span><span class="nx">bind</span><span class="p">(</span><span class="k">this</span><span class="p">)}</span>
    <span class="nx">isAuthenticated</span><span class="o">=</span><span class="p">{</span><span class="k">this</span><span class="p">.</span><span class="nx">state</span><span class="p">.</span><span class="nx">isAuthenticated</span><span class="p">}</span>
  <span class="o">/&gt;</span>
<span class="p">)}</span> <span class="o">/&gt;</span>
</code></pre></div>
<p>Then, within <em>Form.jsx</em> add the following conditional right before the <code>return</code>:</p>
<div class="highlight"><pre><code class="language-javascript" data-lang="javascript"><span class="k">if</span> <span class="p">(</span><span class="nx">props</span><span class="p">.</span><span class="nx">isAuthenticated</span><span class="p">)</span> <span class="p">{</span>
  <span class="k">return</span> <span class="o">&lt;</span><span class="nx">Redirect</span> <span class="nx">to</span><span class="o">=</span><span class="s1">&#39;/&#39;</span> <span class="o">/&gt;</span><span class="p">;</span>
<span class="p">}</span>
</code></pre></div>
<p>Add the import:</p>
<div class="highlight"><pre><code class="language-javascript" data-lang="javascript"><span class="kr">import</span> <span class="p">{</span> <span class="nx">Redirect</span> <span class="p">}</span> <span class="nx">from</span> <span class="s1">&#39;react-router-dom&#39;</span><span class="p">;</span>
</code></pre></div>
<p>To test, log in and then make sure that you are redirected to <code>/</code>. Also, you should be redirected if you try to go to the <code>/register</code> or <code>/login</code> links. Before moving on, try registering a new user. Did you notice that even though the redirect works, the users list is not updating?</p>

<p>To update that, fire <code>this.getUsers()</code> in the <code>.then</code> within <code>handleUserFormSubmit()</code>:</p>
<div class="highlight"><pre><code class="language-javascript" data-lang="javascript"><span class="p">.</span><span class="nx">then</span><span class="p">((</span><span class="nx">res</span><span class="p">)</span> <span class="o">=&gt;</span> <span class="p">{</span>
  <span class="k">this</span><span class="p">.</span><span class="nx">setState</span><span class="p">({</span>
    <span class="nx">formData</span><span class="o">:</span> <span class="p">{</span><span class="nx">username</span><span class="o">:</span> <span class="s1">&#39;&#39;</span><span class="p">,</span> <span class="nx">email</span><span class="o">:</span> <span class="s1">&#39;&#39;</span><span class="p">,</span> <span class="nx">password</span><span class="o">:</span> <span class="s1">&#39;&#39;</span><span class="p">},</span>
    <span class="nx">username</span><span class="o">:</span> <span class="s1">&#39;&#39;</span><span class="p">,</span>
    <span class="nx">email</span><span class="o">:</span> <span class="s1">&#39;&#39;</span><span class="p">,</span>
    <span class="nx">isAuthenticated</span><span class="o">:</span> <span class="kc">true</span>
  <span class="p">});</span>
  <span class="nb">window</span><span class="p">.</span><span class="nx">localStorage</span><span class="p">.</span><span class="nx">setItem</span><span class="p">(</span><span class="s1">&#39;authToken&#39;</span><span class="p">,</span> <span class="nx">res</span><span class="p">.</span><span class="nx">data</span><span class="p">.</span><span class="nx">auth_token</span><span class="p">);</span>
  <span class="k">this</span><span class="p">.</span><span class="nx">getUsers</span><span class="p">();</span>
<span class="p">})</span>
</code></pre></div>
<p>Test it out again.</p>

<h4 id="logout">Logout</h4>

<p>How about logging out? Add a new component to the &quot;components&quot; folder called <em>Logout.jsx</em>:</p>
<div class="highlight"><pre><code class="language-javascript" data-lang="javascript"><span class="kr">import</span> <span class="nx">React</span><span class="p">,</span> <span class="p">{</span> <span class="nx">Component</span> <span class="p">}</span> <span class="nx">from</span> <span class="s1">&#39;react&#39;</span><span class="p">;</span>
<span class="kr">import</span> <span class="p">{</span> <span class="nx">Link</span> <span class="p">}</span> <span class="nx">from</span> <span class="s1">&#39;react-router-dom&#39;</span><span class="p">;</span>

<span class="kr">class</span> <span class="nx">Logout</span> <span class="kr">extends</span> <span class="nx">Component</span> <span class="p">{</span>
  <span class="nx">componentDidMount</span><span class="p">()</span> <span class="p">{</span>
    <span class="k">this</span><span class="p">.</span><span class="nx">props</span><span class="p">.</span><span class="nx">logoutUser</span><span class="p">();</span>
  <span class="p">}</span>
  <span class="nx">render</span><span class="p">()</span> <span class="p">{</span>
    <span class="k">return</span> <span class="p">(</span>
      <span class="o">&lt;</span><span class="nx">div</span><span class="o">&gt;</span>
        <span class="o">&lt;</span><span class="nx">p</span><span class="o">&gt;</span><span class="nx">You</span> <span class="nx">are</span> <span class="nx">now</span> <span class="nx">logged</span> <span class="nx">out</span><span class="p">.</span> <span class="nx">Click</span> <span class="o">&lt;</span><span class="nx">Link</span> <span class="nx">to</span><span class="o">=</span><span class="s2">&quot;/login&quot;</span><span class="o">&gt;</span><span class="nx">here</span><span class="o">&lt;</span><span class="err">/Link&gt; to log back in.&lt;/p&gt;</span>
      <span class="o">&lt;</span><span class="err">/div&gt;</span>
    <span class="p">)</span>
  <span class="p">}</span>
<span class="p">}</span>

<span class="kr">export</span> <span class="k">default</span> <span class="nx">Logout</span>
</code></pre></div>
<p>Then, add a <code>logoutUser</code> method to the <code>App</code> component to remove the token from LocalStorage and update the state.</p>
<div class="highlight"><pre><code class="language-javascript" data-lang="javascript"><span class="nx">logoutUser</span><span class="p">()</span> <span class="p">{</span>
  <span class="nb">window</span><span class="p">.</span><span class="nx">localStorage</span><span class="p">.</span><span class="nx">clear</span><span class="p">();</span>
  <span class="k">this</span><span class="p">.</span><span class="nx">setState</span><span class="p">({</span> <span class="nx">isAuthenticated</span><span class="o">:</span> <span class="kc">false</span> <span class="p">});</span>
<span class="p">}</span>
</code></pre></div>
<p>Import the component into <em>App.jsx</em>, and then add the new route:</p>
<div class="highlight"><pre><code class="language-javascript" data-lang="javascript"><span class="o">&lt;</span><span class="nx">Route</span> <span class="nx">exact</span> <span class="nx">path</span><span class="o">=</span><span class="s1">&#39;/logout&#39;</span> <span class="nx">render</span><span class="o">=</span><span class="p">{()</span> <span class="o">=&gt;</span> <span class="p">(</span>
  <span class="o">&lt;</span><span class="nx">Logout</span>
    <span class="nx">logoutUser</span><span class="o">=</span><span class="p">{</span><span class="k">this</span><span class="p">.</span><span class="nx">logoutUser</span><span class="p">.</span><span class="nx">bind</span><span class="p">(</span><span class="k">this</span><span class="p">)}</span>
    <span class="nx">isAuthenticated</span><span class="o">=</span><span class="p">{</span><span class="k">this</span><span class="p">.</span><span class="nx">state</span><span class="p">.</span><span class="nx">isAuthenticated</span><span class="p">}</span>
  <span class="o">/&gt;</span>
<span class="p">)}</span> <span class="o">/&gt;</span>
</code></pre></div>
<p>To test:</p>

<ol>
<li>Log in</li>
<li>Verify that the token was added to LocalStorage</li>
<li>Log out</li>
<li>Verify that the token was removed from LocalStorage</li>
</ol>

<h4 id="user-status">User Status</h4>

<p>For the <code>/status</code> link, we need to add a new component that displays the response from a call to <code>/auth/status</code> on the users service. <em>Remember</em>: You need to be authenticated to hit this end-point successfully. So, we will need to add the token to the header prior to sending the AJAX request.</p>

<p>First, add a new component called <em>UserStatus.jsx</em>:</p>
<div class="highlight"><pre><code class="language-javascript" data-lang="javascript"><span class="kr">import</span> <span class="nx">React</span><span class="p">,</span> <span class="p">{</span> <span class="nx">Component</span> <span class="p">}</span> <span class="nx">from</span> <span class="s1">&#39;react&#39;</span><span class="p">;</span>
<span class="kr">import</span> <span class="nx">axios</span> <span class="nx">from</span> <span class="s1">&#39;axios&#39;</span><span class="p">;</span>

<span class="kr">class</span> <span class="nx">UserStatus</span> <span class="kr">extends</span> <span class="nx">Component</span> <span class="p">{</span>
  <span class="nx">constructor</span> <span class="p">(</span><span class="nx">props</span><span class="p">)</span> <span class="p">{</span>
    <span class="kr">super</span><span class="p">(</span><span class="nx">props</span><span class="p">)</span>
    <span class="k">this</span><span class="p">.</span><span class="nx">state</span> <span class="o">=</span> <span class="p">{</span>
      <span class="nx">created_at</span><span class="o">:</span> <span class="s1">&#39;&#39;</span><span class="p">,</span>
      <span class="nx">email</span><span class="o">:</span> <span class="s1">&#39;&#39;</span><span class="p">,</span>
      <span class="nx">id</span><span class="o">:</span> <span class="s1">&#39;&#39;</span><span class="p">,</span>
      <span class="nx">username</span><span class="o">:</span> <span class="s1">&#39;&#39;</span>
    <span class="p">}</span>
  <span class="p">}</span>
  <span class="nx">componentDidMount</span><span class="p">()</span> <span class="p">{</span>
    <span class="k">this</span><span class="p">.</span><span class="nx">getUserStatus</span><span class="p">();</span>
  <span class="p">}</span>
  <span class="nx">getUserStatus</span><span class="p">(</span><span class="nx">event</span><span class="p">)</span> <span class="p">{</span>
    <span class="kr">const</span> <span class="nx">options</span> <span class="o">=</span> <span class="p">{</span>
      <span class="nx">url</span><span class="o">:</span> <span class="err">`</span><span class="nx">$</span><span class="p">{</span><span class="nx">process</span><span class="p">.</span><span class="nx">env</span><span class="p">.</span><span class="nx">REACT_APP_USERS_SERVICE_URL</span><span class="p">}</span><span class="o">/</span><span class="nx">auth</span><span class="o">/</span><span class="nx">status</span><span class="err">`</span><span class="p">,</span>
      <span class="nx">method</span><span class="o">:</span> <span class="s1">&#39;get&#39;</span><span class="p">,</span>
      <span class="nx">headers</span><span class="o">:</span> <span class="p">{</span>
        <span class="s1">&#39;Content-Type&#39;</span><span class="o">:</span> <span class="s1">&#39;application/json&#39;</span><span class="p">,</span>
        <span class="nx">Authorization</span><span class="o">:</span> <span class="err">`</span><span class="nx">Bearer</span> <span class="nx">$</span><span class="p">{</span><span class="nb">window</span><span class="p">.</span><span class="nx">localStorage</span><span class="p">.</span><span class="nx">authToken</span><span class="p">}</span><span class="err">`</span>
      <span class="p">}</span>
    <span class="p">};</span>
    <span class="k">return</span> <span class="nx">axios</span><span class="p">(</span><span class="nx">options</span><span class="p">)</span>
    <span class="p">.</span><span class="nx">then</span><span class="p">((</span><span class="nx">res</span><span class="p">)</span> <span class="o">=&gt;</span> <span class="p">{</span> <span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="nx">res</span><span class="p">.</span><span class="nx">data</span><span class="p">.</span><span class="nx">data</span><span class="p">)</span> <span class="p">})</span>
    <span class="p">.</span><span class="k">catch</span><span class="p">((</span><span class="nx">error</span><span class="p">)</span> <span class="o">=&gt;</span> <span class="p">{</span> <span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="nx">error</span><span class="p">);</span> <span class="p">})</span>
  <span class="p">}</span>
  <span class="nx">render</span><span class="p">()</span> <span class="p">{</span>
    <span class="k">return</span> <span class="p">(</span>
      <span class="o">&lt;</span><span class="nx">div</span><span class="o">&gt;</span>
        <span class="o">&lt;</span><span class="nx">p</span><span class="o">&gt;</span><span class="nx">test</span><span class="o">&lt;</span><span class="err">/p&gt;</span>
      <span class="o">&lt;</span><span class="err">/div&gt;</span>
    <span class="p">)</span>
  <span class="p">}</span>
<span class="p">}</span>

<span class="kr">export</span> <span class="k">default</span> <span class="nx">UserStatus</span>
</code></pre></div>
<p>Here, we used a stateful, class-based component since the component has its own internal state. Notice how we also included a header with the AJAX request.</p>

<p>Import the component into <em>App.jsx</em>, and then add a new route:</p>
<div class="highlight"><pre><code class="language-javascript" data-lang="javascript"><span class="o">&lt;</span><span class="nx">Route</span> <span class="nx">exact</span> <span class="nx">path</span><span class="o">=</span><span class="s1">&#39;/status&#39;</span> <span class="nx">component</span><span class="o">=</span><span class="p">{</span><span class="nx">UserStatus</span><span class="p">}</span><span class="o">/&gt;</span>
</code></pre></div>
<p>Test this out first when you&#39;re not logged in. You should see a 401 error. Try again when you are logged in. You should see an object with the keys <code>active</code>, <code>created_at</code>, <code>email</code>, <code>id</code>, and <code>username</code>.</p>

<p>To add the values to the component, update the <code>.then</code>:</p>
<div class="highlight"><pre><code class="language-javascript" data-lang="javascript"><span class="p">.</span><span class="nx">then</span><span class="p">((</span><span class="nx">res</span><span class="p">)</span> <span class="o">=&gt;</span> <span class="p">{</span>
  <span class="k">this</span><span class="p">.</span><span class="nx">setState</span><span class="p">({</span>
    <span class="nx">created_at</span><span class="o">:</span> <span class="nx">res</span><span class="p">.</span><span class="nx">data</span><span class="p">.</span><span class="nx">data</span><span class="p">.</span><span class="nx">created_at</span><span class="p">,</span>
    <span class="nx">email</span><span class="o">:</span> <span class="nx">res</span><span class="p">.</span><span class="nx">data</span><span class="p">.</span><span class="nx">data</span><span class="p">.</span><span class="nx">email</span><span class="p">,</span>
    <span class="nx">id</span><span class="o">:</span> <span class="nx">res</span><span class="p">.</span><span class="nx">data</span><span class="p">.</span><span class="nx">data</span><span class="p">.</span><span class="nx">id</span><span class="p">,</span>
    <span class="nx">username</span><span class="o">:</span> <span class="nx">res</span><span class="p">.</span><span class="nx">data</span><span class="p">.</span><span class="nx">data</span><span class="p">.</span><span class="nx">username</span>
  <span class="p">})</span>
<span class="p">})</span>
</code></pre></div>
<p>Also, update the <code>render()</code>:</p>
<div class="highlight"><pre><code class="language-javascript" data-lang="javascript"><span class="nx">render</span><span class="p">()</span> <span class="p">{</span>
  <span class="k">return</span> <span class="p">(</span>
    <span class="o">&lt;</span><span class="nx">div</span><span class="o">&gt;</span>
      <span class="o">&lt;</span><span class="nx">ul</span><span class="o">&gt;</span>
        <span class="o">&lt;</span><span class="nx">li</span><span class="o">&gt;&lt;</span><span class="nx">strong</span><span class="o">&gt;</span><span class="nx">User</span> <span class="nx">ID</span><span class="o">:&lt;</span><span class="err">/strong&gt; {this.state.id}&lt;/li&gt;</span>
        <span class="o">&lt;</span><span class="nx">li</span><span class="o">&gt;&lt;</span><span class="nx">strong</span><span class="o">&gt;</span><span class="nx">Email</span><span class="o">:&lt;</span><span class="err">/strong&gt; {this.state.email}&lt;/li&gt;</span>
        <span class="o">&lt;</span><span class="nx">li</span><span class="o">&gt;&lt;</span><span class="nx">strong</span><span class="o">&gt;</span><span class="nx">Username</span><span class="o">:&lt;</span><span class="err">/strong&gt; {this.state.username}&lt;/li&gt;</span>
        <span class="o">&lt;</span><span class="nx">li</span><span class="o">&gt;&lt;</span><span class="nx">strong</span><span class="o">&gt;</span><span class="nx">Created</span> <span class="nb">Date</span><span class="o">:&lt;</span><span class="err">/strong&gt; {this.state.created_at}&lt;/li&gt;</span>
      <span class="o">&lt;</span><span class="err">/ul&gt;</span>
    <span class="o">&lt;</span><span class="err">/div&gt;</span>
  <span class="p">)</span>
<span class="p">}</span>
</code></pre></div>
<p>Test it out.</p>

<h4 id="update-navbar-links">Update Navbar Links</h4>

<p>Finally, let&#39;s make the following changes to the Navbar:</p>

<ol>
<li>When the user is logged in, the register and log in links should be hidden</li>
<li>When the user is logged out, the log out and user status links should be hidden</li>
</ol>

<p>Update the <code>NavBar</code> component like so to show/hide based on the value of <code>isAuthenticated</code>:</p>
<div class="highlight"><pre><code class="language-javascript" data-lang="javascript"><span class="kr">const</span> <span class="nx">NavBar</span> <span class="o">=</span> <span class="p">(</span><span class="nx">props</span><span class="p">)</span> <span class="o">=&gt;</span> <span class="p">(</span>
  <span class="o">&lt;</span><span class="nx">Navbar</span> <span class="nx">inverse</span> <span class="nx">collapseOnSelect</span><span class="o">&gt;</span>
    <span class="o">&lt;</span><span class="nx">Navbar</span><span class="p">.</span><span class="nx">Header</span><span class="o">&gt;</span>
      <span class="o">&lt;</span><span class="nx">Navbar</span><span class="p">.</span><span class="nx">Brand</span><span class="o">&gt;</span>
        <span class="o">&lt;</span><span class="nx">span</span><span class="o">&gt;</span><span class="p">{</span><span class="nx">props</span><span class="p">.</span><span class="nx">title</span><span class="p">}</span><span class="o">&lt;</span><span class="err">/span&gt;</span>
      <span class="o">&lt;</span><span class="err">/Navbar.Brand&gt;</span>
      <span class="o">&lt;</span><span class="nx">Navbar</span><span class="p">.</span><span class="nx">Toggle</span> <span class="o">/&gt;</span>
    <span class="o">&lt;</span><span class="err">/Navbar.Header&gt;</span>
    <span class="o">&lt;</span><span class="nx">Navbar</span><span class="p">.</span><span class="nx">Collapse</span><span class="o">&gt;</span>
      <span class="o">&lt;</span><span class="nx">Nav</span><span class="o">&gt;</span>
        <span class="o">&lt;</span><span class="nx">LinkContainer</span> <span class="nx">to</span><span class="o">=</span><span class="s2">&quot;/&quot;</span><span class="o">&gt;</span>
          <span class="o">&lt;</span><span class="nx">NavItem</span> <span class="nx">eventKey</span><span class="o">=</span><span class="p">{</span><span class="mi">1</span><span class="p">}</span><span class="o">&gt;</span><span class="nx">Home</span><span class="o">&lt;</span><span class="err">/NavItem&gt;</span>
        <span class="o">&lt;</span><span class="err">/LinkContainer&gt;</span>
        <span class="o">&lt;</span><span class="nx">LinkContainer</span> <span class="nx">to</span><span class="o">=</span><span class="s2">&quot;/about&quot;</span><span class="o">&gt;</span>
          <span class="o">&lt;</span><span class="nx">NavItem</span> <span class="nx">eventKey</span><span class="o">=</span><span class="p">{</span><span class="mi">2</span><span class="p">}</span><span class="o">&gt;</span><span class="nx">About</span><span class="o">&lt;</span><span class="err">/NavItem&gt;</span>
        <span class="o">&lt;</span><span class="err">/LinkContainer&gt;</span>
        <span class="p">{</span><span class="nx">props</span><span class="p">.</span><span class="nx">isAuthenticated</span> <span class="o">&amp;&amp;</span>
          <span class="o">&lt;</span><span class="nx">LinkContainer</span> <span class="nx">to</span><span class="o">=</span><span class="s2">&quot;/status&quot;</span><span class="o">&gt;</span>
            <span class="o">&lt;</span><span class="nx">NavItem</span> <span class="nx">eventKey</span><span class="o">=</span><span class="p">{</span><span class="mi">3</span><span class="p">}</span><span class="o">&gt;</span><span class="nx">User</span> <span class="nx">Status</span><span class="o">&lt;</span><span class="err">/NavItem&gt;</span>
          <span class="o">&lt;</span><span class="err">/LinkContainer&gt;</span>
        <span class="p">}</span>
      <span class="o">&lt;</span><span class="err">/Nav&gt;</span>
      <span class="o">&lt;</span><span class="nx">Nav</span> <span class="nx">pullRight</span><span class="o">&gt;</span>
        <span class="p">{</span><span class="o">!</span><span class="nx">props</span><span class="p">.</span><span class="nx">isAuthenticated</span> <span class="o">&amp;&amp;</span>
          <span class="o">&lt;</span><span class="nx">LinkContainer</span> <span class="nx">to</span><span class="o">=</span><span class="s2">&quot;/register&quot;</span><span class="o">&gt;</span>
            <span class="o">&lt;</span><span class="nx">NavItem</span> <span class="nx">eventKey</span><span class="o">=</span><span class="p">{</span><span class="mi">1</span><span class="p">}</span><span class="o">&gt;</span><span class="nx">Register</span><span class="o">&lt;</span><span class="err">/NavItem&gt;</span>
          <span class="o">&lt;</span><span class="err">/LinkContainer&gt;</span>
        <span class="p">}</span>
        <span class="p">{</span><span class="o">!</span><span class="nx">props</span><span class="p">.</span><span class="nx">isAuthenticated</span> <span class="o">&amp;&amp;</span>
          <span class="o">&lt;</span><span class="nx">LinkContainer</span> <span class="nx">to</span><span class="o">=</span><span class="s2">&quot;/login&quot;</span><span class="o">&gt;</span>
            <span class="o">&lt;</span><span class="nx">NavItem</span> <span class="nx">eventKey</span><span class="o">=</span><span class="p">{</span><span class="mi">2</span><span class="p">}</span><span class="o">&gt;</span><span class="nx">Log</span> <span class="nx">In</span><span class="o">&lt;</span><span class="err">/NavItem&gt;</span>
          <span class="o">&lt;</span><span class="err">/LinkContainer&gt;</span>
        <span class="p">}</span>
        <span class="p">{</span><span class="nx">props</span><span class="p">.</span><span class="nx">isAuthenticated</span> <span class="o">&amp;&amp;</span>
          <span class="o">&lt;</span><span class="nx">LinkContainer</span> <span class="nx">to</span><span class="o">=</span><span class="s2">&quot;/logout&quot;</span><span class="o">&gt;</span>
            <span class="o">&lt;</span><span class="nx">NavItem</span> <span class="nx">eventKey</span><span class="o">=</span><span class="p">{</span><span class="mi">3</span><span class="p">}</span><span class="o">&gt;</span><span class="nx">Log</span> <span class="nx">Out</span><span class="o">&lt;</span><span class="err">/NavItem&gt;</span>
          <span class="o">&lt;</span><span class="err">/LinkContainer&gt;</span>
        <span class="p">}</span>
      <span class="o">&lt;</span><span class="err">/Nav&gt;</span>
    <span class="o">&lt;</span><span class="err">/Navbar.Collapse&gt;</span>
  <span class="o">&lt;</span><span class="err">/Navbar&gt;</span>
<span class="p">)</span>
</code></pre></div>
<p>Make sure to pass <code>isAuthenticated</code> down on the <code>props</code>:</p>
<div class="highlight"><pre><code class="language-javascript" data-lang="javascript"><span class="o">&lt;</span><span class="nx">NavBar</span>
  <span class="nx">title</span><span class="o">=</span><span class="p">{</span><span class="k">this</span><span class="p">.</span><span class="nx">state</span><span class="p">.</span><span class="nx">title</span><span class="p">}</span>
  <span class="nx">isAuthenticated</span><span class="o">=</span><span class="p">{</span><span class="k">this</span><span class="p">.</span><span class="nx">state</span><span class="p">.</span><span class="nx">isAuthenticated</span><span class="p">}</span>
<span class="o">/&gt;</span>
</code></pre></div>
<p>This merely hides the links. An unauthenticated user could still access the route via entering the URL into the URL bar. To restrict access, update the <code>render()</code> in <em>UserStatus.jsx</em>:</p>
<div class="highlight"><pre><code class="language-javascript" data-lang="javascript"><span class="nx">render</span><span class="p">()</span> <span class="p">{</span>
  <span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="k">this</span><span class="p">.</span><span class="nx">props</span><span class="p">.</span><span class="nx">isAuthenticated</span><span class="p">)</span> <span class="p">{</span>
    <span class="k">return</span> <span class="o">&lt;</span><span class="nx">p</span><span class="o">&gt;</span><span class="nx">You</span> <span class="nx">must</span> <span class="nx">be</span> <span class="nx">logged</span> <span class="k">in</span> <span class="nx">to</span> <span class="nx">view</span> <span class="k">this</span><span class="p">.</span> <span class="nx">Click</span> <span class="o">&lt;</span><span class="nx">Link</span> <span class="nx">to</span><span class="o">=</span><span class="s2">&quot;/login&quot;</span><span class="o">&gt;</span><span class="nx">here</span><span class="o">&lt;</span><span class="err">/Link&gt; to log back in.&lt;/p&gt;</span>
  <span class="p">}</span>
  <span class="k">return</span> <span class="p">(</span>
    <span class="o">&lt;</span><span class="nx">div</span><span class="o">&gt;</span>
      <span class="o">&lt;</span><span class="nx">ul</span><span class="o">&gt;</span>
        <span class="o">&lt;</span><span class="nx">li</span><span class="o">&gt;&lt;</span><span class="nx">strong</span><span class="o">&gt;</span><span class="nx">User</span> <span class="nx">ID</span><span class="o">:&lt;</span><span class="err">/strong&gt; {this.state.id}&lt;/li&gt;</span>
        <span class="o">&lt;</span><span class="nx">li</span><span class="o">&gt;&lt;</span><span class="nx">strong</span><span class="o">&gt;</span><span class="nx">Email</span><span class="o">:&lt;</span><span class="err">/strong&gt; {this.state.email}&lt;/li&gt;</span>
        <span class="o">&lt;</span><span class="nx">li</span><span class="o">&gt;&lt;</span><span class="nx">strong</span><span class="o">&gt;</span><span class="nx">Username</span><span class="o">:&lt;</span><span class="err">/strong&gt; {this.state.username}&lt;/li&gt;</span>
        <span class="o">&lt;</span><span class="nx">li</span><span class="o">&gt;&lt;</span><span class="nx">strong</span><span class="o">&gt;</span><span class="nx">Created</span> <span class="nb">Date</span><span class="o">:&lt;</span><span class="err">/strong&gt; {this.state.created_at}&lt;/li&gt;</span>
      <span class="o">&lt;</span><span class="err">/ul&gt;</span>
    <span class="o">&lt;</span><span class="err">/div&gt;</span>
  <span class="p">)</span>
<span class="p">}</span>
</code></pre></div>
<p>Add the import:</p>
<div class="highlight"><pre><code class="language-javascript" data-lang="javascript"><span class="kr">import</span> <span class="p">{</span> <span class="nx">Link</span> <span class="p">}</span> <span class="nx">from</span> <span class="s1">&#39;react-router-dom&#39;</span><span class="p">;</span>
</code></pre></div>
<p>Then update the route in the <code>App</code> component:</p>
<div class="highlight"><pre><code class="language-javascript" data-lang="javascript"><span class="o">&lt;</span><span class="nx">Route</span> <span class="nx">exact</span> <span class="nx">path</span><span class="o">=</span><span class="s1">&#39;/status&#39;</span> <span class="nx">render</span><span class="o">=</span><span class="p">{()</span> <span class="o">=&gt;</span> <span class="p">(</span>
  <span class="o">&lt;</span><span class="nx">UserStatus</span>
    <span class="nx">isAuthenticated</span><span class="o">=</span><span class="p">{</span><span class="k">this</span><span class="p">.</span><span class="nx">state</span><span class="p">.</span><span class="nx">isAuthenticated</span><span class="p">}</span>
  <span class="o">/&gt;</span>
<span class="p">)}</span> <span class="o">/&gt;</span>
</code></pre></div>
<p>Open the JavaScript console, and then try this out. Did you notice that the AJAX request still fires when you were unauthenticated? To fix, add a conditional to the <code>componentDidMount()</code> in the <code>UserStatus</code> component:</p>
<div class="highlight"><pre><code class="language-javascript" data-lang="javascript"><span class="nx">componentDidMount</span><span class="p">()</span> <span class="p">{</span>
  <span class="k">if</span> <span class="p">(</span><span class="k">this</span><span class="p">.</span><span class="nx">props</span><span class="p">.</span><span class="nx">isAuthenticated</span><span class="p">)</span> <span class="p">{</span>
    <span class="k">this</span><span class="p">.</span><span class="nx">getUserStatus</span><span class="p">();</span>
  <span class="p">}</span>
<span class="p">}</span>
</code></pre></div>
<p>Commit your code.</p>


          
  <br><br>
  <a class="twitter-share-button" data-show-count="false" href="https://twitter.com/intent/tweet?text=Microservices with Docker, Flask, and React - React Authentication&amp;url=http%3A%2F%2Ftestdriven.io/part-three-react-authentication&amp;via=RealPython" rel="nofollow" target="_blank" title="Share on Twitter"></a><script async src="//platform.twitter.com/widgets.js" charset="utf-8"></script>



          <div class="page-nav">
            
              <a class="prev btn left-align" href="/part-three-react-bootstrap">&laquo; React Bootstrap</a>
            
            
              <a class="next btn right-align" href="/part-three-authorization">Authorization &raquo;</a>
            
          </div>

        </div>

        <div class="hide-on-med-and-up">

          <h2>React Authentication</h2>

          <p>Let&#39;s add some methods to handle a user signing up, logging in, and logging out...</p>

<hr>

<p>With the <code>Form</code> component set up, we can now configure the methods to:</p>

<ol>
<li>Handle form submit event</li>
<li>Obtain user input</li>
<li>Send AJAX request</li>
<li>Update the page</li>
</ol>

<blockquote>
<p>These steps should look familiar since we already went through this process in the <a href="/part-two-react-forms/">React Forms</a> lesson. Put yourself to test and implement the code yourself before going through this lesson.</p>
</blockquote>

<h4 id="handle-form-submit-event">Handle form submit event</h4>

<p>Turn to <em>Form.jsx</em>. Which method gets fired on the form submit?</p>
<div class="highlight"><pre><code class="language-javascript" data-lang="javascript"><span class="o">&lt;</span><span class="nx">form</span> <span class="nx">onSubmit</span><span class="o">=</span><span class="p">{</span> <span class="p">(</span><span class="nx">event</span><span class="p">)</span> <span class="o">=&gt;</span> <span class="nx">props</span><span class="p">.</span><span class="nx">handleUserFormSubmit</span><span class="p">(</span><span class="nx">event</span><span class="p">)</span> <span class="p">}</span><span class="o">&gt;</span>
</code></pre></div>
<p>Add the method to the <code>App</code> component:</p>
<div class="highlight"><pre><code class="language-javascript" data-lang="javascript"><span class="nx">handleUserFormSubmit</span><span class="p">(</span><span class="nx">event</span><span class="p">)</span> <span class="p">{</span>
  <span class="nx">event</span><span class="p">.</span><span class="nx">preventDefault</span><span class="p">();</span>
  <span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="s1">&#39;sanity check!&#39;</span><span class="p">)</span>
<span class="p">}</span>
</code></pre></div>
<p>And then pass it down via the <code>props</code>:</p>
<div class="highlight"><pre><code class="language-javascript" data-lang="javascript"><span class="o">&lt;</span><span class="nx">Route</span> <span class="nx">exact</span> <span class="nx">path</span><span class="o">=</span><span class="s1">&#39;/register&#39;</span> <span class="nx">render</span><span class="o">=</span><span class="p">{()</span> <span class="o">=&gt;</span> <span class="p">(</span>
  <span class="o">&lt;</span><span class="nx">Form</span>
    <span class="nx">formType</span><span class="o">=</span><span class="p">{</span><span class="s1">&#39;Register&#39;</span><span class="p">}</span>
    <span class="nx">formData</span><span class="o">=</span><span class="p">{</span><span class="k">this</span><span class="p">.</span><span class="nx">state</span><span class="p">.</span><span class="nx">formData</span><span class="p">}</span>
    <span class="nx">handleUserFormSubmit</span><span class="o">=</span><span class="p">{</span><span class="k">this</span><span class="p">.</span><span class="nx">handleUserFormSubmit</span><span class="p">.</span><span class="nx">bind</span><span class="p">(</span><span class="k">this</span><span class="p">)}</span>
  <span class="o">/&gt;</span>
<span class="p">)}</span> <span class="o">/&gt;</span>
<span class="o">&lt;</span><span class="nx">Route</span> <span class="nx">exact</span> <span class="nx">path</span><span class="o">=</span><span class="s1">&#39;/login&#39;</span> <span class="nx">render</span><span class="o">=</span><span class="p">{()</span> <span class="o">=&gt;</span> <span class="p">(</span>
  <span class="o">&lt;</span><span class="nx">Form</span>
    <span class="nx">formType</span><span class="o">=</span><span class="p">{</span><span class="s1">&#39;Login&#39;</span><span class="p">}</span>
    <span class="nx">formData</span><span class="o">=</span><span class="p">{</span><span class="k">this</span><span class="p">.</span><span class="nx">state</span><span class="p">.</span><span class="nx">formData</span><span class="p">}</span>
    <span class="nx">handleUserFormSubmit</span><span class="o">=</span><span class="p">{</span><span class="k">this</span><span class="p">.</span><span class="nx">handleUserFormSubmit</span><span class="p">.</span><span class="nx">bind</span><span class="p">(</span><span class="k">this</span><span class="p">)}</span>
  <span class="o">/&gt;</span>
<span class="p">)}</span> <span class="o">/&gt;</span>
</code></pre></div>
<p>Test it out in the browser. You should see <code>sanity check!</code> in the JavaScript console on form submit for both forms. Remove the <code>console.log(&#39;sanity check!&#39;)</code> when done.</p>

<h4 id="obtain-user-input">Obtain user input</h4>

<p>Next, to get the user inputs, add the following method to <code>App</code>:</p>
<div class="highlight"><pre><code class="language-javascript" data-lang="javascript"><span class="nx">handleFormChange</span><span class="p">(</span><span class="nx">event</span><span class="p">)</span> <span class="p">{</span>
  <span class="kr">const</span> <span class="nx">obj</span> <span class="o">=</span> <span class="k">this</span><span class="p">.</span><span class="nx">state</span><span class="p">.</span><span class="nx">formData</span><span class="p">;</span>
  <span class="nx">obj</span><span class="p">[</span><span class="nx">event</span><span class="p">.</span><span class="nx">target</span><span class="p">.</span><span class="nx">name</span><span class="p">]</span> <span class="o">=</span> <span class="nx">event</span><span class="p">.</span><span class="nx">target</span><span class="p">.</span><span class="nx">value</span><span class="p">;</span>
  <span class="k">this</span><span class="p">.</span><span class="nx">setState</span><span class="p">(</span><span class="nx">obj</span><span class="p">);</span>
<span class="p">}</span>
</code></pre></div>
<p>Pass it down on the <code>props</code>:</p>
<div class="highlight"><pre><code class="language-javascript" data-lang="javascript"><span class="nx">handleFormChange</span><span class="o">=</span><span class="p">{</span><span class="k">this</span><span class="p">.</span><span class="nx">handleFormChange</span><span class="p">.</span><span class="nx">bind</span><span class="p">(</span><span class="k">this</span><span class="p">)}</span>
</code></pre></div>
<p>Add a <code>console.log()</code> to the method - <code>console.log(this.state.formData);</code> - to ensure it works when you test it in the browser. Remove it once done.</p>

<p>What&#39;s next? AJAX!</p>

<h4 id="send-ajax-request">Send AJAX request</h4>

<p>Update the <code>handleUserFormSubmit</code> method to send the data to the user service on a successful form submit:</p>
<div class="highlight"><pre><code class="language-javascript" data-lang="javascript"><span class="nx">handleUserFormSubmit</span><span class="p">(</span><span class="nx">event</span><span class="p">)</span> <span class="p">{</span>
  <span class="nx">event</span><span class="p">.</span><span class="nx">preventDefault</span><span class="p">();</span>
  <span class="kr">const</span> <span class="nx">formType</span> <span class="o">=</span> <span class="nb">window</span><span class="p">.</span><span class="nx">location</span><span class="p">.</span><span class="nx">href</span><span class="p">.</span><span class="nx">split</span><span class="p">(</span><span class="s1">&#39;/&#39;</span><span class="p">).</span><span class="nx">reverse</span><span class="p">()[</span><span class="mi">0</span><span class="p">];</span>
  <span class="kd">let</span> <span class="nx">data</span><span class="p">;</span>
  <span class="k">if</span> <span class="p">(</span><span class="nx">formType</span> <span class="o">===</span> <span class="s1">&#39;login&#39;</span><span class="p">)</span> <span class="p">{</span>
    <span class="nx">data</span> <span class="o">=</span> <span class="p">{</span>
      <span class="nx">email</span><span class="o">:</span> <span class="k">this</span><span class="p">.</span><span class="nx">state</span><span class="p">.</span><span class="nx">formData</span><span class="p">.</span><span class="nx">email</span><span class="p">,</span>
      <span class="nx">password</span><span class="o">:</span> <span class="k">this</span><span class="p">.</span><span class="nx">state</span><span class="p">.</span><span class="nx">formData</span><span class="p">.</span><span class="nx">password</span>
    <span class="p">}</span>
  <span class="p">}</span>
  <span class="k">if</span> <span class="p">(</span><span class="nx">formType</span> <span class="o">===</span> <span class="s1">&#39;register&#39;</span><span class="p">)</span> <span class="p">{</span>
    <span class="nx">data</span> <span class="o">=</span> <span class="p">{</span>
      <span class="nx">username</span><span class="o">:</span> <span class="k">this</span><span class="p">.</span><span class="nx">state</span><span class="p">.</span><span class="nx">formData</span><span class="p">.</span><span class="nx">email</span><span class="p">,</span>
      <span class="nx">email</span><span class="o">:</span> <span class="k">this</span><span class="p">.</span><span class="nx">state</span><span class="p">.</span><span class="nx">formData</span><span class="p">.</span><span class="nx">email</span><span class="p">,</span>
      <span class="nx">password</span><span class="o">:</span> <span class="k">this</span><span class="p">.</span><span class="nx">state</span><span class="p">.</span><span class="nx">formData</span><span class="p">.</span><span class="nx">password</span>
    <span class="p">}</span>
  <span class="p">}</span>
  <span class="kr">const</span> <span class="nx">url</span> <span class="o">=</span> <span class="err">`</span><span class="nx">$</span><span class="p">{</span><span class="nx">process</span><span class="p">.</span><span class="nx">env</span><span class="p">.</span><span class="nx">REACT_APP_USERS_SERVICE_URL</span><span class="p">}</span><span class="o">/</span><span class="nx">auth</span><span class="o">/</span><span class="nx">$</span><span class="p">{</span><span class="nx">formType</span><span class="p">}</span><span class="err">`</span>
  <span class="nx">axios</span><span class="p">.</span><span class="nx">post</span><span class="p">(</span><span class="nx">url</span><span class="p">,</span> <span class="nx">data</span><span class="p">)</span>
  <span class="p">.</span><span class="nx">then</span><span class="p">((</span><span class="nx">res</span><span class="p">)</span> <span class="o">=&gt;</span> <span class="p">{</span>
    <span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="nx">res</span><span class="p">.</span><span class="nx">data</span><span class="p">);</span>
  <span class="p">})</span>
  <span class="p">.</span><span class="k">catch</span><span class="p">((</span><span class="nx">err</span><span class="p">)</span> <span class="o">=&gt;</span> <span class="p">{</span> <span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="nx">err</span><span class="p">);</span> <span class="p">})</span>
<span class="p">}</span>
</code></pre></div>
<p>Test the user registration out. If you have everything set up correctly, you should see an object in the JavaScript console with an auth token:</p>
<div class="highlight"><pre><code class="language-text" data-lang="text">{
  auth_token: &quot;eyJ0eXAiOiJKV1QiLCJhbGciOiJIUzI1NiJ9.eyJleHAiOjE0OTc3NTM2ODMsImlhdCI6MTQ5Nzc1MzY3OCwic3ViIjo0fQ.vcRFb5v3znHkz8An12QUxrgXsLqoKv93kIsMf-pdfVw&quot;,
  message: &quot;Successfully registered.&quot;,
  status: &quot;success&quot;
}
</code></pre></div>
<p>Test logging in as well. Again, you should see the very same object in the console.</p>

<h4 id="update-the-page">Update the page</h4>

<p>After a user register or logs in, we need to:</p>

<ol>
<li>Clear the <code>formData</code> object</li>
<li>Save the auth token in the browser&#39;s <a href="https://developer.mozilla.org/en-US/docs/Web/API/Storage/LocalStorage">LocalStorage</a></li>
<li>Update the state to indicate that the user is authenticated</li>
<li>Redirect the user to <code>/</code></li>
</ol>

<p>First, to clear the form, update the <code>.then</code> within <code>handleUserFormSubmit()</code>:</p>
<div class="highlight"><pre><code class="language-javascript" data-lang="javascript"><span class="p">.</span><span class="nx">then</span><span class="p">((</span><span class="nx">res</span><span class="p">)</span> <span class="o">=&gt;</span> <span class="p">{</span>
  <span class="k">this</span><span class="p">.</span><span class="nx">setState</span><span class="p">({</span>
    <span class="nx">formData</span><span class="o">:</span> <span class="p">{</span><span class="nx">username</span><span class="o">:</span> <span class="s1">&#39;&#39;</span><span class="p">,</span> <span class="nx">email</span><span class="o">:</span> <span class="s1">&#39;&#39;</span><span class="p">,</span> <span class="nx">password</span><span class="o">:</span> <span class="s1">&#39;&#39;</span> <span class="p">},</span>
    <span class="nx">username</span><span class="o">:</span> <span class="s1">&#39;&#39;</span><span class="p">,</span>
    <span class="nx">email</span><span class="o">:</span> <span class="s1">&#39;&#39;</span>
  <span class="p">});</span>
<span class="p">})</span>
</code></pre></div>
<p>Try this out. After you register or log in, the field inputs should be cleared since we set the properties in the <code>formData</code> object to empty strings.</p>

<blockquote>
<p>What happens if you enter data for the registration form but <em>don&#39;t</em> submit it and then navigate to the login form? The fields should remain. Is this okay? Should we clear the state on page load? Your call. You could simply update the state within the <code>componentWillMount</code> lifecycle method.</p>
</blockquote>

<p>Next, let&#39;s save the auth token in LocalStorage so that we can use it for subsequent API calls that require a user to be authenticated. To do this, add the following code to the <code>.then</code>, just below the <code>setState</code>:</p>
<div class="highlight"><pre><code class="language-javascript" data-lang="javascript"><span class="nb">window</span><span class="p">.</span><span class="nx">localStorage</span><span class="p">.</span><span class="nx">setItem</span><span class="p">(</span><span class="s1">&#39;authToken&#39;</span><span class="p">,</span> <span class="nx">res</span><span class="p">.</span><span class="nx">data</span><span class="p">.</span><span class="nx">auth_token</span><span class="p">);</span>
</code></pre></div>
<p>Try logging in again. After a successful login, open the Application tab within <a href="https://developer.chrome.com/devtools">Chrome DevTools</a>. Click the arrow before <a href="https://developers.google.com/web/tools/chrome-devtools/manage-data/local-storage">LocalStorage</a> and select <code>http://localhost:3000</code>. You should see a key of <code>authToken</code> with a value of the actual token in the pane.</p>

<p>Instead of always checking LocalStorage for the auth token, let&#39;s add a boolean to the state so we can quickly tell if there us a user authenticated.</p>

<p>Add an <code>isAuthenticated</code> property to the state:</p>
<div class="highlight"><pre><code class="language-javascript" data-lang="javascript"><span class="k">this</span><span class="p">.</span><span class="nx">state</span> <span class="o">=</span> <span class="p">{</span>
  <span class="nx">users</span><span class="o">:</span> <span class="p">[],</span>
  <span class="nx">username</span><span class="o">:</span> <span class="s1">&#39;&#39;</span><span class="p">,</span>
  <span class="nx">email</span><span class="o">:</span> <span class="s1">&#39;&#39;</span><span class="p">,</span>
  <span class="nx">title</span><span class="o">:</span> <span class="s1">&#39;TestDriven.io&#39;</span><span class="p">,</span>
  <span class="nx">formData</span><span class="o">:</span> <span class="p">{</span>
    <span class="nx">username</span><span class="o">:</span> <span class="s1">&#39;&#39;</span><span class="p">,</span>
    <span class="nx">email</span><span class="o">:</span> <span class="s1">&#39;&#39;</span><span class="p">,</span>
    <span class="nx">password</span><span class="o">:</span> <span class="s1">&#39;&#39;</span>
  <span class="p">},</span>
  <span class="nx">isAuthenticated</span><span class="o">:</span> <span class="kc">false</span>
<span class="p">}</span>
</code></pre></div>
<p>Now, we can update the state in the <code>.then</code> within <code>handleUserFormSubmit()</code>:</p>
<div class="highlight"><pre><code class="language-javascript" data-lang="javascript"><span class="k">this</span><span class="p">.</span><span class="nx">setState</span><span class="p">({</span>
  <span class="nx">formData</span><span class="o">:</span> <span class="p">{</span><span class="nx">username</span><span class="o">:</span> <span class="s1">&#39;&#39;</span><span class="p">,</span> <span class="nx">email</span><span class="o">:</span> <span class="s1">&#39;&#39;</span><span class="p">,</span> <span class="nx">password</span><span class="o">:</span> <span class="s1">&#39;&#39;</span> <span class="p">},</span>
  <span class="nx">username</span><span class="o">:</span> <span class="s1">&#39;&#39;</span><span class="p">,</span>
  <span class="nx">email</span><span class="o">:</span> <span class="s1">&#39;&#39;</span><span class="p">,</span>
  <span class="nx">isAuthenticated</span><span class="o">:</span> <span class="kc">true</span>
<span class="p">});</span>
</code></pre></div>
<p>Finally, to redirect the user after a successful log in or registration, pass <code>isAuthenticated</code> through to the <code>Form</code> component:</p>
<div class="highlight"><pre><code class="language-javascript" data-lang="javascript"><span class="o">&lt;</span><span class="nx">Route</span> <span class="nx">exact</span> <span class="nx">path</span><span class="o">=</span><span class="s1">&#39;/register&#39;</span> <span class="nx">render</span><span class="o">=</span><span class="p">{()</span> <span class="o">=&gt;</span> <span class="p">(</span>
  <span class="o">&lt;</span><span class="nx">Form</span>
    <span class="nx">formType</span><span class="o">=</span><span class="p">{</span><span class="s1">&#39;Register&#39;</span><span class="p">}</span>
    <span class="nx">formData</span><span class="o">=</span><span class="p">{</span><span class="k">this</span><span class="p">.</span><span class="nx">state</span><span class="p">.</span><span class="nx">formData</span><span class="p">}</span>
    <span class="nx">handleFormChange</span><span class="o">=</span><span class="p">{</span><span class="k">this</span><span class="p">.</span><span class="nx">handleFormChange</span><span class="p">.</span><span class="nx">bind</span><span class="p">(</span><span class="k">this</span><span class="p">)}</span>
    <span class="nx">handleUserFormSubmit</span><span class="o">=</span><span class="p">{</span><span class="k">this</span><span class="p">.</span><span class="nx">handleUserFormSubmit</span><span class="p">.</span><span class="nx">bind</span><span class="p">(</span><span class="k">this</span><span class="p">)}</span>
    <span class="nx">isAuthenticated</span><span class="o">=</span><span class="p">{</span><span class="k">this</span><span class="p">.</span><span class="nx">state</span><span class="p">.</span><span class="nx">isAuthenticated</span><span class="p">}</span>
  <span class="o">/&gt;</span>
<span class="p">)}</span> <span class="o">/&gt;</span>
<span class="o">&lt;</span><span class="nx">Route</span> <span class="nx">exact</span> <span class="nx">path</span><span class="o">=</span><span class="s1">&#39;/login&#39;</span> <span class="nx">render</span><span class="o">=</span><span class="p">{()</span> <span class="o">=&gt;</span> <span class="p">(</span>
  <span class="o">&lt;</span><span class="nx">Form</span>
    <span class="nx">formType</span><span class="o">=</span><span class="p">{</span><span class="s1">&#39;Login&#39;</span><span class="p">}</span>
    <span class="nx">formData</span><span class="o">=</span><span class="p">{</span><span class="k">this</span><span class="p">.</span><span class="nx">state</span><span class="p">.</span><span class="nx">formData</span><span class="p">}</span>
    <span class="nx">handleFormChange</span><span class="o">=</span><span class="p">{</span><span class="k">this</span><span class="p">.</span><span class="nx">handleFormChange</span><span class="p">.</span><span class="nx">bind</span><span class="p">(</span><span class="k">this</span><span class="p">)}</span>
    <span class="nx">handleUserFormSubmit</span><span class="o">=</span><span class="p">{</span><span class="k">this</span><span class="p">.</span><span class="nx">handleUserFormSubmit</span><span class="p">.</span><span class="nx">bind</span><span class="p">(</span><span class="k">this</span><span class="p">)}</span>
    <span class="nx">isAuthenticated</span><span class="o">=</span><span class="p">{</span><span class="k">this</span><span class="p">.</span><span class="nx">state</span><span class="p">.</span><span class="nx">isAuthenticated</span><span class="p">}</span>
  <span class="o">/&gt;</span>
<span class="p">)}</span> <span class="o">/&gt;</span>
</code></pre></div>
<p>Then, within <em>Form.jsx</em> add the following conditional right before the <code>return</code>:</p>
<div class="highlight"><pre><code class="language-javascript" data-lang="javascript"><span class="k">if</span> <span class="p">(</span><span class="nx">props</span><span class="p">.</span><span class="nx">isAuthenticated</span><span class="p">)</span> <span class="p">{</span>
  <span class="k">return</span> <span class="o">&lt;</span><span class="nx">Redirect</span> <span class="nx">to</span><span class="o">=</span><span class="s1">&#39;/&#39;</span> <span class="o">/&gt;</span><span class="p">;</span>
<span class="p">}</span>
</code></pre></div>
<p>Add the import:</p>
<div class="highlight"><pre><code class="language-javascript" data-lang="javascript"><span class="kr">import</span> <span class="p">{</span> <span class="nx">Redirect</span> <span class="p">}</span> <span class="nx">from</span> <span class="s1">&#39;react-router-dom&#39;</span><span class="p">;</span>
</code></pre></div>
<p>To test, log in and then make sure that you are redirected to <code>/</code>. Also, you should be redirected if you try to go to the <code>/register</code> or <code>/login</code> links. Before moving on, try registering a new user. Did you notice that even though the redirect works, the users list is not updating?</p>

<p>To update that, fire <code>this.getUsers()</code> in the <code>.then</code> within <code>handleUserFormSubmit()</code>:</p>
<div class="highlight"><pre><code class="language-javascript" data-lang="javascript"><span class="p">.</span><span class="nx">then</span><span class="p">((</span><span class="nx">res</span><span class="p">)</span> <span class="o">=&gt;</span> <span class="p">{</span>
  <span class="k">this</span><span class="p">.</span><span class="nx">setState</span><span class="p">({</span>
    <span class="nx">formData</span><span class="o">:</span> <span class="p">{</span><span class="nx">username</span><span class="o">:</span> <span class="s1">&#39;&#39;</span><span class="p">,</span> <span class="nx">email</span><span class="o">:</span> <span class="s1">&#39;&#39;</span><span class="p">,</span> <span class="nx">password</span><span class="o">:</span> <span class="s1">&#39;&#39;</span><span class="p">},</span>
    <span class="nx">username</span><span class="o">:</span> <span class="s1">&#39;&#39;</span><span class="p">,</span>
    <span class="nx">email</span><span class="o">:</span> <span class="s1">&#39;&#39;</span><span class="p">,</span>
    <span class="nx">isAuthenticated</span><span class="o">:</span> <span class="kc">true</span>
  <span class="p">});</span>
  <span class="nb">window</span><span class="p">.</span><span class="nx">localStorage</span><span class="p">.</span><span class="nx">setItem</span><span class="p">(</span><span class="s1">&#39;authToken&#39;</span><span class="p">,</span> <span class="nx">res</span><span class="p">.</span><span class="nx">data</span><span class="p">.</span><span class="nx">auth_token</span><span class="p">);</span>
  <span class="k">this</span><span class="p">.</span><span class="nx">getUsers</span><span class="p">();</span>
<span class="p">})</span>
</code></pre></div>
<p>Test it out again.</p>

<h4 id="logout">Logout</h4>

<p>How about logging out? Add a new component to the &quot;components&quot; folder called <em>Logout.jsx</em>:</p>
<div class="highlight"><pre><code class="language-javascript" data-lang="javascript"><span class="kr">import</span> <span class="nx">React</span><span class="p">,</span> <span class="p">{</span> <span class="nx">Component</span> <span class="p">}</span> <span class="nx">from</span> <span class="s1">&#39;react&#39;</span><span class="p">;</span>
<span class="kr">import</span> <span class="p">{</span> <span class="nx">Link</span> <span class="p">}</span> <span class="nx">from</span> <span class="s1">&#39;react-router-dom&#39;</span><span class="p">;</span>

<span class="kr">class</span> <span class="nx">Logout</span> <span class="kr">extends</span> <span class="nx">Component</span> <span class="p">{</span>
  <span class="nx">componentDidMount</span><span class="p">()</span> <span class="p">{</span>
    <span class="k">this</span><span class="p">.</span><span class="nx">props</span><span class="p">.</span><span class="nx">logoutUser</span><span class="p">();</span>
  <span class="p">}</span>
  <span class="nx">render</span><span class="p">()</span> <span class="p">{</span>
    <span class="k">return</span> <span class="p">(</span>
      <span class="o">&lt;</span><span class="nx">div</span><span class="o">&gt;</span>
        <span class="o">&lt;</span><span class="nx">p</span><span class="o">&gt;</span><span class="nx">You</span> <span class="nx">are</span> <span class="nx">now</span> <span class="nx">logged</span> <span class="nx">out</span><span class="p">.</span> <span class="nx">Click</span> <span class="o">&lt;</span><span class="nx">Link</span> <span class="nx">to</span><span class="o">=</span><span class="s2">&quot;/login&quot;</span><span class="o">&gt;</span><span class="nx">here</span><span class="o">&lt;</span><span class="err">/Link&gt; to log back in.&lt;/p&gt;</span>
      <span class="o">&lt;</span><span class="err">/div&gt;</span>
    <span class="p">)</span>
  <span class="p">}</span>
<span class="p">}</span>

<span class="kr">export</span> <span class="k">default</span> <span class="nx">Logout</span>
</code></pre></div>
<p>Then, add a <code>logoutUser</code> method to the <code>App</code> component to remove the token from LocalStorage and update the state.</p>
<div class="highlight"><pre><code class="language-javascript" data-lang="javascript"><span class="nx">logoutUser</span><span class="p">()</span> <span class="p">{</span>
  <span class="nb">window</span><span class="p">.</span><span class="nx">localStorage</span><span class="p">.</span><span class="nx">clear</span><span class="p">();</span>
  <span class="k">this</span><span class="p">.</span><span class="nx">setState</span><span class="p">({</span> <span class="nx">isAuthenticated</span><span class="o">:</span> <span class="kc">false</span> <span class="p">});</span>
<span class="p">}</span>
</code></pre></div>
<p>Import the component into <em>App.jsx</em>, and then add the new route:</p>
<div class="highlight"><pre><code class="language-javascript" data-lang="javascript"><span class="o">&lt;</span><span class="nx">Route</span> <span class="nx">exact</span> <span class="nx">path</span><span class="o">=</span><span class="s1">&#39;/logout&#39;</span> <span class="nx">render</span><span class="o">=</span><span class="p">{()</span> <span class="o">=&gt;</span> <span class="p">(</span>
  <span class="o">&lt;</span><span class="nx">Logout</span>
    <span class="nx">logoutUser</span><span class="o">=</span><span class="p">{</span><span class="k">this</span><span class="p">.</span><span class="nx">logoutUser</span><span class="p">.</span><span class="nx">bind</span><span class="p">(</span><span class="k">this</span><span class="p">)}</span>
    <span class="nx">isAuthenticated</span><span class="o">=</span><span class="p">{</span><span class="k">this</span><span class="p">.</span><span class="nx">state</span><span class="p">.</span><span class="nx">isAuthenticated</span><span class="p">}</span>
  <span class="o">/&gt;</span>
<span class="p">)}</span> <span class="o">/&gt;</span>
</code></pre></div>
<p>To test:</p>

<ol>
<li>Log in</li>
<li>Verify that the token was added to LocalStorage</li>
<li>Log out</li>
<li>Verify that the token was removed from LocalStorage</li>
</ol>

<h4 id="user-status">User Status</h4>

<p>For the <code>/status</code> link, we need to add a new component that displays the response from a call to <code>/auth/status</code> on the users service. <em>Remember</em>: You need to be authenticated to hit this end-point successfully. So, we will need to add the token to the header prior to sending the AJAX request.</p>

<p>First, add a new component called <em>UserStatus.jsx</em>:</p>
<div class="highlight"><pre><code class="language-javascript" data-lang="javascript"><span class="kr">import</span> <span class="nx">React</span><span class="p">,</span> <span class="p">{</span> <span class="nx">Component</span> <span class="p">}</span> <span class="nx">from</span> <span class="s1">&#39;react&#39;</span><span class="p">;</span>
<span class="kr">import</span> <span class="nx">axios</span> <span class="nx">from</span> <span class="s1">&#39;axios&#39;</span><span class="p">;</span>

<span class="kr">class</span> <span class="nx">UserStatus</span> <span class="kr">extends</span> <span class="nx">Component</span> <span class="p">{</span>
  <span class="nx">constructor</span> <span class="p">(</span><span class="nx">props</span><span class="p">)</span> <span class="p">{</span>
    <span class="kr">super</span><span class="p">(</span><span class="nx">props</span><span class="p">)</span>
    <span class="k">this</span><span class="p">.</span><span class="nx">state</span> <span class="o">=</span> <span class="p">{</span>
      <span class="nx">created_at</span><span class="o">:</span> <span class="s1">&#39;&#39;</span><span class="p">,</span>
      <span class="nx">email</span><span class="o">:</span> <span class="s1">&#39;&#39;</span><span class="p">,</span>
      <span class="nx">id</span><span class="o">:</span> <span class="s1">&#39;&#39;</span><span class="p">,</span>
      <span class="nx">username</span><span class="o">:</span> <span class="s1">&#39;&#39;</span>
    <span class="p">}</span>
  <span class="p">}</span>
  <span class="nx">componentDidMount</span><span class="p">()</span> <span class="p">{</span>
    <span class="k">this</span><span class="p">.</span><span class="nx">getUserStatus</span><span class="p">();</span>
  <span class="p">}</span>
  <span class="nx">getUserStatus</span><span class="p">(</span><span class="nx">event</span><span class="p">)</span> <span class="p">{</span>
    <span class="kr">const</span> <span class="nx">options</span> <span class="o">=</span> <span class="p">{</span>
      <span class="nx">url</span><span class="o">:</span> <span class="err">`</span><span class="nx">$</span><span class="p">{</span><span class="nx">process</span><span class="p">.</span><span class="nx">env</span><span class="p">.</span><span class="nx">REACT_APP_USERS_SERVICE_URL</span><span class="p">}</span><span class="o">/</span><span class="nx">auth</span><span class="o">/</span><span class="nx">status</span><span class="err">`</span><span class="p">,</span>
      <span class="nx">method</span><span class="o">:</span> <span class="s1">&#39;get&#39;</span><span class="p">,</span>
      <span class="nx">headers</span><span class="o">:</span> <span class="p">{</span>
        <span class="s1">&#39;Content-Type&#39;</span><span class="o">:</span> <span class="s1">&#39;application/json&#39;</span><span class="p">,</span>
        <span class="nx">Authorization</span><span class="o">:</span> <span class="err">`</span><span class="nx">Bearer</span> <span class="nx">$</span><span class="p">{</span><span class="nb">window</span><span class="p">.</span><span class="nx">localStorage</span><span class="p">.</span><span class="nx">authToken</span><span class="p">}</span><span class="err">`</span>
      <span class="p">}</span>
    <span class="p">};</span>
    <span class="k">return</span> <span class="nx">axios</span><span class="p">(</span><span class="nx">options</span><span class="p">)</span>
    <span class="p">.</span><span class="nx">then</span><span class="p">((</span><span class="nx">res</span><span class="p">)</span> <span class="o">=&gt;</span> <span class="p">{</span> <span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="nx">res</span><span class="p">.</span><span class="nx">data</span><span class="p">.</span><span class="nx">data</span><span class="p">)</span> <span class="p">})</span>
    <span class="p">.</span><span class="k">catch</span><span class="p">((</span><span class="nx">error</span><span class="p">)</span> <span class="o">=&gt;</span> <span class="p">{</span> <span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="nx">error</span><span class="p">);</span> <span class="p">})</span>
  <span class="p">}</span>
  <span class="nx">render</span><span class="p">()</span> <span class="p">{</span>
    <span class="k">return</span> <span class="p">(</span>
      <span class="o">&lt;</span><span class="nx">div</span><span class="o">&gt;</span>
        <span class="o">&lt;</span><span class="nx">p</span><span class="o">&gt;</span><span class="nx">test</span><span class="o">&lt;</span><span class="err">/p&gt;</span>
      <span class="o">&lt;</span><span class="err">/div&gt;</span>
    <span class="p">)</span>
  <span class="p">}</span>
<span class="p">}</span>

<span class="kr">export</span> <span class="k">default</span> <span class="nx">UserStatus</span>
</code></pre></div>
<p>Here, we used a stateful, class-based component since the component has its own internal state. Notice how we also included a header with the AJAX request.</p>

<p>Import the component into <em>App.jsx</em>, and then add a new route:</p>
<div class="highlight"><pre><code class="language-javascript" data-lang="javascript"><span class="o">&lt;</span><span class="nx">Route</span> <span class="nx">exact</span> <span class="nx">path</span><span class="o">=</span><span class="s1">&#39;/status&#39;</span> <span class="nx">component</span><span class="o">=</span><span class="p">{</span><span class="nx">UserStatus</span><span class="p">}</span><span class="o">/&gt;</span>
</code></pre></div>
<p>Test this out first when you&#39;re not logged in. You should see a 401 error. Try again when you are logged in. You should see an object with the keys <code>active</code>, <code>created_at</code>, <code>email</code>, <code>id</code>, and <code>username</code>.</p>

<p>To add the values to the component, update the <code>.then</code>:</p>
<div class="highlight"><pre><code class="language-javascript" data-lang="javascript"><span class="p">.</span><span class="nx">then</span><span class="p">((</span><span class="nx">res</span><span class="p">)</span> <span class="o">=&gt;</span> <span class="p">{</span>
  <span class="k">this</span><span class="p">.</span><span class="nx">setState</span><span class="p">({</span>
    <span class="nx">created_at</span><span class="o">:</span> <span class="nx">res</span><span class="p">.</span><span class="nx">data</span><span class="p">.</span><span class="nx">data</span><span class="p">.</span><span class="nx">created_at</span><span class="p">,</span>
    <span class="nx">email</span><span class="o">:</span> <span class="nx">res</span><span class="p">.</span><span class="nx">data</span><span class="p">.</span><span class="nx">data</span><span class="p">.</span><span class="nx">email</span><span class="p">,</span>
    <span class="nx">id</span><span class="o">:</span> <span class="nx">res</span><span class="p">.</span><span class="nx">data</span><span class="p">.</span><span class="nx">data</span><span class="p">.</span><span class="nx">id</span><span class="p">,</span>
    <span class="nx">username</span><span class="o">:</span> <span class="nx">res</span><span class="p">.</span><span class="nx">data</span><span class="p">.</span><span class="nx">data</span><span class="p">.</span><span class="nx">username</span>
  <span class="p">})</span>
<span class="p">})</span>
</code></pre></div>
<p>Also, update the <code>render()</code>:</p>
<div class="highlight"><pre><code class="language-javascript" data-lang="javascript"><span class="nx">render</span><span class="p">()</span> <span class="p">{</span>
  <span class="k">return</span> <span class="p">(</span>
    <span class="o">&lt;</span><span class="nx">div</span><span class="o">&gt;</span>
      <span class="o">&lt;</span><span class="nx">ul</span><span class="o">&gt;</span>
        <span class="o">&lt;</span><span class="nx">li</span><span class="o">&gt;&lt;</span><span class="nx">strong</span><span class="o">&gt;</span><span class="nx">User</span> <span class="nx">ID</span><span class="o">:&lt;</span><span class="err">/strong&gt; {this.state.id}&lt;/li&gt;</span>
        <span class="o">&lt;</span><span class="nx">li</span><span class="o">&gt;&lt;</span><span class="nx">strong</span><span class="o">&gt;</span><span class="nx">Email</span><span class="o">:&lt;</span><span class="err">/strong&gt; {this.state.email}&lt;/li&gt;</span>
        <span class="o">&lt;</span><span class="nx">li</span><span class="o">&gt;&lt;</span><span class="nx">strong</span><span class="o">&gt;</span><span class="nx">Username</span><span class="o">:&lt;</span><span class="err">/strong&gt; {this.state.username}&lt;/li&gt;</span>
        <span class="o">&lt;</span><span class="nx">li</span><span class="o">&gt;&lt;</span><span class="nx">strong</span><span class="o">&gt;</span><span class="nx">Created</span> <span class="nb">Date</span><span class="o">:&lt;</span><span class="err">/strong&gt; {this.state.created_at}&lt;/li&gt;</span>
      <span class="o">&lt;</span><span class="err">/ul&gt;</span>
    <span class="o">&lt;</span><span class="err">/div&gt;</span>
  <span class="p">)</span>
<span class="p">}</span>
</code></pre></div>
<p>Test it out.</p>

<h4 id="update-navbar-links">Update Navbar Links</h4>

<p>Finally, let&#39;s make the following changes to the Navbar:</p>

<ol>
<li>When the user is logged in, the register and log in links should be hidden</li>
<li>When the user is logged out, the log out and user status links should be hidden</li>
</ol>

<p>Update the <code>NavBar</code> component like so to show/hide based on the value of <code>isAuthenticated</code>:</p>
<div class="highlight"><pre><code class="language-javascript" data-lang="javascript"><span class="kr">const</span> <span class="nx">NavBar</span> <span class="o">=</span> <span class="p">(</span><span class="nx">props</span><span class="p">)</span> <span class="o">=&gt;</span> <span class="p">(</span>
  <span class="o">&lt;</span><span class="nx">Navbar</span> <span class="nx">inverse</span> <span class="nx">collapseOnSelect</span><span class="o">&gt;</span>
    <span class="o">&lt;</span><span class="nx">Navbar</span><span class="p">.</span><span class="nx">Header</span><span class="o">&gt;</span>
      <span class="o">&lt;</span><span class="nx">Navbar</span><span class="p">.</span><span class="nx">Brand</span><span class="o">&gt;</span>
        <span class="o">&lt;</span><span class="nx">span</span><span class="o">&gt;</span><span class="p">{</span><span class="nx">props</span><span class="p">.</span><span class="nx">title</span><span class="p">}</span><span class="o">&lt;</span><span class="err">/span&gt;</span>
      <span class="o">&lt;</span><span class="err">/Navbar.Brand&gt;</span>
      <span class="o">&lt;</span><span class="nx">Navbar</span><span class="p">.</span><span class="nx">Toggle</span> <span class="o">/&gt;</span>
    <span class="o">&lt;</span><span class="err">/Navbar.Header&gt;</span>
    <span class="o">&lt;</span><span class="nx">Navbar</span><span class="p">.</span><span class="nx">Collapse</span><span class="o">&gt;</span>
      <span class="o">&lt;</span><span class="nx">Nav</span><span class="o">&gt;</span>
        <span class="o">&lt;</span><span class="nx">LinkContainer</span> <span class="nx">to</span><span class="o">=</span><span class="s2">&quot;/&quot;</span><span class="o">&gt;</span>
          <span class="o">&lt;</span><span class="nx">NavItem</span> <span class="nx">eventKey</span><span class="o">=</span><span class="p">{</span><span class="mi">1</span><span class="p">}</span><span class="o">&gt;</span><span class="nx">Home</span><span class="o">&lt;</span><span class="err">/NavItem&gt;</span>
        <span class="o">&lt;</span><span class="err">/LinkContainer&gt;</span>
        <span class="o">&lt;</span><span class="nx">LinkContainer</span> <span class="nx">to</span><span class="o">=</span><span class="s2">&quot;/about&quot;</span><span class="o">&gt;</span>
          <span class="o">&lt;</span><span class="nx">NavItem</span> <span class="nx">eventKey</span><span class="o">=</span><span class="p">{</span><span class="mi">2</span><span class="p">}</span><span class="o">&gt;</span><span class="nx">About</span><span class="o">&lt;</span><span class="err">/NavItem&gt;</span>
        <span class="o">&lt;</span><span class="err">/LinkContainer&gt;</span>
        <span class="p">{</span><span class="nx">props</span><span class="p">.</span><span class="nx">isAuthenticated</span> <span class="o">&amp;&amp;</span>
          <span class="o">&lt;</span><span class="nx">LinkContainer</span> <span class="nx">to</span><span class="o">=</span><span class="s2">&quot;/status&quot;</span><span class="o">&gt;</span>
            <span class="o">&lt;</span><span class="nx">NavItem</span> <span class="nx">eventKey</span><span class="o">=</span><span class="p">{</span><span class="mi">3</span><span class="p">}</span><span class="o">&gt;</span><span class="nx">User</span> <span class="nx">Status</span><span class="o">&lt;</span><span class="err">/NavItem&gt;</span>
          <span class="o">&lt;</span><span class="err">/LinkContainer&gt;</span>
        <span class="p">}</span>
      <span class="o">&lt;</span><span class="err">/Nav&gt;</span>
      <span class="o">&lt;</span><span class="nx">Nav</span> <span class="nx">pullRight</span><span class="o">&gt;</span>
        <span class="p">{</span><span class="o">!</span><span class="nx">props</span><span class="p">.</span><span class="nx">isAuthenticated</span> <span class="o">&amp;&amp;</span>
          <span class="o">&lt;</span><span class="nx">LinkContainer</span> <span class="nx">to</span><span class="o">=</span><span class="s2">&quot;/register&quot;</span><span class="o">&gt;</span>
            <span class="o">&lt;</span><span class="nx">NavItem</span> <span class="nx">eventKey</span><span class="o">=</span><span class="p">{</span><span class="mi">1</span><span class="p">}</span><span class="o">&gt;</span><span class="nx">Register</span><span class="o">&lt;</span><span class="err">/NavItem&gt;</span>
          <span class="o">&lt;</span><span class="err">/LinkContainer&gt;</span>
        <span class="p">}</span>
        <span class="p">{</span><span class="o">!</span><span class="nx">props</span><span class="p">.</span><span class="nx">isAuthenticated</span> <span class="o">&amp;&amp;</span>
          <span class="o">&lt;</span><span class="nx">LinkContainer</span> <span class="nx">to</span><span class="o">=</span><span class="s2">&quot;/login&quot;</span><span class="o">&gt;</span>
            <span class="o">&lt;</span><span class="nx">NavItem</span> <span class="nx">eventKey</span><span class="o">=</span><span class="p">{</span><span class="mi">2</span><span class="p">}</span><span class="o">&gt;</span><span class="nx">Log</span> <span class="nx">In</span><span class="o">&lt;</span><span class="err">/NavItem&gt;</span>
          <span class="o">&lt;</span><span class="err">/LinkContainer&gt;</span>
        <span class="p">}</span>
        <span class="p">{</span><span class="nx">props</span><span class="p">.</span><span class="nx">isAuthenticated</span> <span class="o">&amp;&amp;</span>
          <span class="o">&lt;</span><span class="nx">LinkContainer</span> <span class="nx">to</span><span class="o">=</span><span class="s2">&quot;/logout&quot;</span><span class="o">&gt;</span>
            <span class="o">&lt;</span><span class="nx">NavItem</span> <span class="nx">eventKey</span><span class="o">=</span><span class="p">{</span><span class="mi">3</span><span class="p">}</span><span class="o">&gt;</span><span class="nx">Log</span> <span class="nx">Out</span><span class="o">&lt;</span><span class="err">/NavItem&gt;</span>
          <span class="o">&lt;</span><span class="err">/LinkContainer&gt;</span>
        <span class="p">}</span>
      <span class="o">&lt;</span><span class="err">/Nav&gt;</span>
    <span class="o">&lt;</span><span class="err">/Navbar.Collapse&gt;</span>
  <span class="o">&lt;</span><span class="err">/Navbar&gt;</span>
<span class="p">)</span>
</code></pre></div>
<p>Make sure to pass <code>isAuthenticated</code> down on the <code>props</code>:</p>
<div class="highlight"><pre><code class="language-javascript" data-lang="javascript"><span class="o">&lt;</span><span class="nx">NavBar</span>
  <span class="nx">title</span><span class="o">=</span><span class="p">{</span><span class="k">this</span><span class="p">.</span><span class="nx">state</span><span class="p">.</span><span class="nx">title</span><span class="p">}</span>
  <span class="nx">isAuthenticated</span><span class="o">=</span><span class="p">{</span><span class="k">this</span><span class="p">.</span><span class="nx">state</span><span class="p">.</span><span class="nx">isAuthenticated</span><span class="p">}</span>
<span class="o">/&gt;</span>
</code></pre></div>
<p>This merely hides the links. An unauthenticated user could still access the route via entering the URL into the URL bar. To restrict access, update the <code>render()</code> in <em>UserStatus.jsx</em>:</p>
<div class="highlight"><pre><code class="language-javascript" data-lang="javascript"><span class="nx">render</span><span class="p">()</span> <span class="p">{</span>
  <span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="k">this</span><span class="p">.</span><span class="nx">props</span><span class="p">.</span><span class="nx">isAuthenticated</span><span class="p">)</span> <span class="p">{</span>
    <span class="k">return</span> <span class="o">&lt;</span><span class="nx">p</span><span class="o">&gt;</span><span class="nx">You</span> <span class="nx">must</span> <span class="nx">be</span> <span class="nx">logged</span> <span class="k">in</span> <span class="nx">to</span> <span class="nx">view</span> <span class="k">this</span><span class="p">.</span> <span class="nx">Click</span> <span class="o">&lt;</span><span class="nx">Link</span> <span class="nx">to</span><span class="o">=</span><span class="s2">&quot;/login&quot;</span><span class="o">&gt;</span><span class="nx">here</span><span class="o">&lt;</span><span class="err">/Link&gt; to log back in.&lt;/p&gt;</span>
  <span class="p">}</span>
  <span class="k">return</span> <span class="p">(</span>
    <span class="o">&lt;</span><span class="nx">div</span><span class="o">&gt;</span>
      <span class="o">&lt;</span><span class="nx">ul</span><span class="o">&gt;</span>
        <span class="o">&lt;</span><span class="nx">li</span><span class="o">&gt;&lt;</span><span class="nx">strong</span><span class="o">&gt;</span><span class="nx">User</span> <span class="nx">ID</span><span class="o">:&lt;</span><span class="err">/strong&gt; {this.state.id}&lt;/li&gt;</span>
        <span class="o">&lt;</span><span class="nx">li</span><span class="o">&gt;&lt;</span><span class="nx">strong</span><span class="o">&gt;</span><span class="nx">Email</span><span class="o">:&lt;</span><span class="err">/strong&gt; {this.state.email}&lt;/li&gt;</span>
        <span class="o">&lt;</span><span class="nx">li</span><span class="o">&gt;&lt;</span><span class="nx">strong</span><span class="o">&gt;</span><span class="nx">Username</span><span class="o">:&lt;</span><span class="err">/strong&gt; {this.state.username}&lt;/li&gt;</span>
        <span class="o">&lt;</span><span class="nx">li</span><span class="o">&gt;&lt;</span><span class="nx">strong</span><span class="o">&gt;</span><span class="nx">Created</span> <span class="nb">Date</span><span class="o">:&lt;</span><span class="err">/strong&gt; {this.state.created_at}&lt;/li&gt;</span>
      <span class="o">&lt;</span><span class="err">/ul&gt;</span>
    <span class="o">&lt;</span><span class="err">/div&gt;</span>
  <span class="p">)</span>
<span class="p">}</span>
</code></pre></div>
<p>Add the import:</p>
<div class="highlight"><pre><code class="language-javascript" data-lang="javascript"><span class="kr">import</span> <span class="p">{</span> <span class="nx">Link</span> <span class="p">}</span> <span class="nx">from</span> <span class="s1">&#39;react-router-dom&#39;</span><span class="p">;</span>
</code></pre></div>
<p>Then update the route in the <code>App</code> component:</p>
<div class="highlight"><pre><code class="language-javascript" data-lang="javascript"><span class="o">&lt;</span><span class="nx">Route</span> <span class="nx">exact</span> <span class="nx">path</span><span class="o">=</span><span class="s1">&#39;/status&#39;</span> <span class="nx">render</span><span class="o">=</span><span class="p">{()</span> <span class="o">=&gt;</span> <span class="p">(</span>
  <span class="o">&lt;</span><span class="nx">UserStatus</span>
    <span class="nx">isAuthenticated</span><span class="o">=</span><span class="p">{</span><span class="k">this</span><span class="p">.</span><span class="nx">state</span><span class="p">.</span><span class="nx">isAuthenticated</span><span class="p">}</span>
  <span class="o">/&gt;</span>
<span class="p">)}</span> <span class="o">/&gt;</span>
</code></pre></div>
<p>Open the JavaScript console, and then try this out. Did you notice that the AJAX request still fires when you were unauthenticated? To fix, add a conditional to the <code>componentDidMount()</code> in the <code>UserStatus</code> component:</p>
<div class="highlight"><pre><code class="language-javascript" data-lang="javascript"><span class="nx">componentDidMount</span><span class="p">()</span> <span class="p">{</span>
  <span class="k">if</span> <span class="p">(</span><span class="k">this</span><span class="p">.</span><span class="nx">props</span><span class="p">.</span><span class="nx">isAuthenticated</span><span class="p">)</span> <span class="p">{</span>
    <span class="k">this</span><span class="p">.</span><span class="nx">getUserStatus</span><span class="p">();</span>
  <span class="p">}</span>
<span class="p">}</span>
</code></pre></div>
<p>Commit your code.</p>


          
  <br><br>
  <a class="twitter-share-button" data-show-count="false" href="https://twitter.com/intent/tweet?text=Microservices with Docker, Flask, and React - React Authentication&amp;url=http%3A%2F%2Ftestdriven.io/part-three-react-authentication&amp;via=RealPython" rel="nofollow" target="_blank" title="Share on Twitter"></a><script async src="//platform.twitter.com/widgets.js" charset="utf-8"></script>



          <div class="page-nav">
            
              <a class="prev btn left-align" href="/part-three-react-bootstrap">&laquo; React Bootstrap</a>
            
            
              <a class="next btn right-align" href="/part-three-authorization">Authorization &raquo;</a>
            
          </div>

        </div>

      </div>
    </div>

     <footer class="page-footer white">
  <div class="container footer-container center-align">
    <ul>
      <li>Content by Michael Herman (michael@realpython.com)</li>
      <li>&copy; Copyright 2017 <a href="http://realpython.com">Real Python</a></li>
    </ul>
  </div>
</footer>


    <script type="text/javascript" src="//code.jquery.com/jquery-2.1.1.min.js"></script>
    <script src="//cdnjs.cloudflare.com/ajax/libs/materialize/0.97.3/js/materialize.min.js"></script>

    
  <script>
    (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
    (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
    m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
    })(window,document,'script','https://www.google-analytics.com/analytics.js','ga');

    ga('create', 'UA-100160465-1', 'auto');
    ga('send', 'pageview');

  </script>



  </body>
</html>
