<!DOCTYPE html>
<html>

  <head>
  
    <title>Microservices with Docker, Flask, and React - Docker Hub</title>
  
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <link
    rel="stylesheet" href="//cdnjs.cloudflare.com/ajax/libs/materialize/0.97.3/css/materialize.min.css"
  >
  <link
    rel="stylesheet"
    href="https://fonts.googleapis.com/icon?family=Material+Icons"
  >
  <link
    rel="stylesheet"
    href="//maxcdn.bootstrapcdn.com/font-awesome/4.7.0/css/font-awesome.min.css"
  >
  <link
    href="//fonts.googleapis.com/css?family=Merriweather:900,900italic,300,300italic"
    rel="stylesheet"
    type="text/css"
  >
  <link
    href="//fonts.googleapis.com/css?family=Lato:900,300"
    rel="stylesheet"
    type="text/css"
  >
  <link
    href="//cdn-images.mailchimp.com/embedcode/classic-10_7.css"
    rel="stylesheet"
    type="text/css"
  >
  <link href="/assets/css/styles.css" rel="stylesheet">
  <script
    src="//code.jquery.com/jquery-2.2.4.min.js"
    integrity="sha256-BbhdlvQf/xTY9gja0Dq3HiwQF8LaCRTXxZKRutelT44="
    crossorigin="anonymous"
  ></script>
  <script
    type="text/javascript"
    src="/assets/js/main.js"
  ></script>
</head>


  <body>

    <nav class="red darken-1">
  <div class="nav-wrapper">
    <a href="/" class="brand-logo center hide-on-small-and-down">
      Test Driven Development Courses
    </a>
    <a href="/" class="brand-logo hide-on-med-and-up">
      TDD Courses
    </a>
    <ul class="right">
      <li class="hide-on-med-and-down">
        <a  href="/course-contents">Contents</a>
      </li>
      <li class="hide-on-large-only">
        <a href="/course-contents">TOC</a>
      </li>
    </ul>
  </div>
</nav>


    <br>

    <div class="container">
      <div class="row">

        <div class="col m3 hide-on-small-and-down">
  <br>
  <div id="toc-block" class="collection hide-on-small-and-down">
    <ul class="collapsible collapsible-accordion">
      
        
          <li>
            <h5 data-part="1" class="collapsible-header  waves-effect waves-teal">
              Part 1
            </h5>
            <div class="collapsible-body">
        
        <ul>
          <li>
            
              <a
                class="collection-item"
                href="/part-one-intro"
              >Introduction</a>
            
          </li>
        </ul>
      
        
        <ul>
          <li>
            
              <a
                class="collection-item"
                href="/part-one-getting-started"
              >Getting Started</a>
            
          </li>
        </ul>
      
        
        <ul>
          <li>
            
              <a
                class="collection-item"
                href="/part-one-docker-config"
              >Docker Config</a>
            
          </li>
        </ul>
      
        
        <ul>
          <li>
            
              <a
                class="collection-item"
                href="/part-one-postgres-setup"
              >Postgres Setup</a>
            
          </li>
        </ul>
      
        
        <ul>
          <li>
            
              <a
                class="collection-item"
                href="/part-one-test-setup"
              >Test Setup</a>
            
          </li>
        </ul>
      
        
        <ul>
          <li>
            
              <a
                class="collection-item"
                href="/part-one-flask-blueprints"
              >Flask Blueprints</a>
            
          </li>
        </ul>
      
        
        <ul>
          <li>
            
              <a
                class="collection-item"
                href="/part-one-restful-routes"
              >RESTful Routes</a>
            
          </li>
        </ul>
      
        
        <ul>
          <li>
            
              <a
                class="collection-item"
                href="/part-one-aws-deployment"
              >Deployment</a>
            
          </li>
        </ul>
      
        
        <ul>
          <li>
            
              <a
                class="collection-item"
                href="/part-one-jinja-templates"
              >Jinja Templates</a>
            
          </li>
        </ul>
      
        
        <ul>
          <li>
            
              <a
                class="collection-item"
                href="/part-one-workflow"
              >Workflow</a>
            
          </li>
        </ul>
      
        
          <li>
            <h5 data-part="2" class="collapsible-header  waves-effect waves-teal">
              Part 2
            </h5>
            <div class="collapsible-body">
        
        <ul>
          <li>
            
              <a
                class="collection-item"
                href="/part-two-intro"
              >Introduction</a>
            
          </li>
        </ul>
      
        
        <ul>
          <li>
            
              <a
                class="collection-item"
                href="/part-two-project-refactor"
              >Project Refactor</a>
            
          </li>
        </ul>
      
        
        <ul>
          <li>
            
              <a
                class="collection-item"
                href="/part-two-code-coverage"
              >Code Coverage</a>
            
          </li>
        </ul>
      
        
        <ul>
          <li>
            
              <a
                class="collection-item"
                href="/part-two-continuous-integration"
              >Continuous Integration</a>
            
          </li>
        </ul>
      
        
        <ul>
          <li>
            
              <a
                class="collection-item"
                href="/part-two-react-setup"
              >React Setup</a>
            
          </li>
        </ul>
      
        
        <ul>
          <li>
            
              <a
                class="collection-item"
                href="/part-two-flask-deployment"
              >Flask Deployment</a>
            
          </li>
        </ul>
      
        
        <ul>
          <li>
            
              <a
                class="collection-item"
                href="/part-two-react-forms"
              >React Forms</a>
            
          </li>
        </ul>
      
        
        <ul>
          <li>
            
              <a
                class="collection-item"
                href="/part-two-react-docker"
              >React and Docker</a>
            
          </li>
        </ul>
      
        
        <ul>
          <li>
            
              <a
                class="collection-item"
                href="/part-two-flask-refactor"
              >Flask Refactor</a>
            
          </li>
        </ul>
      
        
          <li>
            <h5 data-part="3" class="collapsible-header  waves-effect waves-teal">
              Part 3
            </h5>
            <div class="collapsible-body">
        
        <ul>
          <li>
            
              <a
                class="collection-item"
                href="/part-three-intro"
              >Introduction</a>
            
          </li>
        </ul>
      
        
        <ul>
          <li>
            
              <a
                class="collection-item"
                href="/part-three-flask-migrate"
              >Flask Migrate</a>
            
          </li>
        </ul>
      
        
        <ul>
          <li>
            
              <a
                class="collection-item"
                href="/part-three-flask-bcrypt"
              >Flask Bcrypt</a>
            
          </li>
        </ul>
      
        
        <ul>
          <li>
            
              <a
                class="collection-item"
                href="/part-three-jwt-setup"
              >JWT Setup</a>
            
          </li>
        </ul>
      
        
        <ul>
          <li>
            
              <a
                class="collection-item"
                href="/part-three-auth-routes"
              >Auth Routes</a>
            
          </li>
        </ul>
      
        
        <ul>
          <li>
            
              <a
                class="collection-item"
                href="/part-three-react-router"
              >React Router</a>
            
          </li>
        </ul>
      
        
        <ul>
          <li>
            
              <a
                class="collection-item"
                href="/part-three-react-bootstrap"
              >React Bootstrap</a>
            
          </li>
        </ul>
      
        
        <ul>
          <li>
            
              <a
                class="collection-item"
                href="/part-three-react-authentication"
              >React Authentication</a>
            
          </li>
        </ul>
      
        
        <ul>
          <li>
            
              <a
                class="collection-item"
                href="/part-three-authorization"
              >Authorization</a>
            
          </li>
        </ul>
      
        
        <ul>
          <li>
            
              <a
                class="collection-item"
                href="/part-three-update-component"
              >Update Component</a>
            
          </li>
        </ul>
      
        
        <ul>
          <li>
            
              <a
                class="collection-item"
                href="/part-three-update-docker"
              >Update Docker</a>
            
          </li>
        </ul>
      
        
          <li>
            <h5 data-part="4" class="collapsible-header  waves-effect waves-teal">
              Part 4
            </h5>
            <div class="collapsible-body">
        
        <ul>
          <li>
            
              <a
                class="collection-item"
                href="/part-four-intro"
              >Introduction</a>
            
          </li>
        </ul>
      
        
        <ul>
          <li>
            
              <a
                class="collection-item"
                href="/part-four-e2e-test-setup"
              >End-to-End Test Setup</a>
            
          </li>
        </ul>
      
        
        <ul>
          <li>
            
              <a
                class="collection-item"
                href="/part-four-e2e-test-specs"
              >End-to-End Test Specs</a>
            
          </li>
        </ul>
      
        
        <ul>
          <li>
            
              <a
                class="collection-item"
                href="/part-four-react-component-refactor"
              >React Component Refactor</a>
            
          </li>
        </ul>
      
        
        <ul>
          <li>
            
              <a
                class="collection-item"
                href="/part-four-react-form-validation"
              >React Form Validation</a>
            
          </li>
        </ul>
      
        
        <ul>
          <li>
            
              <a
                class="collection-item"
                href="/part-four-react-flash-messages"
              >React Flash Messaging</a>
            
          </li>
        </ul>
      
        
        <ul>
          <li>
            
              <a
                class="collection-item"
                href="/part-four-swagger-setup"
              >Swagger Setup</a>
            
          </li>
        </ul>
      
        
        <ul>
          <li>
            
              <a
                class="collection-item"
                href="/part-four-staging-environment"
              >Staging Environment</a>
            
          </li>
        </ul>
      
        
        <ul>
          <li>
            
              <a
                class="collection-item"
                href="/part-four-workflow"
              >Workflow</a>
            
          </li>
        </ul>
      
        
          <li>
            <h5 data-part="5" class="collapsible-header  waves-effect waves-teal">
              Part 5
            </h5>
            <div class="collapsible-body">
        
        <ul>
          <li>
            
              <a
                class="collection-item"
                href="/part-five-intro"
              >Introduction</a>
            
          </li>
        </ul>
      
        
        <ul>
          <li>
            
              <a
                class="collection-item"
                href="/part-five-docker-hub"
              >Docker Hub</a>
            
          </li>
        </ul>
      
        
        <ul>
          <li>
            
              <a
                class="collection-item"
                href="/part-five-ec2-container-registry"
              >EC2 Container Registry</a>
            
          </li>
        </ul>
      
        
        <ul>
          <li>
            
              <a
                class="collection-item"
                href="/part-five-ec2-container-service"
              >EC2 Container Service</a>
            
          </li>
        </ul>
      
        
        <ul>
          <li>
            
              <a
                class="collection-item"
                href="/part-five-elastic-load-balancing"
              >Elastic Load Balancing</a>
            
          </li>
        </ul>
      
        
        <ul>
          <li>
            
              <a
                class="collection-item"
                href="/part-five-ec2-container-service-staging"
              >ECS Staging</a>
            
          </li>
        </ul>
      
        
        <ul>
          <li>
            
              <a
                class="collection-item"
                href="/part-five-ec2-relational-database-service"
              >Setting up RDS</a>
            
          </li>
        </ul>
      
        
        <ul>
          <li>
            
              <a
                class="collection-item"
                href="/part-five-ec2-container-service-production"
              >ECS Production</a>
            
          </li>
        </ul>
      
        
        <ul>
          <li>
            
              <a
                class="collection-item"
                href="/part-five-workflow"
              >Workflow</a>
            
          </li>
        </ul>
      
        
          <li>
            <h5 data-part="6" class="collapsible-header  waves-effect waves-teal">
              Part 6
            </h5>
            <div class="collapsible-body">
        
        <ul>
          <li>
            
              <a
                class="collection-item"
                href="/part-six-intro"
              >Introduction</a>
            
          </li>
        </ul>
      
        
        <ul>
          <li>
            
              <a
                class="collection-item"
                href="/part-six-eval-service-setup"
              >Eval Service Setup</a>
            
          </li>
        </ul>
      
        
        <ul>
          <li>
            
              <a
                class="collection-item"
                href="/part-six-scores-api-database"
              >Scores API Database</a>
            
          </li>
        </ul>
      
        
        <ul>
          <li>
            
              <a
                class="collection-item"
                href="/part-six-scores-api-routes"
              >Scores API Routes</a>
            
          </li>
        </ul>
      
        
        <ul>
          <li>
            
              <a
                class="collection-item"
                href="/part-six-exercises-api"
              >Exercises API</a>
            
          </li>
        </ul>
      
        
        <ul>
          <li>
            
              <a
                class="collection-item"
                href="/part-six-react-refactor"
              >React Refactor</a>
            
          </li>
        </ul>
      
        
        <ul>
          <li>
            
              <a
                class="collection-item"
                href="/part-six-e2e-tests-refactor"
              >End-to-End Tests Refactor</a>
            
          </li>
        </ul>
      
        
        <ul>
          <li>
            
              <a
                class="collection-item"
                href="/part-six-react-ace-code-editor"
              >React Ace Code Editor</a>
            
          </li>
        </ul>
      
        
        <ul>
          <li>
            
              <a
                class="collection-item"
                href="/part-six-code-evaluation"
              >Code Evaluation</a>
            
          </li>
        </ul>
      
        
        <ul>
          <li>
            
              <a
                class="collection-item"
                href="/part-six-ecs-deployment"
              >ECS Deployment</a>
            
          </li>
        </ul>
      
        
        <ul>
          <li>
            
              <a
                class="collection-item"
                href="/part-six-next-steps"
              >Next Steps</a>
            
          </li>
        </ul>
      
    </div>
  </li>
    </ul>
  </div>
</div>


        <div class="col m9 hide-on-small-and-down">

          <h2>Docker Hub</h2>

          
            <h5>Part 5, Lesson 2</h5>

            <div class="page-nav">
              
                <a class="prev btn left-align" href="/part-five-intro">&laquo; Introduction</a>
              
              
                <a class="next btn right-align" href="/part-five-ec2-container-registry">EC2 Container Registry &raquo;</a>
              
            </div>

            <br><br>

          


          <p>Let&#39;s update the CI process to include <a href="https://docs.docker.com/docker-hub/">Docker Hub</a>, an image registry:</p>

<ol>
<li>Create a new feature branch</li>
<li>Open PR against the <code>master</code> branch</li>
<li>New build is triggered on Travis</li>
<li>If the tests pass, images are created and pushed to Docker Hub</li>
</ol>

<h4 id="docker-hub">Docker Hub</h4>

<p><a href="https://docs.docker.com/docker-hub/">Docker Hub</a> is an image registry, which is simply a service that stores Docker images - basically GitHub for Docker images.</p>

<p>Sign up for <a href="https://hub.docker.com/">Docker Hub</a> (if necessary), and then define the following environment variables within the <a href="https://docs.travis-ci.com/user/environment-variables/#Defining-Variables-in-Repository-Settings">Repository Settings</a> for <em>flask-microservices-main</em>:</p>

<ol>
<li>DOCKER_EMAIL - YOUREMAILATSOMETHING.COM</li>
<li>DOCKER_ID - YOUR_ID/USERNAME</li>
<li>DOCKER_PASSWORD - YOUR_PASSWORD</li>
</ol>

<p>Next, create four new <a href="https://stackoverflow.com/a/34004418/1799408">repositories</a> on Docker Hub:</p>

<ol>
<li><em>flask-microservices-users</em></li>
<li><em>flask-microservices-users_db</em></li>
<li><em>flask-microservices-client</em></li>
<li><em>flask-microservices-swagger</em></li>
<li><em>flask-microservices-nginx</em></li>
</ol>

<h4 id="users">Users</h4>

<p>Let&#39;s update the <em>.travis.yml</em> file in <em>flask-microservices-main</em>:</p>
<div class="highlight"><pre><code class="language-yaml" data-lang="yaml"><span class="l-Scalar-Plain">language</span><span class="p-Indicator">:</span> <span class="l-Scalar-Plain">node_js</span>
<span class="l-Scalar-Plain">node_js</span><span class="p-Indicator">:</span> <span class="s">&#39;7&#39;</span>

<span class="l-Scalar-Plain">before_install</span><span class="p-Indicator">:</span>
  <span class="p-Indicator">-</span> <span class="l-Scalar-Plain">stty cols 80</span>

<span class="l-Scalar-Plain">dist</span><span class="p-Indicator">:</span> <span class="l-Scalar-Plain">trusty</span>
<span class="l-Scalar-Plain">sudo</span><span class="p-Indicator">:</span> <span class="l-Scalar-Plain">required</span>

<span class="l-Scalar-Plain">addons</span><span class="p-Indicator">:</span>
  <span class="l-Scalar-Plain">apt</span><span class="p-Indicator">:</span>
    <span class="l-Scalar-Plain">sources</span><span class="p-Indicator">:</span>
     <span class="p-Indicator">-</span> <span class="l-Scalar-Plain">google-chrome</span>
    <span class="l-Scalar-Plain">packages</span><span class="p-Indicator">:</span>
     <span class="p-Indicator">-</span> <span class="l-Scalar-Plain">google-chrome-stable</span>

<span class="l-Scalar-Plain">services</span><span class="p-Indicator">:</span>
  <span class="p-Indicator">-</span> <span class="l-Scalar-Plain">docker</span>

<span class="l-Scalar-Plain">env</span><span class="p-Indicator">:</span>
  <span class="l-Scalar-Plain">global</span><span class="p-Indicator">:</span>
    <span class="p-Indicator">-</span> <span class="l-Scalar-Plain">DOCKER_COMPOSE_VERSION=1.11.2</span>
    <span class="p-Indicator">-</span> <span class="l-Scalar-Plain">COMMIT=${TRAVIS_COMMIT::8}</span>
    <span class="p-Indicator">-</span> <span class="l-Scalar-Plain">USERS=flask-microservices-users</span>
    <span class="p-Indicator">-</span> <span class="l-Scalar-Plain">USERS_REPO=https://github.com/realpython/$USERS.git</span>

<span class="l-Scalar-Plain">before_install</span><span class="p-Indicator">:</span>
  <span class="p-Indicator">-</span> <span class="l-Scalar-Plain">sudo rm /usr/local/bin/docker-compose</span>
  <span class="p-Indicator">-</span> <span class="l-Scalar-Plain">curl -L https://github.com/docker/compose/releases/download/${DOCKER_COMPOSE_VERSION}/docker-compose-`uname -s`-`uname -m` &gt; docker-compose</span>
  <span class="p-Indicator">-</span> <span class="l-Scalar-Plain">chmod +x docker-compose</span>
  <span class="p-Indicator">-</span> <span class="l-Scalar-Plain">sudo mv docker-compose /usr/local/bin</span>

<span class="l-Scalar-Plain">before_script</span><span class="p-Indicator">:</span>
  <span class="p-Indicator">-</span> <span class="l-Scalar-Plain">export TEST_URL=http://127.0.0.1</span>
  <span class="p-Indicator">-</span> <span class="l-Scalar-Plain">export REACT_APP_USERS_SERVICE_URL=http://127.0.0.1</span>
  <span class="p-Indicator">-</span> <span class="l-Scalar-Plain">export SECRET_KEY=my_precious</span>
  <span class="p-Indicator">-</span> <span class="l-Scalar-Plain">export DISPLAY=:99.0</span>
  <span class="p-Indicator">-</span> <span class="l-Scalar-Plain">sh -e /etc/init.d/xvfb start</span>
  <span class="p-Indicator">-</span> <span class="l-Scalar-Plain">sleep 3</span>
  <span class="p-Indicator">-</span> <span class="l-Scalar-Plain">docker-compose -f docker-compose-ci.yml up -d --build</span>

<span class="l-Scalar-Plain">script</span><span class="p-Indicator">:</span>
  <span class="p-Indicator">-</span> <span class="l-Scalar-Plain">docker-compose -f docker-compose-ci.yml run users-service python manage.py test</span>
  <span class="p-Indicator">-</span> <span class="l-Scalar-Plain">docker-compose -f docker-compose-ci.yml run users-service python manage.py recreate_db</span>
  <span class="p-Indicator">-</span> <span class="l-Scalar-Plain">testcafe chrome e2e</span>

<span class="l-Scalar-Plain">after_script</span><span class="p-Indicator">:</span>
  <span class="p-Indicator">-</span> <span class="l-Scalar-Plain">docker-compose down</span>

<span class="l-Scalar-Plain">after_success</span><span class="p-Indicator">:</span>
  <span class="p-Indicator">-</span> <span class="l-Scalar-Plain">docker login -e $DOCKER_EMAIL -u $DOCKER_ID -p $DOCKER_PASSWORD</span>
  <span class="p-Indicator">-</span> <span class="l-Scalar-Plain">export TAG=`if [ &quot;$TRAVIS_BRANCH&quot; == &quot;master&quot; ]; then echo &quot;latest&quot;; else echo $TRAVIS_BRANCH ; fi`</span>
  <span class="c1"># users</span>
  <span class="p-Indicator">-</span> <span class="l-Scalar-Plain">docker build $USERS_REPO -t $USERS:$COMMIT</span>
  <span class="p-Indicator">-</span> <span class="l-Scalar-Plain">docker tag $USERS:$COMMIT $DOCKER_ID/$USERS:$TAG</span>
  <span class="p-Indicator">-</span> <span class="l-Scalar-Plain">docker push $DOCKER_ID/$USERS</span>
</code></pre></div>
<p>What changed?</p>

<ol>
<li>Environment variables:

<ol>
<li><code>COMMIT=${TRAVIS_COMMIT::8}</code> - sets a new environment variable, called <code>COMMIT</code>, which contains the first 8 characters of the git commit hash.</li>
<li><code>USERS</code> - defines the name of the Git repo and image name.</li>
<li><code>USERS_REPO</code> - defines the full GitHub URL.</li>
</ol></li>
<li>Finally, within <code>after_success</code>, we login to the Docker Hub registry, generate a tag based on the branch name, build an image from the <em>Dockerfile</em>, tag the image, and then push the image to Docker Hub.</li>
</ol>

<blockquote>
<p>Update the value of <code>USERS_REPO</code> to your repo.</p>
</blockquote>

<p>We also referenced a new Docker Compose file, <em>docker-compose-ci.yml</em>:</p>
<div class="highlight"><pre><code class="language-yaml" data-lang="yaml"><span class="l-Scalar-Plain">version</span><span class="p-Indicator">:</span> <span class="s">&#39;2.1&#39;</span>

<span class="l-Scalar-Plain">services</span><span class="p-Indicator">:</span>

  <span class="l-Scalar-Plain">users-db</span><span class="p-Indicator">:</span>
    <span class="l-Scalar-Plain">container_name</span><span class="p-Indicator">:</span> <span class="l-Scalar-Plain">users-db</span>
    <span class="l-Scalar-Plain">build</span><span class="p-Indicator">:</span>
      <span class="l-Scalar-Plain">context</span><span class="p-Indicator">:</span> <span class="l-Scalar-Plain">https://github.com/realpython/flask-microservices-users.git#master:project/db</span>
    <span class="l-Scalar-Plain">ports</span><span class="p-Indicator">:</span>
      <span class="p-Indicator">-</span> <span class="l-Scalar-Plain">5435:5432</span>  <span class="c1"># expose ports - HOST:CONTAINER</span>
    <span class="l-Scalar-Plain">environment</span><span class="p-Indicator">:</span>
      <span class="p-Indicator">-</span> <span class="l-Scalar-Plain">POSTGRES_USER=postgres</span>
      <span class="p-Indicator">-</span> <span class="l-Scalar-Plain">POSTGRES_PASSWORD=postgres</span>
    <span class="l-Scalar-Plain">healthcheck</span><span class="p-Indicator">:</span>
      <span class="l-Scalar-Plain">test</span><span class="p-Indicator">:</span> <span class="l-Scalar-Plain">exit 0</span>

  <span class="l-Scalar-Plain">users-service</span><span class="p-Indicator">:</span>
    <span class="l-Scalar-Plain">container_name</span><span class="p-Indicator">:</span> <span class="l-Scalar-Plain">users-service</span>
    <span class="l-Scalar-Plain">build</span><span class="p-Indicator">:</span>
      <span class="l-Scalar-Plain">context</span><span class="p-Indicator">:</span> <span class="l-Scalar-Plain">https://github.com/realpython/flask-microservices-users.git</span>
    <span class="l-Scalar-Plain">expose</span><span class="p-Indicator">:</span>
      <span class="p-Indicator">-</span> <span class="s">&#39;5000&#39;</span>
    <span class="l-Scalar-Plain">environment</span><span class="p-Indicator">:</span>
      <span class="p-Indicator">-</span> <span class="l-Scalar-Plain">APP_SETTINGS=project.config.StagingConfig</span>
      <span class="p-Indicator">-</span> <span class="l-Scalar-Plain">DATABASE_URL=postgres://postgres:postgres@users-db:5432/users_staging</span>
      <span class="p-Indicator">-</span> <span class="l-Scalar-Plain">DATABASE_TEST_URL=postgres://postgres:postgres@users-db:5432/users_test</span>
      <span class="p-Indicator">-</span> <span class="l-Scalar-Plain">SECRET_KEY=${SECRET_KEY}</span>
    <span class="l-Scalar-Plain">depends_on</span><span class="p-Indicator">:</span>
      <span class="l-Scalar-Plain">users-db</span><span class="p-Indicator">:</span>
        <span class="l-Scalar-Plain">condition</span><span class="p-Indicator">:</span> <span class="l-Scalar-Plain">service_healthy</span>
    <span class="l-Scalar-Plain">links</span><span class="p-Indicator">:</span>
      <span class="p-Indicator">-</span> <span class="l-Scalar-Plain">users-db</span>
    <span class="l-Scalar-Plain">command</span><span class="p-Indicator">:</span> <span class="l-Scalar-Plain">gunicorn -b 0.0.0.0:5000 manage:app</span>

  <span class="l-Scalar-Plain">nginx</span><span class="p-Indicator">:</span>
    <span class="l-Scalar-Plain">container_name</span><span class="p-Indicator">:</span> <span class="l-Scalar-Plain">nginx</span>
    <span class="l-Scalar-Plain">build</span><span class="p-Indicator">:</span> <span class="l-Scalar-Plain">./nginx/</span>
    <span class="l-Scalar-Plain">restart</span><span class="p-Indicator">:</span> <span class="l-Scalar-Plain">always</span>
    <span class="l-Scalar-Plain">ports</span><span class="p-Indicator">:</span>
      <span class="p-Indicator">-</span> <span class="l-Scalar-Plain">80:80</span>
    <span class="l-Scalar-Plain">depends_on</span><span class="p-Indicator">:</span>
      <span class="l-Scalar-Plain">users-service</span><span class="p-Indicator">:</span>
        <span class="l-Scalar-Plain">condition</span><span class="p-Indicator">:</span> <span class="l-Scalar-Plain">service_started</span>
      <span class="l-Scalar-Plain">web-service</span><span class="p-Indicator">:</span>
        <span class="l-Scalar-Plain">condition</span><span class="p-Indicator">:</span> <span class="l-Scalar-Plain">service_started</span>
    <span class="l-Scalar-Plain">links</span><span class="p-Indicator">:</span>
      <span class="p-Indicator">-</span> <span class="l-Scalar-Plain">users-service</span>
      <span class="p-Indicator">-</span> <span class="l-Scalar-Plain">web-service</span>

  <span class="l-Scalar-Plain">web-service</span><span class="p-Indicator">:</span>
    <span class="l-Scalar-Plain">container_name</span><span class="p-Indicator">:</span> <span class="l-Scalar-Plain">web-service</span>
    <span class="l-Scalar-Plain">build</span><span class="p-Indicator">:</span>
      <span class="l-Scalar-Plain">context</span><span class="p-Indicator">:</span> <span class="l-Scalar-Plain">https://github.com/realpython/flask-microservices-client.git</span>
      <span class="l-Scalar-Plain">args</span><span class="p-Indicator">:</span>
        <span class="p-Indicator">-</span> <span class="l-Scalar-Plain">NODE_ENV=development</span>
        <span class="p-Indicator">-</span> <span class="l-Scalar-Plain">REACT_APP_USERS_SERVICE_URL=${REACT_APP_USERS_SERVICE_URL}</span>
    <span class="l-Scalar-Plain">ports</span><span class="p-Indicator">:</span>
      <span class="p-Indicator">-</span> <span class="s">&#39;9000:9000&#39;</span> <span class="c1"># expose ports - HOST:CONTAINER</span>
    <span class="l-Scalar-Plain">depends_on</span><span class="p-Indicator">:</span>
      <span class="l-Scalar-Plain">users-service</span><span class="p-Indicator">:</span>
        <span class="l-Scalar-Plain">condition</span><span class="p-Indicator">:</span> <span class="l-Scalar-Plain">service_started</span>
    <span class="l-Scalar-Plain">links</span><span class="p-Indicator">:</span>
      <span class="p-Indicator">-</span> <span class="l-Scalar-Plain">users-service</span>

  <span class="l-Scalar-Plain">swagger</span><span class="p-Indicator">:</span>
    <span class="l-Scalar-Plain">container_name</span><span class="p-Indicator">:</span> <span class="l-Scalar-Plain">swagger</span>
    <span class="l-Scalar-Plain">build</span><span class="p-Indicator">:</span>
      <span class="l-Scalar-Plain">context</span><span class="p-Indicator">:</span> <span class="l-Scalar-Plain">https://github.com/realpython/flask-microservices-swagger.git</span>
    <span class="l-Scalar-Plain">ports</span><span class="p-Indicator">:</span>
      <span class="p-Indicator">-</span> <span class="s">&#39;8080:8080&#39;</span> <span class="c1"># expose ports - HOST:CONTAINER</span>
    <span class="l-Scalar-Plain">environment</span><span class="p-Indicator">:</span>
      <span class="p-Indicator">-</span> <span class="l-Scalar-Plain">API_URL=https://raw.githubusercontent.com/realpython/flask-microservices-swagger/master/swagger.json</span>
    <span class="l-Scalar-Plain">depends_on</span><span class="p-Indicator">:</span>
      <span class="l-Scalar-Plain">users-service</span><span class="p-Indicator">:</span>
        <span class="l-Scalar-Plain">condition</span><span class="p-Indicator">:</span> <span class="l-Scalar-Plain">service_started</span>
</code></pre></div>
<p>To test, commit your code and then push to GitHub. Make sure the build passes on Travis and that a new <a href="https://docs.docker.com/docker-hub/repos/#viewing-repository-tags">tag</a> was added to Docker Hub.</p>

<h4 id="users-db">Users DB</h4>

<p>For the users database, add the environment variables to <em>.travis.yml</em>:</p>
<div class="highlight"><pre><code class="language-yaml" data-lang="yaml"><span class="p-Indicator">-</span> <span class="l-Scalar-Plain">USERS_DB=flask-microservices-users_db</span>
<span class="p-Indicator">-</span> <span class="l-Scalar-Plain">USERS_DB_REPO=https://github.com/realpython/$USERS.git#master:project/db</span>
</code></pre></div>
<p>Then add the following to <code>after_success</code>:</p>
<div class="highlight"><pre><code class="language-yaml" data-lang="yaml"><span class="c1"># users db</span>
<span class="p-Indicator">-</span> <span class="l-Scalar-Plain">docker build $USERS_DB_REPO -t $USERS_DB:$COMMIT</span>
<span class="p-Indicator">-</span> <span class="l-Scalar-Plain">docker tag $USERS_DB:$COMMIT $DOCKER_ID/$USERS_DB:$TAG</span>
<span class="p-Indicator">-</span> <span class="l-Scalar-Plain">docker push $DOCKER_ID/$USERS_DB</span>
</code></pre></div>
<p>Commit, push, and ensure all is well.</p>

<p>For each of the next three services, we need to make the updates to <em>.travis.yml</em>, commit and push the code, and then ensure the build passes and the tag is added to Docker Hub....</p>

<h4 id="web">Web</h4>

<p>Environment variables:</p>
<div class="highlight"><pre><code class="language-yaml" data-lang="yaml"><span class="p-Indicator">-</span> <span class="l-Scalar-Plain">CLIENT=flask-microservices-client</span>
<span class="p-Indicator">-</span> <span class="l-Scalar-Plain">CLIENT_REPO=https://github.com/realpython/$CLIENT.git</span>
</code></pre></div>
<p><code>after_success</code>:</p>
<div class="highlight"><pre><code class="language-yaml" data-lang="yaml"><span class="c1"># client</span>
<span class="p-Indicator">-</span> <span class="l-Scalar-Plain">docker build $CLIENT_REPO -t $CLIENT:$COMMIT</span>
<span class="p-Indicator">-</span> <span class="l-Scalar-Plain">docker tag $CLIENT:$COMMIT $DOCKER_ID/$CLIENT:$TAG</span>
<span class="p-Indicator">-</span> <span class="l-Scalar-Plain">docker push $DOCKER_ID/$CLIENT</span>
</code></pre></div>
<h4 id="swagger">Swagger</h4>

<p>Environment variables:</p>
<div class="highlight"><pre><code class="language-yaml" data-lang="yaml"><span class="p-Indicator">-</span> <span class="l-Scalar-Plain">SWAGGER=flask-microservices-swagger</span>
<span class="p-Indicator">-</span> <span class="l-Scalar-Plain">SWAGGER_REPO=https://github.com/realpython/$SWAGGER.git</span>
</code></pre></div>
<p><code>after_success</code>:</p>
<div class="highlight"><pre><code class="language-yaml" data-lang="yaml"><span class="c1"># swagger</span>
<span class="p-Indicator">-</span> <span class="l-Scalar-Plain">docker build $SWAGGER_REPO -t $SWAGGER:$COMMIT</span>
<span class="p-Indicator">-</span> <span class="l-Scalar-Plain">docker tag $SWAGGER:$COMMIT $DOCKER_ID/$SWAGGER:$TAG</span>
<span class="p-Indicator">-</span> <span class="l-Scalar-Plain">docker push $DOCKER_ID/$SWAGGER</span>
</code></pre></div>
<h4 id="nginx">Nginx</h4>

<p>Environment variables:</p>
<div class="highlight"><pre><code class="language-yaml" data-lang="yaml"><span class="p-Indicator">-</span> <span class="l-Scalar-Plain">NGINX=flask-microservices-nginx</span>
<span class="p-Indicator">-</span> <span class="l-Scalar-Plain">NGINX_REPO=https://github.com/realpython/flask-microservices-main.git#master:nginx</span>
</code></pre></div>
<p><code>after_success</code>:</p>
<div class="highlight"><pre><code class="language-yaml" data-lang="yaml"><span class="c1"># nginx</span>
<span class="p-Indicator">-</span> <span class="l-Scalar-Plain">docker build $NGINX_REPO -t $NGINX:$COMMIT</span>
<span class="p-Indicator">-</span> <span class="l-Scalar-Plain">docker tag $NGINX:$COMMIT $DOCKER_ID/$NGINX:$TAG</span>
<span class="p-Indicator">-</span> <span class="l-Scalar-Plain">docker push $DOCKER_ID/$NGINX</span>
</code></pre></div>
<h4 id="scripts">Scripts</h4>

<p>Since we only want the <code>after_success</code> to run when the branch is <code>master</code>, let&#39;s create a simple shell script:</p>
<div class="highlight"><pre><code class="language-sh" data-lang="sh"><span class="c">#!/bin/sh</span>

<span class="k">if</span> <span class="o">[</span> <span class="s2">&quot;$TRAVIS_BRANCH&quot;</span> <span class="o">==</span> <span class="s2">&quot;master&quot;</span> <span class="o">]</span><span class="p">;</span> <span class="k">then</span>
  docker login -e <span class="nv">$DOCKER_EMAIL</span> -u <span class="nv">$DOCKER_ID</span> -p <span class="nv">$DOCKER_PASSWORD</span>
  <span class="nb">export </span><span class="nv">TAG</span><span class="o">=</span><span class="sb">`</span><span class="k">if</span> <span class="o">[</span> <span class="s2">&quot;$TRAVIS_BRANCH&quot;</span> <span class="o">==</span> <span class="s2">&quot;master&quot;</span> <span class="o">]</span><span class="p">;</span> <span class="k">then</span> <span class="nb">echo</span> <span class="s2">&quot;latest&quot;</span><span class="p">;</span> <span class="k">else</span> <span class="nb">echo</span> <span class="nv">$TRAVIS_BRANCH</span> <span class="p">;</span> <span class="k">fi</span><span class="sb">`</span>
  <span class="c"># users</span>
  docker build <span class="nv">$USERS_REPO</span> -t <span class="nv">$USERS</span>:<span class="nv">$COMMIT</span>
  docker tag <span class="nv">$USERS</span>:<span class="nv">$COMMIT</span> <span class="nv">$DOCKER_ID</span>/<span class="nv">$USERS</span>:<span class="nv">$TAG</span>
  docker push <span class="nv">$DOCKER_ID</span>/<span class="nv">$USERS</span>
  <span class="c"># users db</span>
  docker build <span class="nv">$USERS_DB_REPO</span> -t <span class="nv">$USERS_DB</span>:<span class="nv">$COMMIT</span>
  docker tag <span class="nv">$USERS_DB</span>:<span class="nv">$COMMIT</span> <span class="nv">$DOCKER_ID</span>/<span class="nv">$USERS_DB</span>:<span class="nv">$TAG</span>
  docker push <span class="nv">$DOCKER_ID</span>/<span class="nv">$USERS_DB</span>
  <span class="c"># client</span>
  docker build <span class="nv">$CLIENT_REPO</span> -t <span class="nv">$CLIENT</span>:<span class="nv">$COMMIT</span>
  docker tag <span class="nv">$CLIENT</span>:<span class="nv">$COMMIT</span> <span class="nv">$DOCKER_ID</span>/<span class="nv">$CLIENT</span>:<span class="nv">$TAG</span>
  docker push <span class="nv">$DOCKER_ID</span>/<span class="nv">$CLIENT</span>
  <span class="c"># swagger</span>
  docker build <span class="nv">$SWAGGER_REPO</span> -t <span class="nv">$SWAGGER</span>:<span class="nv">$COMMIT</span>
  docker tag <span class="nv">$SWAGGER</span>:<span class="nv">$COMMIT</span> <span class="nv">$DOCKER_ID</span>/<span class="nv">$SWAGGER</span>:<span class="nv">$TAG</span>
  docker push <span class="nv">$DOCKER_ID</span>/<span class="nv">$SWAGGER</span>
  <span class="c"># nginx</span>
  docker build <span class="nv">$NGINX_REPO</span> -t <span class="nv">$NGINX</span>:<span class="nv">$COMMIT</span>
  docker tag <span class="nv">$NGINX</span>:<span class="nv">$COMMIT</span> <span class="nv">$DOCKER_ID</span>/<span class="nv">$NGINX</span>:<span class="nv">$TAG</span>
  docker push <span class="nv">$DOCKER_ID</span>/<span class="nv">$NGINX</span>
<span class="k">fi</span>
</code></pre></div>
<p>Save this as <em>docker_push.sh</em> within <em>flask-microservices-main</em>, and then update <code>after_success</code>:</p>
<div class="highlight"><pre><code class="language-yaml" data-lang="yaml"><span class="l-Scalar-Plain">after_success</span><span class="p-Indicator">:</span>
  <span class="p-Indicator">-</span> <span class="l-Scalar-Plain">bash ./docker_push.sh</span>
</code></pre></div>
<p>We can speed up the building of new images by first pulling in the latest image from Docker Hub. Add a new script called <em>docker_build.sh</em> to the project root:</p>
<div class="highlight"><pre><code class="language-sh" data-lang="sh"><span class="c">#!/bin/sh</span>

docker login -e <span class="nv">$DOCKER_EMAIL</span> -u <span class="nv">$DOCKER_ID</span> -p <span class="nv">$DOCKER_PASSWORD</span>
docker pull <span class="nv">$DOCKER_ID</span>/<span class="nv">$USERS</span>
docker pull <span class="nv">$DOCKER_ID</span>/<span class="nv">$USERS_DB</span>
docker pull <span class="nv">$DOCKER_ID</span>/<span class="nv">$CLIENT</span>
docker pull <span class="nv">$DOCKER_ID</span>/<span class="nv">$SWAGGER</span>
docker pull <span class="nv">$DOCKER_ID</span>/<span class="nv">$NGINX</span>

docker-compose -f docker-compose-ci.yml up -d --build
</code></pre></div>
<blockquote>
<p>Want to speed things up even more? <a href="https://github.com/start-jsk/jsk_apc/commit/7c12afa1c8c460f1b148c6ca887203d915fa9846">Cache images on Travis</a>.</p>
</blockquote>

<p>Update the <code>before_script</code> in <em>.travis.yml</em>:</p>
<div class="highlight"><pre><code class="language-yaml" data-lang="yaml"><span class="l-Scalar-Plain">before_script</span><span class="p-Indicator">:</span>
  <span class="p-Indicator">-</span> <span class="l-Scalar-Plain">export TEST_URL=http://127.0.0.1</span>
  <span class="p-Indicator">-</span> <span class="l-Scalar-Plain">export REACT_APP_USERS_SERVICE_URL=http://127.0.0.1</span>
  <span class="p-Indicator">-</span> <span class="l-Scalar-Plain">export SECRET_KEY=my_precious</span>
  <span class="p-Indicator">-</span> <span class="l-Scalar-Plain">export DISPLAY=:99.0</span>
  <span class="p-Indicator">-</span> <span class="l-Scalar-Plain">sh -e /etc/init.d/xvfb start</span>
  <span class="p-Indicator">-</span> <span class="l-Scalar-Plain">sleep 3</span>
  <span class="p-Indicator">-</span> <span class="l-Scalar-Plain">bash ./docker_build.sh</span>
</code></pre></div>
<p>To test create a new branch feature branch and push your code to GitHub. A new build should be triggered, but it should not run any code within the <code>if</code> block within <em>docker_push.sh</em>. Merge your code to master in GitHub, which will trigger another new build on Travis. This time, the script should fire.</p>

<h4 id="architecture">Architecture</h4>

<table><thead>
<tr>
<th>Name</th>
<th>Repo</th>
<th>Image</th>
<th>Container</th>
<th>Tech</th>
</tr>
</thead><tbody>
<tr>
<td>Users API</td>
<td><a href="https://github.com/realpython/flask-microservices-users">users</a></td>
<td><a href="https://hub.docker.com/r/realpython/flask-microservices-users">users</a></td>
<td><code>users-service</code></td>
<td>Flask, gunicorn</td>
</tr>
<tr>
<td>Users DB</td>
<td><a href="https://github.com/realpython/flask-microservices-users/tree/master/project/db">users</a></td>
<td><a href="https://hub.docker.com/r/realpython/flask-microservices-users_db">users_db</a></td>
<td><code>users-db</code></td>
<td>Postgres</td>
</tr>
<tr>
<td>Client</td>
<td><a href="https://github.com/realpython/flask-microservices-client">client</a></td>
<td><a href="https://hub.docker.com/r/realpython/flask-microservices-client">client</a></td>
<td><code>web-service</code></td>
<td>React, React-Router</td>
</tr>
<tr>
<td>Swagger</td>
<td><a href="https://github.com/realpython/flask-microservices-swagger">swagger</a></td>
<td><a href="https://hub.docker.com/r/realpython/flask-microservices-swagger">swagger</a></td>
<td><code>swagger</code></td>
<td>Swagger UI</td>
</tr>
<tr>
<td>e2e Tests</td>
<td><a href="https://github.com/realpython/flask-microservices-main/tree/master/e2e">main</a></td>
<td>N/A</td>
<td>N/A</td>
<td>TestCafe</td>
</tr>
<tr>
<td>Nginx</td>
<td><a href="https://github.com/realpython/flask-microservices-main/tree/master/nginx">main</a></td>
<td><a href="https://hub.docker.com/r/realpython/flask-microservices-nginx">nginx</a></td>
<td><code>nginx</code></td>
<td>Nginx</td>
</tr>
</tbody></table>


          
  <br><br>
  <a class="twitter-share-button" data-show-count="false" href="https://twitter.com/intent/tweet?text=Microservices with Docker, Flask, and React - Docker Hub&amp;url=http%3A%2F%2Ftestdriven.io/part-five-docker-hub&amp;via=RealPython" rel="nofollow" target="_blank" title="Share on Twitter"></a><script async src="//platform.twitter.com/widgets.js" charset="utf-8"></script>



          <div class="page-nav">
            
              <a class="prev btn left-align" href="/part-five-intro">&laquo; Introduction</a>
            
            
              <a class="next btn right-align" href="/part-five-ec2-container-registry">EC2 Container Registry &raquo;</a>
            
          </div>

        </div>

        <div class="hide-on-med-and-up">

          <h2>Docker Hub</h2>

          <p>Let&#39;s update the CI process to include <a href="https://docs.docker.com/docker-hub/">Docker Hub</a>, an image registry:</p>

<ol>
<li>Create a new feature branch</li>
<li>Open PR against the <code>master</code> branch</li>
<li>New build is triggered on Travis</li>
<li>If the tests pass, images are created and pushed to Docker Hub</li>
</ol>

<h4 id="docker-hub">Docker Hub</h4>

<p><a href="https://docs.docker.com/docker-hub/">Docker Hub</a> is an image registry, which is simply a service that stores Docker images - basically GitHub for Docker images.</p>

<p>Sign up for <a href="https://hub.docker.com/">Docker Hub</a> (if necessary), and then define the following environment variables within the <a href="https://docs.travis-ci.com/user/environment-variables/#Defining-Variables-in-Repository-Settings">Repository Settings</a> for <em>flask-microservices-main</em>:</p>

<ol>
<li>DOCKER_EMAIL - YOUREMAILATSOMETHING.COM</li>
<li>DOCKER_ID - YOUR_ID/USERNAME</li>
<li>DOCKER_PASSWORD - YOUR_PASSWORD</li>
</ol>

<p>Next, create four new <a href="https://stackoverflow.com/a/34004418/1799408">repositories</a> on Docker Hub:</p>

<ol>
<li><em>flask-microservices-users</em></li>
<li><em>flask-microservices-users_db</em></li>
<li><em>flask-microservices-client</em></li>
<li><em>flask-microservices-swagger</em></li>
<li><em>flask-microservices-nginx</em></li>
</ol>

<h4 id="users">Users</h4>

<p>Let&#39;s update the <em>.travis.yml</em> file in <em>flask-microservices-main</em>:</p>
<div class="highlight"><pre><code class="language-yaml" data-lang="yaml"><span class="l-Scalar-Plain">language</span><span class="p-Indicator">:</span> <span class="l-Scalar-Plain">node_js</span>
<span class="l-Scalar-Plain">node_js</span><span class="p-Indicator">:</span> <span class="s">&#39;7&#39;</span>

<span class="l-Scalar-Plain">before_install</span><span class="p-Indicator">:</span>
  <span class="p-Indicator">-</span> <span class="l-Scalar-Plain">stty cols 80</span>

<span class="l-Scalar-Plain">dist</span><span class="p-Indicator">:</span> <span class="l-Scalar-Plain">trusty</span>
<span class="l-Scalar-Plain">sudo</span><span class="p-Indicator">:</span> <span class="l-Scalar-Plain">required</span>

<span class="l-Scalar-Plain">addons</span><span class="p-Indicator">:</span>
  <span class="l-Scalar-Plain">apt</span><span class="p-Indicator">:</span>
    <span class="l-Scalar-Plain">sources</span><span class="p-Indicator">:</span>
     <span class="p-Indicator">-</span> <span class="l-Scalar-Plain">google-chrome</span>
    <span class="l-Scalar-Plain">packages</span><span class="p-Indicator">:</span>
     <span class="p-Indicator">-</span> <span class="l-Scalar-Plain">google-chrome-stable</span>

<span class="l-Scalar-Plain">services</span><span class="p-Indicator">:</span>
  <span class="p-Indicator">-</span> <span class="l-Scalar-Plain">docker</span>

<span class="l-Scalar-Plain">env</span><span class="p-Indicator">:</span>
  <span class="l-Scalar-Plain">global</span><span class="p-Indicator">:</span>
    <span class="p-Indicator">-</span> <span class="l-Scalar-Plain">DOCKER_COMPOSE_VERSION=1.11.2</span>
    <span class="p-Indicator">-</span> <span class="l-Scalar-Plain">COMMIT=${TRAVIS_COMMIT::8}</span>
    <span class="p-Indicator">-</span> <span class="l-Scalar-Plain">USERS=flask-microservices-users</span>
    <span class="p-Indicator">-</span> <span class="l-Scalar-Plain">USERS_REPO=https://github.com/realpython/$USERS.git</span>

<span class="l-Scalar-Plain">before_install</span><span class="p-Indicator">:</span>
  <span class="p-Indicator">-</span> <span class="l-Scalar-Plain">sudo rm /usr/local/bin/docker-compose</span>
  <span class="p-Indicator">-</span> <span class="l-Scalar-Plain">curl -L https://github.com/docker/compose/releases/download/${DOCKER_COMPOSE_VERSION}/docker-compose-`uname -s`-`uname -m` &gt; docker-compose</span>
  <span class="p-Indicator">-</span> <span class="l-Scalar-Plain">chmod +x docker-compose</span>
  <span class="p-Indicator">-</span> <span class="l-Scalar-Plain">sudo mv docker-compose /usr/local/bin</span>

<span class="l-Scalar-Plain">before_script</span><span class="p-Indicator">:</span>
  <span class="p-Indicator">-</span> <span class="l-Scalar-Plain">export TEST_URL=http://127.0.0.1</span>
  <span class="p-Indicator">-</span> <span class="l-Scalar-Plain">export REACT_APP_USERS_SERVICE_URL=http://127.0.0.1</span>
  <span class="p-Indicator">-</span> <span class="l-Scalar-Plain">export SECRET_KEY=my_precious</span>
  <span class="p-Indicator">-</span> <span class="l-Scalar-Plain">export DISPLAY=:99.0</span>
  <span class="p-Indicator">-</span> <span class="l-Scalar-Plain">sh -e /etc/init.d/xvfb start</span>
  <span class="p-Indicator">-</span> <span class="l-Scalar-Plain">sleep 3</span>
  <span class="p-Indicator">-</span> <span class="l-Scalar-Plain">docker-compose -f docker-compose-ci.yml up -d --build</span>

<span class="l-Scalar-Plain">script</span><span class="p-Indicator">:</span>
  <span class="p-Indicator">-</span> <span class="l-Scalar-Plain">docker-compose -f docker-compose-ci.yml run users-service python manage.py test</span>
  <span class="p-Indicator">-</span> <span class="l-Scalar-Plain">docker-compose -f docker-compose-ci.yml run users-service python manage.py recreate_db</span>
  <span class="p-Indicator">-</span> <span class="l-Scalar-Plain">testcafe chrome e2e</span>

<span class="l-Scalar-Plain">after_script</span><span class="p-Indicator">:</span>
  <span class="p-Indicator">-</span> <span class="l-Scalar-Plain">docker-compose down</span>

<span class="l-Scalar-Plain">after_success</span><span class="p-Indicator">:</span>
  <span class="p-Indicator">-</span> <span class="l-Scalar-Plain">docker login -e $DOCKER_EMAIL -u $DOCKER_ID -p $DOCKER_PASSWORD</span>
  <span class="p-Indicator">-</span> <span class="l-Scalar-Plain">export TAG=`if [ &quot;$TRAVIS_BRANCH&quot; == &quot;master&quot; ]; then echo &quot;latest&quot;; else echo $TRAVIS_BRANCH ; fi`</span>
  <span class="c1"># users</span>
  <span class="p-Indicator">-</span> <span class="l-Scalar-Plain">docker build $USERS_REPO -t $USERS:$COMMIT</span>
  <span class="p-Indicator">-</span> <span class="l-Scalar-Plain">docker tag $USERS:$COMMIT $DOCKER_ID/$USERS:$TAG</span>
  <span class="p-Indicator">-</span> <span class="l-Scalar-Plain">docker push $DOCKER_ID/$USERS</span>
</code></pre></div>
<p>What changed?</p>

<ol>
<li>Environment variables:

<ol>
<li><code>COMMIT=${TRAVIS_COMMIT::8}</code> - sets a new environment variable, called <code>COMMIT</code>, which contains the first 8 characters of the git commit hash.</li>
<li><code>USERS</code> - defines the name of the Git repo and image name.</li>
<li><code>USERS_REPO</code> - defines the full GitHub URL.</li>
</ol></li>
<li>Finally, within <code>after_success</code>, we login to the Docker Hub registry, generate a tag based on the branch name, build an image from the <em>Dockerfile</em>, tag the image, and then push the image to Docker Hub.</li>
</ol>

<blockquote>
<p>Update the value of <code>USERS_REPO</code> to your repo.</p>
</blockquote>

<p>We also referenced a new Docker Compose file, <em>docker-compose-ci.yml</em>:</p>
<div class="highlight"><pre><code class="language-yaml" data-lang="yaml"><span class="l-Scalar-Plain">version</span><span class="p-Indicator">:</span> <span class="s">&#39;2.1&#39;</span>

<span class="l-Scalar-Plain">services</span><span class="p-Indicator">:</span>

  <span class="l-Scalar-Plain">users-db</span><span class="p-Indicator">:</span>
    <span class="l-Scalar-Plain">container_name</span><span class="p-Indicator">:</span> <span class="l-Scalar-Plain">users-db</span>
    <span class="l-Scalar-Plain">build</span><span class="p-Indicator">:</span>
      <span class="l-Scalar-Plain">context</span><span class="p-Indicator">:</span> <span class="l-Scalar-Plain">https://github.com/realpython/flask-microservices-users.git#master:project/db</span>
    <span class="l-Scalar-Plain">ports</span><span class="p-Indicator">:</span>
      <span class="p-Indicator">-</span> <span class="l-Scalar-Plain">5435:5432</span>  <span class="c1"># expose ports - HOST:CONTAINER</span>
    <span class="l-Scalar-Plain">environment</span><span class="p-Indicator">:</span>
      <span class="p-Indicator">-</span> <span class="l-Scalar-Plain">POSTGRES_USER=postgres</span>
      <span class="p-Indicator">-</span> <span class="l-Scalar-Plain">POSTGRES_PASSWORD=postgres</span>
    <span class="l-Scalar-Plain">healthcheck</span><span class="p-Indicator">:</span>
      <span class="l-Scalar-Plain">test</span><span class="p-Indicator">:</span> <span class="l-Scalar-Plain">exit 0</span>

  <span class="l-Scalar-Plain">users-service</span><span class="p-Indicator">:</span>
    <span class="l-Scalar-Plain">container_name</span><span class="p-Indicator">:</span> <span class="l-Scalar-Plain">users-service</span>
    <span class="l-Scalar-Plain">build</span><span class="p-Indicator">:</span>
      <span class="l-Scalar-Plain">context</span><span class="p-Indicator">:</span> <span class="l-Scalar-Plain">https://github.com/realpython/flask-microservices-users.git</span>
    <span class="l-Scalar-Plain">expose</span><span class="p-Indicator">:</span>
      <span class="p-Indicator">-</span> <span class="s">&#39;5000&#39;</span>
    <span class="l-Scalar-Plain">environment</span><span class="p-Indicator">:</span>
      <span class="p-Indicator">-</span> <span class="l-Scalar-Plain">APP_SETTINGS=project.config.StagingConfig</span>
      <span class="p-Indicator">-</span> <span class="l-Scalar-Plain">DATABASE_URL=postgres://postgres:postgres@users-db:5432/users_staging</span>
      <span class="p-Indicator">-</span> <span class="l-Scalar-Plain">DATABASE_TEST_URL=postgres://postgres:postgres@users-db:5432/users_test</span>
      <span class="p-Indicator">-</span> <span class="l-Scalar-Plain">SECRET_KEY=${SECRET_KEY}</span>
    <span class="l-Scalar-Plain">depends_on</span><span class="p-Indicator">:</span>
      <span class="l-Scalar-Plain">users-db</span><span class="p-Indicator">:</span>
        <span class="l-Scalar-Plain">condition</span><span class="p-Indicator">:</span> <span class="l-Scalar-Plain">service_healthy</span>
    <span class="l-Scalar-Plain">links</span><span class="p-Indicator">:</span>
      <span class="p-Indicator">-</span> <span class="l-Scalar-Plain">users-db</span>
    <span class="l-Scalar-Plain">command</span><span class="p-Indicator">:</span> <span class="l-Scalar-Plain">gunicorn -b 0.0.0.0:5000 manage:app</span>

  <span class="l-Scalar-Plain">nginx</span><span class="p-Indicator">:</span>
    <span class="l-Scalar-Plain">container_name</span><span class="p-Indicator">:</span> <span class="l-Scalar-Plain">nginx</span>
    <span class="l-Scalar-Plain">build</span><span class="p-Indicator">:</span> <span class="l-Scalar-Plain">./nginx/</span>
    <span class="l-Scalar-Plain">restart</span><span class="p-Indicator">:</span> <span class="l-Scalar-Plain">always</span>
    <span class="l-Scalar-Plain">ports</span><span class="p-Indicator">:</span>
      <span class="p-Indicator">-</span> <span class="l-Scalar-Plain">80:80</span>
    <span class="l-Scalar-Plain">depends_on</span><span class="p-Indicator">:</span>
      <span class="l-Scalar-Plain">users-service</span><span class="p-Indicator">:</span>
        <span class="l-Scalar-Plain">condition</span><span class="p-Indicator">:</span> <span class="l-Scalar-Plain">service_started</span>
      <span class="l-Scalar-Plain">web-service</span><span class="p-Indicator">:</span>
        <span class="l-Scalar-Plain">condition</span><span class="p-Indicator">:</span> <span class="l-Scalar-Plain">service_started</span>
    <span class="l-Scalar-Plain">links</span><span class="p-Indicator">:</span>
      <span class="p-Indicator">-</span> <span class="l-Scalar-Plain">users-service</span>
      <span class="p-Indicator">-</span> <span class="l-Scalar-Plain">web-service</span>

  <span class="l-Scalar-Plain">web-service</span><span class="p-Indicator">:</span>
    <span class="l-Scalar-Plain">container_name</span><span class="p-Indicator">:</span> <span class="l-Scalar-Plain">web-service</span>
    <span class="l-Scalar-Plain">build</span><span class="p-Indicator">:</span>
      <span class="l-Scalar-Plain">context</span><span class="p-Indicator">:</span> <span class="l-Scalar-Plain">https://github.com/realpython/flask-microservices-client.git</span>
      <span class="l-Scalar-Plain">args</span><span class="p-Indicator">:</span>
        <span class="p-Indicator">-</span> <span class="l-Scalar-Plain">NODE_ENV=development</span>
        <span class="p-Indicator">-</span> <span class="l-Scalar-Plain">REACT_APP_USERS_SERVICE_URL=${REACT_APP_USERS_SERVICE_URL}</span>
    <span class="l-Scalar-Plain">ports</span><span class="p-Indicator">:</span>
      <span class="p-Indicator">-</span> <span class="s">&#39;9000:9000&#39;</span> <span class="c1"># expose ports - HOST:CONTAINER</span>
    <span class="l-Scalar-Plain">depends_on</span><span class="p-Indicator">:</span>
      <span class="l-Scalar-Plain">users-service</span><span class="p-Indicator">:</span>
        <span class="l-Scalar-Plain">condition</span><span class="p-Indicator">:</span> <span class="l-Scalar-Plain">service_started</span>
    <span class="l-Scalar-Plain">links</span><span class="p-Indicator">:</span>
      <span class="p-Indicator">-</span> <span class="l-Scalar-Plain">users-service</span>

  <span class="l-Scalar-Plain">swagger</span><span class="p-Indicator">:</span>
    <span class="l-Scalar-Plain">container_name</span><span class="p-Indicator">:</span> <span class="l-Scalar-Plain">swagger</span>
    <span class="l-Scalar-Plain">build</span><span class="p-Indicator">:</span>
      <span class="l-Scalar-Plain">context</span><span class="p-Indicator">:</span> <span class="l-Scalar-Plain">https://github.com/realpython/flask-microservices-swagger.git</span>
    <span class="l-Scalar-Plain">ports</span><span class="p-Indicator">:</span>
      <span class="p-Indicator">-</span> <span class="s">&#39;8080:8080&#39;</span> <span class="c1"># expose ports - HOST:CONTAINER</span>
    <span class="l-Scalar-Plain">environment</span><span class="p-Indicator">:</span>
      <span class="p-Indicator">-</span> <span class="l-Scalar-Plain">API_URL=https://raw.githubusercontent.com/realpython/flask-microservices-swagger/master/swagger.json</span>
    <span class="l-Scalar-Plain">depends_on</span><span class="p-Indicator">:</span>
      <span class="l-Scalar-Plain">users-service</span><span class="p-Indicator">:</span>
        <span class="l-Scalar-Plain">condition</span><span class="p-Indicator">:</span> <span class="l-Scalar-Plain">service_started</span>
</code></pre></div>
<p>To test, commit your code and then push to GitHub. Make sure the build passes on Travis and that a new <a href="https://docs.docker.com/docker-hub/repos/#viewing-repository-tags">tag</a> was added to Docker Hub.</p>

<h4 id="users-db">Users DB</h4>

<p>For the users database, add the environment variables to <em>.travis.yml</em>:</p>
<div class="highlight"><pre><code class="language-yaml" data-lang="yaml"><span class="p-Indicator">-</span> <span class="l-Scalar-Plain">USERS_DB=flask-microservices-users_db</span>
<span class="p-Indicator">-</span> <span class="l-Scalar-Plain">USERS_DB_REPO=https://github.com/realpython/$USERS.git#master:project/db</span>
</code></pre></div>
<p>Then add the following to <code>after_success</code>:</p>
<div class="highlight"><pre><code class="language-yaml" data-lang="yaml"><span class="c1"># users db</span>
<span class="p-Indicator">-</span> <span class="l-Scalar-Plain">docker build $USERS_DB_REPO -t $USERS_DB:$COMMIT</span>
<span class="p-Indicator">-</span> <span class="l-Scalar-Plain">docker tag $USERS_DB:$COMMIT $DOCKER_ID/$USERS_DB:$TAG</span>
<span class="p-Indicator">-</span> <span class="l-Scalar-Plain">docker push $DOCKER_ID/$USERS_DB</span>
</code></pre></div>
<p>Commit, push, and ensure all is well.</p>

<p>For each of the next three services, we need to make the updates to <em>.travis.yml</em>, commit and push the code, and then ensure the build passes and the tag is added to Docker Hub....</p>

<h4 id="web">Web</h4>

<p>Environment variables:</p>
<div class="highlight"><pre><code class="language-yaml" data-lang="yaml"><span class="p-Indicator">-</span> <span class="l-Scalar-Plain">CLIENT=flask-microservices-client</span>
<span class="p-Indicator">-</span> <span class="l-Scalar-Plain">CLIENT_REPO=https://github.com/realpython/$CLIENT.git</span>
</code></pre></div>
<p><code>after_success</code>:</p>
<div class="highlight"><pre><code class="language-yaml" data-lang="yaml"><span class="c1"># client</span>
<span class="p-Indicator">-</span> <span class="l-Scalar-Plain">docker build $CLIENT_REPO -t $CLIENT:$COMMIT</span>
<span class="p-Indicator">-</span> <span class="l-Scalar-Plain">docker tag $CLIENT:$COMMIT $DOCKER_ID/$CLIENT:$TAG</span>
<span class="p-Indicator">-</span> <span class="l-Scalar-Plain">docker push $DOCKER_ID/$CLIENT</span>
</code></pre></div>
<h4 id="swagger">Swagger</h4>

<p>Environment variables:</p>
<div class="highlight"><pre><code class="language-yaml" data-lang="yaml"><span class="p-Indicator">-</span> <span class="l-Scalar-Plain">SWAGGER=flask-microservices-swagger</span>
<span class="p-Indicator">-</span> <span class="l-Scalar-Plain">SWAGGER_REPO=https://github.com/realpython/$SWAGGER.git</span>
</code></pre></div>
<p><code>after_success</code>:</p>
<div class="highlight"><pre><code class="language-yaml" data-lang="yaml"><span class="c1"># swagger</span>
<span class="p-Indicator">-</span> <span class="l-Scalar-Plain">docker build $SWAGGER_REPO -t $SWAGGER:$COMMIT</span>
<span class="p-Indicator">-</span> <span class="l-Scalar-Plain">docker tag $SWAGGER:$COMMIT $DOCKER_ID/$SWAGGER:$TAG</span>
<span class="p-Indicator">-</span> <span class="l-Scalar-Plain">docker push $DOCKER_ID/$SWAGGER</span>
</code></pre></div>
<h4 id="nginx">Nginx</h4>

<p>Environment variables:</p>
<div class="highlight"><pre><code class="language-yaml" data-lang="yaml"><span class="p-Indicator">-</span> <span class="l-Scalar-Plain">NGINX=flask-microservices-nginx</span>
<span class="p-Indicator">-</span> <span class="l-Scalar-Plain">NGINX_REPO=https://github.com/realpython/flask-microservices-main.git#master:nginx</span>
</code></pre></div>
<p><code>after_success</code>:</p>
<div class="highlight"><pre><code class="language-yaml" data-lang="yaml"><span class="c1"># nginx</span>
<span class="p-Indicator">-</span> <span class="l-Scalar-Plain">docker build $NGINX_REPO -t $NGINX:$COMMIT</span>
<span class="p-Indicator">-</span> <span class="l-Scalar-Plain">docker tag $NGINX:$COMMIT $DOCKER_ID/$NGINX:$TAG</span>
<span class="p-Indicator">-</span> <span class="l-Scalar-Plain">docker push $DOCKER_ID/$NGINX</span>
</code></pre></div>
<h4 id="scripts">Scripts</h4>

<p>Since we only want the <code>after_success</code> to run when the branch is <code>master</code>, let&#39;s create a simple shell script:</p>
<div class="highlight"><pre><code class="language-sh" data-lang="sh"><span class="c">#!/bin/sh</span>

<span class="k">if</span> <span class="o">[</span> <span class="s2">&quot;$TRAVIS_BRANCH&quot;</span> <span class="o">==</span> <span class="s2">&quot;master&quot;</span> <span class="o">]</span><span class="p">;</span> <span class="k">then</span>
  docker login -e <span class="nv">$DOCKER_EMAIL</span> -u <span class="nv">$DOCKER_ID</span> -p <span class="nv">$DOCKER_PASSWORD</span>
  <span class="nb">export </span><span class="nv">TAG</span><span class="o">=</span><span class="sb">`</span><span class="k">if</span> <span class="o">[</span> <span class="s2">&quot;$TRAVIS_BRANCH&quot;</span> <span class="o">==</span> <span class="s2">&quot;master&quot;</span> <span class="o">]</span><span class="p">;</span> <span class="k">then</span> <span class="nb">echo</span> <span class="s2">&quot;latest&quot;</span><span class="p">;</span> <span class="k">else</span> <span class="nb">echo</span> <span class="nv">$TRAVIS_BRANCH</span> <span class="p">;</span> <span class="k">fi</span><span class="sb">`</span>
  <span class="c"># users</span>
  docker build <span class="nv">$USERS_REPO</span> -t <span class="nv">$USERS</span>:<span class="nv">$COMMIT</span>
  docker tag <span class="nv">$USERS</span>:<span class="nv">$COMMIT</span> <span class="nv">$DOCKER_ID</span>/<span class="nv">$USERS</span>:<span class="nv">$TAG</span>
  docker push <span class="nv">$DOCKER_ID</span>/<span class="nv">$USERS</span>
  <span class="c"># users db</span>
  docker build <span class="nv">$USERS_DB_REPO</span> -t <span class="nv">$USERS_DB</span>:<span class="nv">$COMMIT</span>
  docker tag <span class="nv">$USERS_DB</span>:<span class="nv">$COMMIT</span> <span class="nv">$DOCKER_ID</span>/<span class="nv">$USERS_DB</span>:<span class="nv">$TAG</span>
  docker push <span class="nv">$DOCKER_ID</span>/<span class="nv">$USERS_DB</span>
  <span class="c"># client</span>
  docker build <span class="nv">$CLIENT_REPO</span> -t <span class="nv">$CLIENT</span>:<span class="nv">$COMMIT</span>
  docker tag <span class="nv">$CLIENT</span>:<span class="nv">$COMMIT</span> <span class="nv">$DOCKER_ID</span>/<span class="nv">$CLIENT</span>:<span class="nv">$TAG</span>
  docker push <span class="nv">$DOCKER_ID</span>/<span class="nv">$CLIENT</span>
  <span class="c"># swagger</span>
  docker build <span class="nv">$SWAGGER_REPO</span> -t <span class="nv">$SWAGGER</span>:<span class="nv">$COMMIT</span>
  docker tag <span class="nv">$SWAGGER</span>:<span class="nv">$COMMIT</span> <span class="nv">$DOCKER_ID</span>/<span class="nv">$SWAGGER</span>:<span class="nv">$TAG</span>
  docker push <span class="nv">$DOCKER_ID</span>/<span class="nv">$SWAGGER</span>
  <span class="c"># nginx</span>
  docker build <span class="nv">$NGINX_REPO</span> -t <span class="nv">$NGINX</span>:<span class="nv">$COMMIT</span>
  docker tag <span class="nv">$NGINX</span>:<span class="nv">$COMMIT</span> <span class="nv">$DOCKER_ID</span>/<span class="nv">$NGINX</span>:<span class="nv">$TAG</span>
  docker push <span class="nv">$DOCKER_ID</span>/<span class="nv">$NGINX</span>
<span class="k">fi</span>
</code></pre></div>
<p>Save this as <em>docker_push.sh</em> within <em>flask-microservices-main</em>, and then update <code>after_success</code>:</p>
<div class="highlight"><pre><code class="language-yaml" data-lang="yaml"><span class="l-Scalar-Plain">after_success</span><span class="p-Indicator">:</span>
  <span class="p-Indicator">-</span> <span class="l-Scalar-Plain">bash ./docker_push.sh</span>
</code></pre></div>
<p>We can speed up the building of new images by first pulling in the latest image from Docker Hub. Add a new script called <em>docker_build.sh</em> to the project root:</p>
<div class="highlight"><pre><code class="language-sh" data-lang="sh"><span class="c">#!/bin/sh</span>

docker login -e <span class="nv">$DOCKER_EMAIL</span> -u <span class="nv">$DOCKER_ID</span> -p <span class="nv">$DOCKER_PASSWORD</span>
docker pull <span class="nv">$DOCKER_ID</span>/<span class="nv">$USERS</span>
docker pull <span class="nv">$DOCKER_ID</span>/<span class="nv">$USERS_DB</span>
docker pull <span class="nv">$DOCKER_ID</span>/<span class="nv">$CLIENT</span>
docker pull <span class="nv">$DOCKER_ID</span>/<span class="nv">$SWAGGER</span>
docker pull <span class="nv">$DOCKER_ID</span>/<span class="nv">$NGINX</span>

docker-compose -f docker-compose-ci.yml up -d --build
</code></pre></div>
<blockquote>
<p>Want to speed things up even more? <a href="https://github.com/start-jsk/jsk_apc/commit/7c12afa1c8c460f1b148c6ca887203d915fa9846">Cache images on Travis</a>.</p>
</blockquote>

<p>Update the <code>before_script</code> in <em>.travis.yml</em>:</p>
<div class="highlight"><pre><code class="language-yaml" data-lang="yaml"><span class="l-Scalar-Plain">before_script</span><span class="p-Indicator">:</span>
  <span class="p-Indicator">-</span> <span class="l-Scalar-Plain">export TEST_URL=http://127.0.0.1</span>
  <span class="p-Indicator">-</span> <span class="l-Scalar-Plain">export REACT_APP_USERS_SERVICE_URL=http://127.0.0.1</span>
  <span class="p-Indicator">-</span> <span class="l-Scalar-Plain">export SECRET_KEY=my_precious</span>
  <span class="p-Indicator">-</span> <span class="l-Scalar-Plain">export DISPLAY=:99.0</span>
  <span class="p-Indicator">-</span> <span class="l-Scalar-Plain">sh -e /etc/init.d/xvfb start</span>
  <span class="p-Indicator">-</span> <span class="l-Scalar-Plain">sleep 3</span>
  <span class="p-Indicator">-</span> <span class="l-Scalar-Plain">bash ./docker_build.sh</span>
</code></pre></div>
<p>To test create a new branch feature branch and push your code to GitHub. A new build should be triggered, but it should not run any code within the <code>if</code> block within <em>docker_push.sh</em>. Merge your code to master in GitHub, which will trigger another new build on Travis. This time, the script should fire.</p>

<h4 id="architecture">Architecture</h4>

<table><thead>
<tr>
<th>Name</th>
<th>Repo</th>
<th>Image</th>
<th>Container</th>
<th>Tech</th>
</tr>
</thead><tbody>
<tr>
<td>Users API</td>
<td><a href="https://github.com/realpython/flask-microservices-users">users</a></td>
<td><a href="https://hub.docker.com/r/realpython/flask-microservices-users">users</a></td>
<td><code>users-service</code></td>
<td>Flask, gunicorn</td>
</tr>
<tr>
<td>Users DB</td>
<td><a href="https://github.com/realpython/flask-microservices-users/tree/master/project/db">users</a></td>
<td><a href="https://hub.docker.com/r/realpython/flask-microservices-users_db">users_db</a></td>
<td><code>users-db</code></td>
<td>Postgres</td>
</tr>
<tr>
<td>Client</td>
<td><a href="https://github.com/realpython/flask-microservices-client">client</a></td>
<td><a href="https://hub.docker.com/r/realpython/flask-microservices-client">client</a></td>
<td><code>web-service</code></td>
<td>React, React-Router</td>
</tr>
<tr>
<td>Swagger</td>
<td><a href="https://github.com/realpython/flask-microservices-swagger">swagger</a></td>
<td><a href="https://hub.docker.com/r/realpython/flask-microservices-swagger">swagger</a></td>
<td><code>swagger</code></td>
<td>Swagger UI</td>
</tr>
<tr>
<td>e2e Tests</td>
<td><a href="https://github.com/realpython/flask-microservices-main/tree/master/e2e">main</a></td>
<td>N/A</td>
<td>N/A</td>
<td>TestCafe</td>
</tr>
<tr>
<td>Nginx</td>
<td><a href="https://github.com/realpython/flask-microservices-main/tree/master/nginx">main</a></td>
<td><a href="https://hub.docker.com/r/realpython/flask-microservices-nginx">nginx</a></td>
<td><code>nginx</code></td>
<td>Nginx</td>
</tr>
</tbody></table>


          
  <br><br>
  <a class="twitter-share-button" data-show-count="false" href="https://twitter.com/intent/tweet?text=Microservices with Docker, Flask, and React - Docker Hub&amp;url=http%3A%2F%2Ftestdriven.io/part-five-docker-hub&amp;via=RealPython" rel="nofollow" target="_blank" title="Share on Twitter"></a><script async src="//platform.twitter.com/widgets.js" charset="utf-8"></script>



          <div class="page-nav">
            
              <a class="prev btn left-align" href="/part-five-intro">&laquo; Introduction</a>
            
            
              <a class="next btn right-align" href="/part-five-ec2-container-registry">EC2 Container Registry &raquo;</a>
            
          </div>

        </div>

      </div>
    </div>

     <footer class="page-footer white">
  <div class="container footer-container center-align">
    <ul>
      <li>Content by Michael Herman (michael@realpython.com)</li>
      <li>&copy; Copyright 2017 <a href="http://realpython.com">Real Python</a></li>
    </ul>
  </div>
</footer>


    <script type="text/javascript" src="//code.jquery.com/jquery-2.1.1.min.js"></script>
    <script src="//cdnjs.cloudflare.com/ajax/libs/materialize/0.97.3/js/materialize.min.js"></script>

    
  <script>
    (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
    (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
    m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
    })(window,document,'script','https://www.google-analytics.com/analytics.js','ga');

    ga('create', 'UA-100160465-1', 'auto');
    ga('send', 'pageview');

  </script>



  </body>
</html>
