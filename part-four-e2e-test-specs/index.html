<!DOCTYPE html>
<html>

  <head>
  
    <title>Microservices with Docker, Flask, and React - End-to-End Test Specs</title>
  
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <link
    rel="stylesheet" href="//cdnjs.cloudflare.com/ajax/libs/materialize/0.100.2/css/materialize.min.css"
  >
  <link
    rel="stylesheet"
    href="https://fonts.googleapis.com/icon?family=Material+Icons"
  >
  <link
    rel="stylesheet"
    href="//maxcdn.bootstrapcdn.com/font-awesome/4.7.0/css/font-awesome.min.css"
  >
  <link
    href="//fonts.googleapis.com/css?family=Merriweather:900,900italic,300,300italic"
    rel="stylesheet"
    type="text/css"
  >
  <link
    href="//fonts.googleapis.com/css?family=Lato:900,300"
    rel="stylesheet"
    type="text/css"
  >
  <link
    href="//cdn-images.mailchimp.com/embedcode/classic-10_7.css"
    rel="stylesheet"
    type="text/css"
  >
  <link href="/assets/css/styles.css" rel="stylesheet">
  <script
    src="//code.jquery.com/jquery-2.2.4.min.js"
    integrity="sha256-BbhdlvQf/xTY9gja0Dq3HiwQF8LaCRTXxZKRutelT44="
    crossorigin="anonymous"
  ></script>
  <script
    type="text/javascript"
    src="/assets/js/main.js"
  ></script>
</head>


  <body>

    <nav class="red darken-1">
  <div class="nav-wrapper">
    <a href="/" class="brand-logo main-brand-logo center show-on-large hide-on-med-and-down">
      Test Driven Development Courses
    </a>
    <a href="/" class="brand-logo main-brand-logo hide-on-large-only">
      TDD Courses
    </a>
    <a href="#" data-activates="mobile-demo" class="right button-collapse"><i class="material-icons">menu</i></a>
    <ul class="right hide-on-med-and-down">
      <li><a href="/course-contents">Contents</a></li>
      <li><a href="/version-two">Version 2</a></li>
    </ul>
    <ul class="side-nav" id="mobile-demo">
      <li><a href="/">Home</a></li>
      <li><a href="/course-contents">Contents</a></li>
      <li><a href="/version-two">Version 2</a></li>
    </ul>
  </div>
</nav>


    <br>

    <div class="container">
      <div class="row">

        <div class="col m3 hide-on-small-and-down">
  <br>
  <div id="toc-block" class="collection hide-on-small-and-down">
    <ul class="collapsible collapsible-accordion">
      
        
          <li>
            <h5 data-part="1" class="collapsible-header  waves-effect waves-teal">
              Part 1
            </h5>
            <div class="collapsible-body">
        
        <ul>
          <li class="collection-li">
            <span>1.&nbsp;</span>
            <span>
              <a
                class="collection-item"
                href="/part-one-intro"
              >Introduction</a>
            </span>
          </li>
        </ul>
      
        
        <ul>
          <li class="collection-li">
            <span>2.&nbsp;</span>
            <span>
              <a
                class="collection-item"
                href="/part-one-getting-started"
              >Getting Started</a>
            </span>
          </li>
        </ul>
      
        
        <ul>
          <li class="collection-li">
            <span>3.&nbsp;</span>
            <span>
              <a
                class="collection-item"
                href="/part-one-docker-config"
              >Docker Config</a>
            </span>
          </li>
        </ul>
      
        
        <ul>
          <li class="collection-li">
            <span>4.&nbsp;</span>
            <span>
              <a
                class="collection-item"
                href="/part-one-postgres-setup"
              >Postgres Setup</a>
            </span>
          </li>
        </ul>
      
        
        <ul>
          <li class="collection-li">
            <span>5.&nbsp;</span>
            <span>
              <a
                class="collection-item"
                href="/part-one-test-setup"
              >Test Setup</a>
            </span>
          </li>
        </ul>
      
        
        <ul>
          <li class="collection-li">
            <span>6.&nbsp;</span>
            <span>
              <a
                class="collection-item"
                href="/part-one-flask-blueprints"
              >Flask Blueprints</a>
            </span>
          </li>
        </ul>
      
        
        <ul>
          <li class="collection-li">
            <span>7.&nbsp;</span>
            <span>
              <a
                class="collection-item"
                href="/part-one-restful-routes"
              >RESTful Routes</a>
            </span>
          </li>
        </ul>
      
        
        <ul>
          <li class="collection-li">
            <span>8.&nbsp;</span>
            <span>
              <a
                class="collection-item"
                href="/part-one-aws-deployment"
              >Deployment</a>
            </span>
          </li>
        </ul>
      
        
        <ul>
          <li class="collection-li">
            <span>9.&nbsp;</span>
            <span>
              <a
                class="collection-item"
                href="/part-one-jinja-templates"
              >Jinja Templates</a>
            </span>
          </li>
        </ul>
      
        
        <ul>
          <li class="collection-li">
            <span>10.&nbsp;</span>
            <span>
              <a
                class="collection-item"
                href="/part-one-workflow"
              >Workflow</a>
            </span>
          </li>
        </ul>
      
        
          <li>
            <h5 data-part="2" class="collapsible-header  waves-effect waves-teal">
              Part 2
            </h5>
            <div class="collapsible-body">
        
        <ul>
          <li class="collection-li">
            <span>1.&nbsp;</span>
            <span>
              <a
                class="collection-item"
                href="/part-two-intro"
              >Introduction</a>
            </span>
          </li>
        </ul>
      
        
        <ul>
          <li class="collection-li">
            <span>2.&nbsp;</span>
            <span>
              <a
                class="collection-item"
                href="/part-two-project-refactor"
              >Project Refactor</a>
            </span>
          </li>
        </ul>
      
        
        <ul>
          <li class="collection-li">
            <span>3.&nbsp;</span>
            <span>
              <a
                class="collection-item"
                href="/part-two-code-coverage"
              >Code Coverage</a>
            </span>
          </li>
        </ul>
      
        
        <ul>
          <li class="collection-li">
            <span>4.&nbsp;</span>
            <span>
              <a
                class="collection-item"
                href="/part-two-continuous-integration"
              >Continuous Integration</a>
            </span>
          </li>
        </ul>
      
        
        <ul>
          <li class="collection-li">
            <span>5.&nbsp;</span>
            <span>
              <a
                class="collection-item"
                href="/part-two-react-setup"
              >React Setup</a>
            </span>
          </li>
        </ul>
      
        
        <ul>
          <li class="collection-li">
            <span>6.&nbsp;</span>
            <span>
              <a
                class="collection-item"
                href="/part-two-flask-deployment"
              >Flask Deployment</a>
            </span>
          </li>
        </ul>
      
        
        <ul>
          <li class="collection-li">
            <span>7.&nbsp;</span>
            <span>
              <a
                class="collection-item"
                href="/part-two-react-forms"
              >React Forms</a>
            </span>
          </li>
        </ul>
      
        
        <ul>
          <li class="collection-li">
            <span>8.&nbsp;</span>
            <span>
              <a
                class="collection-item"
                href="/part-two-react-docker"
              >React and Docker</a>
            </span>
          </li>
        </ul>
      
        
        <ul>
          <li class="collection-li">
            <span>9.&nbsp;</span>
            <span>
              <a
                class="collection-item"
                href="/part-two-flask-refactor"
              >Flask Refactor</a>
            </span>
          </li>
        </ul>
      
        
          <li>
            <h5 data-part="3" class="collapsible-header  waves-effect waves-teal">
              Part 3
            </h5>
            <div class="collapsible-body">
        
        <ul>
          <li class="collection-li">
            <span>1.&nbsp;</span>
            <span>
              <a
                class="collection-item"
                href="/part-three-intro"
              >Introduction</a>
            </span>
          </li>
        </ul>
      
        
        <ul>
          <li class="collection-li">
            <span>2.&nbsp;</span>
            <span>
              <a
                class="collection-item"
                href="/part-three-flask-migrate"
              >Flask Migrate</a>
            </span>
          </li>
        </ul>
      
        
        <ul>
          <li class="collection-li">
            <span>3.&nbsp;</span>
            <span>
              <a
                class="collection-item"
                href="/part-three-flask-bcrypt"
              >Flask Bcrypt</a>
            </span>
          </li>
        </ul>
      
        
        <ul>
          <li class="collection-li">
            <span>4.&nbsp;</span>
            <span>
              <a
                class="collection-item"
                href="/part-three-jwt-setup"
              >JWT Setup</a>
            </span>
          </li>
        </ul>
      
        
        <ul>
          <li class="collection-li">
            <span>5.&nbsp;</span>
            <span>
              <a
                class="collection-item"
                href="/part-three-auth-routes"
              >Auth Routes</a>
            </span>
          </li>
        </ul>
      
        
        <ul>
          <li class="collection-li">
            <span>6.&nbsp;</span>
            <span>
              <a
                class="collection-item"
                href="/part-three-react-router"
              >React Router</a>
            </span>
          </li>
        </ul>
      
        
        <ul>
          <li class="collection-li">
            <span>7.&nbsp;</span>
            <span>
              <a
                class="collection-item"
                href="/part-three-react-bootstrap"
              >React Bootstrap</a>
            </span>
          </li>
        </ul>
      
        
        <ul>
          <li class="collection-li">
            <span>8.&nbsp;</span>
            <span>
              <a
                class="collection-item"
                href="/part-three-react-authentication"
              >React Authentication</a>
            </span>
          </li>
        </ul>
      
        
        <ul>
          <li class="collection-li">
            <span>9.&nbsp;</span>
            <span>
              <a
                class="collection-item"
                href="/part-three-authorization"
              >Authorization</a>
            </span>
          </li>
        </ul>
      
        
        <ul>
          <li class="collection-li">
            <span>10.&nbsp;</span>
            <span>
              <a
                class="collection-item"
                href="/part-three-update-component"
              >Update Component</a>
            </span>
          </li>
        </ul>
      
        
        <ul>
          <li class="collection-li">
            <span>11.&nbsp;</span>
            <span>
              <a
                class="collection-item"
                href="/part-three-update-docker"
              >Update Docker</a>
            </span>
          </li>
        </ul>
      
        
          <li>
            <h5 data-part="4" class="collapsible-header  waves-effect waves-teal">
              Part 4
            </h5>
            <div class="collapsible-body">
        
        <ul>
          <li class="collection-li">
            <span>1.&nbsp;</span>
            <span>
              <a
                class="collection-item"
                href="/part-four-intro"
              >Introduction</a>
            </span>
          </li>
        </ul>
      
        
        <ul>
          <li class="collection-li">
            <span>2.&nbsp;</span>
            <span>
              <a
                class="collection-item"
                href="/part-four-e2e-test-setup"
              >End-to-End Test Setup</a>
            </span>
          </li>
        </ul>
      
        
        <ul>
          <li class="collection-li">
            <span>3.&nbsp;</span>
            <span>
              <a
                class="collection-item"
                href="/part-four-e2e-test-specs"
              >End-to-End Test Specs</a>
            </span>
          </li>
        </ul>
      
        
        <ul>
          <li class="collection-li">
            <span>4.&nbsp;</span>
            <span>
              <a
                class="collection-item"
                href="/part-four-react-component-refactor"
              >React Component Refactor</a>
            </span>
          </li>
        </ul>
      
        
        <ul>
          <li class="collection-li">
            <span>5.&nbsp;</span>
            <span>
              <a
                class="collection-item"
                href="/part-four-react-form-validation"
              >React Form Validation</a>
            </span>
          </li>
        </ul>
      
        
        <ul>
          <li class="collection-li">
            <span>6.&nbsp;</span>
            <span>
              <a
                class="collection-item"
                href="/part-four-react-flash-messages"
              >React Flash Messaging</a>
            </span>
          </li>
        </ul>
      
        
        <ul>
          <li class="collection-li">
            <span>7.&nbsp;</span>
            <span>
              <a
                class="collection-item"
                href="/part-four-swagger-setup"
              >Swagger Setup</a>
            </span>
          </li>
        </ul>
      
        
        <ul>
          <li class="collection-li">
            <span>8.&nbsp;</span>
            <span>
              <a
                class="collection-item"
                href="/part-four-staging-environment"
              >Staging Environment</a>
            </span>
          </li>
        </ul>
      
        
        <ul>
          <li class="collection-li">
            <span>9.&nbsp;</span>
            <span>
              <a
                class="collection-item"
                href="/part-four-workflow"
              >Workflow</a>
            </span>
          </li>
        </ul>
      
        
          <li>
            <h5 data-part="5" class="collapsible-header  waves-effect waves-teal">
              Part 5
            </h5>
            <div class="collapsible-body">
        
        <ul>
          <li class="collection-li">
            <span>1.&nbsp;</span>
            <span>
              <a
                class="collection-item"
                href="/part-five-intro"
              >Introduction</a>
            </span>
          </li>
        </ul>
      
        
        <ul>
          <li class="collection-li">
            <span>2.&nbsp;</span>
            <span>
              <a
                class="collection-item"
                href="/part-five-docker-hub"
              >Docker Hub</a>
            </span>
          </li>
        </ul>
      
        
        <ul>
          <li class="collection-li">
            <span>3.&nbsp;</span>
            <span>
              <a
                class="collection-item"
                href="/part-five-ec2-container-registry"
              >EC2 Container Registry</a>
            </span>
          </li>
        </ul>
      
        
        <ul>
          <li class="collection-li">
            <span>4.&nbsp;</span>
            <span>
              <a
                class="collection-item"
                href="/part-five-ec2-container-service"
              >EC2 Container Service</a>
            </span>
          </li>
        </ul>
      
        
        <ul>
          <li class="collection-li">
            <span>5.&nbsp;</span>
            <span>
              <a
                class="collection-item"
                href="/part-five-elastic-load-balancing"
              >Elastic Load Balancing</a>
            </span>
          </li>
        </ul>
      
        
        <ul>
          <li class="collection-li">
            <span>6.&nbsp;</span>
            <span>
              <a
                class="collection-item"
                href="/part-five-ec2-container-service-staging"
              >ECS Staging</a>
            </span>
          </li>
        </ul>
      
        
        <ul>
          <li class="collection-li">
            <span>7.&nbsp;</span>
            <span>
              <a
                class="collection-item"
                href="/part-five-ec2-relational-database-service"
              >Setting up RDS</a>
            </span>
          </li>
        </ul>
      
        
        <ul>
          <li class="collection-li">
            <span>8.&nbsp;</span>
            <span>
              <a
                class="collection-item"
                href="/part-five-ec2-container-service-production"
              >ECS Production</a>
            </span>
          </li>
        </ul>
      
        
        <ul>
          <li class="collection-li">
            <span>9.&nbsp;</span>
            <span>
              <a
                class="collection-item"
                href="/part-five-workflow"
              >Workflow</a>
            </span>
          </li>
        </ul>
      
        
          <li>
            <h5 data-part="6" class="collapsible-header  waves-effect waves-teal">
              Part 6
            </h5>
            <div class="collapsible-body">
        
        <ul>
          <li class="collection-li">
            <span>1.&nbsp;</span>
            <span>
              <a
                class="collection-item"
                href="/part-six-intro"
              >Introduction</a>
            </span>
          </li>
        </ul>
      
        
        <ul>
          <li class="collection-li">
            <span>2.&nbsp;</span>
            <span>
              <a
                class="collection-item"
                href="/part-six-eval-service-setup"
              >Eval Service Setup</a>
            </span>
          </li>
        </ul>
      
        
        <ul>
          <li class="collection-li">
            <span>3.&nbsp;</span>
            <span>
              <a
                class="collection-item"
                href="/part-six-scores-api-database"
              >Scores API Database</a>
            </span>
          </li>
        </ul>
      
        
        <ul>
          <li class="collection-li">
            <span>4.&nbsp;</span>
            <span>
              <a
                class="collection-item"
                href="/part-six-scores-api-routes"
              >Scores API Routes</a>
            </span>
          </li>
        </ul>
      
        
        <ul>
          <li class="collection-li">
            <span>5.&nbsp;</span>
            <span>
              <a
                class="collection-item"
                href="/part-six-exercises-api"
              >Exercises API</a>
            </span>
          </li>
        </ul>
      
        
        <ul>
          <li class="collection-li">
            <span>6.&nbsp;</span>
            <span>
              <a
                class="collection-item"
                href="/part-six-react-refactor"
              >React Refactor</a>
            </span>
          </li>
        </ul>
      
        
        <ul>
          <li class="collection-li">
            <span>7.&nbsp;</span>
            <span>
              <a
                class="collection-item"
                href="/part-six-e2e-tests-refactor"
              >End-to-End Tests Refactor</a>
            </span>
          </li>
        </ul>
      
        
        <ul>
          <li class="collection-li">
            <span>8.&nbsp;</span>
            <span>
              <a
                class="collection-item"
                href="/part-six-react-ace-code-editor"
              >React Ace Code Editor</a>
            </span>
          </li>
        </ul>
      
        
        <ul>
          <li class="collection-li">
            <span>9.&nbsp;</span>
            <span>
              <a
                class="collection-item"
                href="/part-six-code-evaluation"
              >Code Evaluation</a>
            </span>
          </li>
        </ul>
      
        
        <ul>
          <li class="collection-li">
            <span>10.&nbsp;</span>
            <span>
              <a
                class="collection-item"
                href="/part-six-ecs-deployment"
              >ECS Deployment</a>
            </span>
          </li>
        </ul>
      
        
        <ul>
          <li class="collection-li">
            <span>11.&nbsp;</span>
            <span>
              <a
                class="collection-item"
                href="/part-six-next-steps"
              >Next Steps</a>
            </span>
          </li>
        </ul>
      
    </div>
  </li>
    </ul>
  </div>
</div>


        <div class="col m9 hide-on-small-and-down">

          <h2>End-to-End Test Specs</h2>

          
            <h5>Part 4, Lesson 3</h5>

            <div class="page-nav">
              
                <a class="prev btn left-align" href="/part-four-e2e-test-setup">&laquo; End-to-End Test Setup</a>
              
              
                <a class="next btn right-align" href="/part-four-react-component-refactor">React Component Refactor &raquo;</a>
              
            </div>

            
  <br>
  <a class="twitter-share-button" data-show-count="false" href="https://twitter.com/intent/tweet?text=Microservices with Docker, Flask, and React - End-to-End Test Specs&amp;url=http%3A%2F%2Ftestdriven.io/part-four-e2e-test-specs&amp;via=RealPython" rel="nofollow" target="_blank" title="Share on Twitter"></a><script async src="//platform.twitter.com/widgets.js" charset="utf-8"></script>



            <br><br>

          


          <p>With TestCafe in place, we can now write tests...</p>

<hr>

<p>What should we test?</p>

<p>Turn to your app. Navigate through it as an end user. What are some common user interactions? How about frequent error cases that you expect <em>most</em> users to encounter?</p>

<p>Turn your answers into test cases...</p>

<h4 id="test-cases">Test Cases</h4>

<p><code>/register</code>:</p>

<ol>
<li>should display the registration form</li>
<li>should allow a user to register</li>
<li>should throw an error if the username is taken</li>
<li>should throw an error if the email is taken</li>
</ol>

<p><code>/login</code>:</p>

<ol>
<li>should display the sign in form</li>
<li>should allow a user to sign in</li>
<li>should throw an error if the credentials are incorrect</li>
</ol>

<p><code>/logout</code>:</p>

<ol>
<li>should log a user out</li>
</ol>

<p><code>/status</code>:</p>

<ol>
<li>should display user info if user is logged in</li>
<li>should display the page if user is not logged in</li>
</ol>

<p><code>/</code>:</p>

<ol>
<li>should display the page correctly if a user is not logged in</li>
</ol>

<h4 id="register">Register</h4>

<p>Add a new file called <em>register.test.js</em> to the &quot;e2e&quot; directory:</p>
<div class="highlight"><pre><code class="language-javascript" data-lang="javascript"><span class="kr">import</span> <span class="p">{</span> <span class="nx">Selector</span> <span class="p">}</span> <span class="nx">from</span> <span class="s1">&#39;testcafe&#39;</span><span class="p">;</span>

<span class="kr">const</span> <span class="nx">TEST_URL</span> <span class="o">=</span> <span class="nx">process</span><span class="p">.</span><span class="nx">env</span><span class="p">.</span><span class="nx">TEST_URL</span><span class="p">;</span>


<span class="nx">fixture</span><span class="p">(</span><span class="s1">&#39;/register&#39;</span><span class="p">).</span><span class="nx">page</span><span class="p">(</span><span class="err">`</span><span class="nx">$</span><span class="p">{</span><span class="nx">TEST_URL</span><span class="p">}</span><span class="o">/</span><span class="nx">register</span><span class="err">`</span><span class="p">);</span>
</code></pre></div>
<p>Now add the following test specs:</p>

<ol>
<li><p><em>should display the registration form</em></p>
<div class="highlight"><pre><code class="language-javascript" data-lang="javascript"><span class="nx">test</span><span class="p">(</span><span class="err">`</span><span class="nx">should</span> <span class="nx">display</span> <span class="nx">the</span> <span class="nx">registration</span> <span class="nx">form</span><span class="err">`</span><span class="p">,</span> <span class="nx">async</span> <span class="p">(</span><span class="nx">t</span><span class="p">)</span> <span class="o">=&gt;</span> <span class="p">{</span>
  <span class="nx">await</span> <span class="nx">t</span>
    <span class="p">.</span><span class="nx">navigateTo</span><span class="p">(</span><span class="err">`</span><span class="nx">$</span><span class="p">{</span><span class="nx">TEST_URL</span><span class="p">}</span><span class="o">/</span><span class="nx">register</span><span class="err">`</span><span class="p">)</span>
    <span class="p">.</span><span class="nx">expect</span><span class="p">(</span><span class="nx">Selector</span><span class="p">(</span><span class="s1">&#39;H1&#39;</span><span class="p">).</span><span class="nx">withText</span><span class="p">(</span><span class="s1">&#39;Register&#39;</span><span class="p">).</span><span class="nx">exists</span><span class="p">).</span><span class="nx">ok</span><span class="p">()</span>
    <span class="p">.</span><span class="nx">expect</span><span class="p">(</span><span class="nx">Selector</span><span class="p">(</span><span class="s1">&#39;form&#39;</span><span class="p">).</span><span class="nx">exists</span><span class="p">).</span><span class="nx">ok</span><span class="p">()</span>
<span class="p">});</span>
</code></pre></div></li>
<li><p><em>should allow a user to register</em></p>
<div class="highlight"><pre><code class="language-javascript" data-lang="javascript"><span class="nx">test</span><span class="p">(</span><span class="err">`</span><span class="nx">should</span> <span class="nx">allow</span> <span class="nx">a</span> <span class="nx">user</span> <span class="nx">to</span> <span class="nx">register</span><span class="err">`</span><span class="p">,</span> <span class="nx">async</span> <span class="p">(</span><span class="nx">t</span><span class="p">)</span> <span class="o">=&gt;</span> <span class="p">{</span>

  <span class="c1">// register user</span>
  <span class="nx">await</span> <span class="nx">t</span>
    <span class="p">.</span><span class="nx">navigateTo</span><span class="p">(</span><span class="err">`</span><span class="nx">$</span><span class="p">{</span><span class="nx">TEST_URL</span><span class="p">}</span><span class="o">/</span><span class="nx">register</span><span class="err">`</span><span class="p">)</span>
    <span class="p">.</span><span class="nx">typeText</span><span class="p">(</span><span class="s1">&#39;input[name=&quot;username&quot;]&#39;</span><span class="p">,</span> <span class="nx">username</span><span class="p">)</span>
    <span class="p">.</span><span class="nx">typeText</span><span class="p">(</span><span class="s1">&#39;input[name=&quot;email&quot;]&#39;</span><span class="p">,</span> <span class="nx">email</span><span class="p">)</span>
    <span class="p">.</span><span class="nx">typeText</span><span class="p">(</span><span class="s1">&#39;input[name=&quot;password&quot;]&#39;</span><span class="p">,</span> <span class="s1">&#39;test&#39;</span><span class="p">)</span>
    <span class="p">.</span><span class="nx">click</span><span class="p">(</span><span class="nx">Selector</span><span class="p">(</span><span class="s1">&#39;input[type=&quot;submit&quot;]&#39;</span><span class="p">))</span>

  <span class="c1">// assert user is redirected to &#39;/&#39;</span>
  <span class="c1">// assert &#39;/&#39; is displayed properly</span>
  <span class="kr">const</span> <span class="nx">tableRow</span> <span class="o">=</span> <span class="nx">Selector</span><span class="p">(</span><span class="s1">&#39;td&#39;</span><span class="p">).</span><span class="nx">withText</span><span class="p">(</span><span class="nx">username</span><span class="p">).</span><span class="nx">parent</span><span class="p">();</span>
  <span class="nx">await</span> <span class="nx">t</span>
    <span class="p">.</span><span class="nx">expect</span><span class="p">(</span><span class="nx">Selector</span><span class="p">(</span><span class="s1">&#39;H1&#39;</span><span class="p">).</span><span class="nx">withText</span><span class="p">(</span><span class="s1">&#39;All Users&#39;</span><span class="p">).</span><span class="nx">exists</span><span class="p">).</span><span class="nx">ok</span><span class="p">()</span>
    <span class="p">.</span><span class="nx">expect</span><span class="p">(</span><span class="nx">tableRow</span><span class="p">.</span><span class="nx">child</span><span class="p">().</span><span class="nx">withText</span><span class="p">(</span><span class="nx">username</span><span class="p">).</span><span class="nx">exists</span><span class="p">).</span><span class="nx">ok</span><span class="p">()</span>
    <span class="p">.</span><span class="nx">expect</span><span class="p">(</span><span class="nx">tableRow</span><span class="p">.</span><span class="nx">child</span><span class="p">().</span><span class="nx">withText</span><span class="p">(</span><span class="nx">email</span><span class="p">).</span><span class="nx">exists</span><span class="p">).</span><span class="nx">ok</span><span class="p">()</span>
    <span class="p">.</span><span class="nx">expect</span><span class="p">(</span><span class="nx">Selector</span><span class="p">(</span><span class="s1">&#39;a&#39;</span><span class="p">).</span><span class="nx">withText</span><span class="p">(</span><span class="s1">&#39;User Status&#39;</span><span class="p">).</span><span class="nx">exists</span><span class="p">).</span><span class="nx">ok</span><span class="p">()</span>
    <span class="p">.</span><span class="nx">expect</span><span class="p">(</span><span class="nx">Selector</span><span class="p">(</span><span class="s1">&#39;a&#39;</span><span class="p">).</span><span class="nx">withText</span><span class="p">(</span><span class="s1">&#39;Log Out&#39;</span><span class="p">).</span><span class="nx">exists</span><span class="p">).</span><span class="nx">ok</span><span class="p">()</span>
    <span class="p">.</span><span class="nx">expect</span><span class="p">(</span><span class="nx">Selector</span><span class="p">(</span><span class="s1">&#39;a&#39;</span><span class="p">).</span><span class="nx">withText</span><span class="p">(</span><span class="s1">&#39;Register&#39;</span><span class="p">).</span><span class="nx">exists</span><span class="p">).</span><span class="nx">notOk</span><span class="p">()</span>
    <span class="p">.</span><span class="nx">expect</span><span class="p">(</span><span class="nx">Selector</span><span class="p">(</span><span class="s1">&#39;a&#39;</span><span class="p">).</span><span class="nx">withText</span><span class="p">(</span><span class="s1">&#39;Log In&#39;</span><span class="p">).</span><span class="nx">exists</span><span class="p">).</span><span class="nx">notOk</span><span class="p">()</span>

<span class="p">});</span>
</code></pre></div>
<p>Add the import and global variables at the top:</p>
<div class="highlight"><pre><code class="language-javascript" data-lang="javascript"><span class="kr">const</span> <span class="nx">randomstring</span> <span class="o">=</span> <span class="nx">require</span><span class="p">(</span><span class="s1">&#39;randomstring&#39;</span><span class="p">);</span>

<span class="kr">const</span> <span class="nx">username</span> <span class="o">=</span> <span class="nx">randomstring</span><span class="p">.</span><span class="nx">generate</span><span class="p">();</span>
<span class="kr">const</span> <span class="nx">email</span> <span class="o">=</span> <span class="err">`</span><span class="nx">$</span><span class="p">{</span><span class="nx">username</span><span class="p">}</span><span class="err">@</span><span class="nx">test</span><span class="p">.</span><span class="nx">com</span><span class="err">`</span><span class="p">;</span>
</code></pre></div>
<p>Make sure to install the dependency as well:</p>
<div class="highlight"><pre><code class="language-sh" data-lang="sh"><span class="nv">$ </span>npm install randomstring --save
</code></pre></div></li>
</ol>

<p>Since we&#39;re not handling errors yet, let&#39;s hold off on these two test cases:</p>

<ol>
<li><em>should throw an error if the username is taken</em></li>
<li><em>should throw an error if the email is taken</em></li>
</ol>

<h4 id="login">Login</h4>

<blockquote>
<p>Try writing the next few tests on your own!</p>
</blockquote>

<p>Add a new file called <em>login.test.js</em> to the &quot;e2e&quot; directory:</p>
<div class="highlight"><pre><code class="language-javascript" data-lang="javascript"><span class="kr">import</span> <span class="p">{</span> <span class="nx">Selector</span> <span class="p">}</span> <span class="nx">from</span> <span class="s1">&#39;testcafe&#39;</span><span class="p">;</span>

<span class="kr">const</span> <span class="nx">randomstring</span> <span class="o">=</span> <span class="nx">require</span><span class="p">(</span><span class="s1">&#39;randomstring&#39;</span><span class="p">);</span>

<span class="kr">const</span> <span class="nx">username</span> <span class="o">=</span> <span class="nx">randomstring</span><span class="p">.</span><span class="nx">generate</span><span class="p">();</span>
<span class="kr">const</span> <span class="nx">email</span> <span class="o">=</span> <span class="err">`</span><span class="nx">$</span><span class="p">{</span><span class="nx">username</span><span class="p">}</span><span class="err">@</span><span class="nx">test</span><span class="p">.</span><span class="nx">com</span><span class="err">`</span><span class="p">;</span>

<span class="kr">const</span> <span class="nx">TEST_URL</span> <span class="o">=</span> <span class="nx">process</span><span class="p">.</span><span class="nx">env</span><span class="p">.</span><span class="nx">TEST_URL</span><span class="p">;</span>

<span class="nx">fixture</span><span class="p">(</span><span class="s1">&#39;/login&#39;</span><span class="p">).</span><span class="nx">page</span><span class="p">(</span><span class="err">`</span><span class="nx">$</span><span class="p">{</span><span class="nx">TEST_URL</span><span class="p">}</span><span class="o">/</span><span class="nx">login</span><span class="err">`</span><span class="p">);</span>
</code></pre></div>
<p>Now add the following test specs:</p>

<ol>
<li><p><em>should display the sign in form</em></p>
<div class="highlight"><pre><code class="language-javascript" data-lang="javascript"><span class="nx">test</span><span class="p">(</span><span class="err">`</span><span class="nx">should</span> <span class="nx">display</span> <span class="nx">the</span> <span class="nx">sign</span> <span class="k">in</span> <span class="nx">form</span><span class="err">`</span><span class="p">,</span> <span class="nx">async</span> <span class="p">(</span><span class="nx">t</span><span class="p">)</span> <span class="o">=&gt;</span> <span class="p">{</span>
  <span class="nx">await</span> <span class="nx">t</span>
    <span class="p">.</span><span class="nx">navigateTo</span><span class="p">(</span><span class="err">`</span><span class="nx">$</span><span class="p">{</span><span class="nx">TEST_URL</span><span class="p">}</span><span class="o">/</span><span class="nx">login</span><span class="err">`</span><span class="p">)</span>
    <span class="p">.</span><span class="nx">expect</span><span class="p">(</span><span class="nx">Selector</span><span class="p">(</span><span class="s1">&#39;H1&#39;</span><span class="p">).</span><span class="nx">withText</span><span class="p">(</span><span class="s1">&#39;Login&#39;</span><span class="p">).</span><span class="nx">exists</span><span class="p">).</span><span class="nx">ok</span><span class="p">()</span>
    <span class="p">.</span><span class="nx">expect</span><span class="p">(</span><span class="nx">Selector</span><span class="p">(</span><span class="s1">&#39;form&#39;</span><span class="p">).</span><span class="nx">exists</span><span class="p">).</span><span class="nx">ok</span><span class="p">()</span>
<span class="p">});</span>
</code></pre></div></li>
<li><p><em>should allow a user to sign in</em></p>
<div class="highlight"><pre><code class="language-javascript" data-lang="javascript"><span class="nx">test</span><span class="p">(</span><span class="err">`</span><span class="nx">should</span> <span class="nx">allow</span> <span class="nx">a</span> <span class="nx">user</span> <span class="nx">to</span> <span class="nx">sign</span> <span class="k">in</span><span class="err">`</span><span class="p">,</span> <span class="nx">async</span> <span class="p">(</span><span class="nx">t</span><span class="p">)</span> <span class="o">=&gt;</span> <span class="p">{</span>

  <span class="c1">// register user</span>
  <span class="nx">await</span> <span class="nx">t</span>
    <span class="p">.</span><span class="nx">navigateTo</span><span class="p">(</span><span class="err">`</span><span class="nx">$</span><span class="p">{</span><span class="nx">TEST_URL</span><span class="p">}</span><span class="o">/</span><span class="nx">register</span><span class="err">`</span><span class="p">)</span>
    <span class="p">.</span><span class="nx">typeText</span><span class="p">(</span><span class="s1">&#39;input[name=&quot;username&quot;]&#39;</span><span class="p">,</span> <span class="nx">username</span><span class="p">)</span>
    <span class="p">.</span><span class="nx">typeText</span><span class="p">(</span><span class="s1">&#39;input[name=&quot;email&quot;]&#39;</span><span class="p">,</span> <span class="nx">email</span><span class="p">)</span>
    <span class="p">.</span><span class="nx">typeText</span><span class="p">(</span><span class="s1">&#39;input[name=&quot;password&quot;]&#39;</span><span class="p">,</span> <span class="s1">&#39;test&#39;</span><span class="p">)</span>
    <span class="p">.</span><span class="nx">click</span><span class="p">(</span><span class="nx">Selector</span><span class="p">(</span><span class="s1">&#39;input[type=&quot;submit&quot;]&#39;</span><span class="p">))</span>

  <span class="c1">// log a user out</span>
  <span class="nx">await</span> <span class="nx">t</span>
    <span class="p">.</span><span class="nx">click</span><span class="p">(</span><span class="nx">Selector</span><span class="p">(</span><span class="s1">&#39;a&#39;</span><span class="p">).</span><span class="nx">withText</span><span class="p">(</span><span class="s1">&#39;Log Out&#39;</span><span class="p">))</span>

  <span class="c1">// log a user in</span>
  <span class="nx">await</span> <span class="nx">t</span>
    <span class="p">.</span><span class="nx">navigateTo</span><span class="p">(</span><span class="err">`</span><span class="nx">$</span><span class="p">{</span><span class="nx">TEST_URL</span><span class="p">}</span><span class="o">/</span><span class="nx">login</span><span class="err">`</span><span class="p">)</span>
    <span class="p">.</span><span class="nx">typeText</span><span class="p">(</span><span class="s1">&#39;input[name=&quot;email&quot;]&#39;</span><span class="p">,</span> <span class="nx">email</span><span class="p">)</span>
    <span class="p">.</span><span class="nx">typeText</span><span class="p">(</span><span class="s1">&#39;input[name=&quot;password&quot;]&#39;</span><span class="p">,</span> <span class="s1">&#39;test&#39;</span><span class="p">)</span>
    <span class="p">.</span><span class="nx">click</span><span class="p">(</span><span class="nx">Selector</span><span class="p">(</span><span class="s1">&#39;input[type=&quot;submit&quot;]&#39;</span><span class="p">))</span>

  <span class="c1">// assert user is redirected to &#39;/&#39;</span>
  <span class="c1">// assert &#39;/&#39; is displayed properly</span>
  <span class="kr">const</span> <span class="nx">tableRow</span> <span class="o">=</span> <span class="nx">Selector</span><span class="p">(</span><span class="s1">&#39;td&#39;</span><span class="p">).</span><span class="nx">withText</span><span class="p">(</span><span class="nx">username</span><span class="p">).</span><span class="nx">parent</span><span class="p">();</span>
  <span class="nx">await</span> <span class="nx">t</span>
    <span class="p">.</span><span class="nx">expect</span><span class="p">(</span><span class="nx">Selector</span><span class="p">(</span><span class="s1">&#39;H1&#39;</span><span class="p">).</span><span class="nx">withText</span><span class="p">(</span><span class="s1">&#39;All Users&#39;</span><span class="p">).</span><span class="nx">exists</span><span class="p">).</span><span class="nx">ok</span><span class="p">()</span>
    <span class="p">.</span><span class="nx">expect</span><span class="p">(</span><span class="nx">tableRow</span><span class="p">.</span><span class="nx">child</span><span class="p">().</span><span class="nx">withText</span><span class="p">(</span><span class="nx">username</span><span class="p">).</span><span class="nx">exists</span><span class="p">).</span><span class="nx">ok</span><span class="p">()</span>
    <span class="p">.</span><span class="nx">expect</span><span class="p">(</span><span class="nx">tableRow</span><span class="p">.</span><span class="nx">child</span><span class="p">().</span><span class="nx">withText</span><span class="p">(</span><span class="nx">email</span><span class="p">).</span><span class="nx">exists</span><span class="p">).</span><span class="nx">ok</span><span class="p">()</span>
    <span class="p">.</span><span class="nx">expect</span><span class="p">(</span><span class="nx">Selector</span><span class="p">(</span><span class="s1">&#39;a&#39;</span><span class="p">).</span><span class="nx">withText</span><span class="p">(</span><span class="s1">&#39;User Status&#39;</span><span class="p">).</span><span class="nx">exists</span><span class="p">).</span><span class="nx">ok</span><span class="p">()</span>
    <span class="p">.</span><span class="nx">expect</span><span class="p">(</span><span class="nx">Selector</span><span class="p">(</span><span class="s1">&#39;a&#39;</span><span class="p">).</span><span class="nx">withText</span><span class="p">(</span><span class="s1">&#39;Log Out&#39;</span><span class="p">).</span><span class="nx">exists</span><span class="p">).</span><span class="nx">ok</span><span class="p">()</span>
    <span class="p">.</span><span class="nx">expect</span><span class="p">(</span><span class="nx">Selector</span><span class="p">(</span><span class="s1">&#39;a&#39;</span><span class="p">).</span><span class="nx">withText</span><span class="p">(</span><span class="s1">&#39;Register&#39;</span><span class="p">).</span><span class="nx">exists</span><span class="p">).</span><span class="nx">notOk</span><span class="p">()</span>
    <span class="p">.</span><span class="nx">expect</span><span class="p">(</span><span class="nx">Selector</span><span class="p">(</span><span class="s1">&#39;a&#39;</span><span class="p">).</span><span class="nx">withText</span><span class="p">(</span><span class="s1">&#39;Log In&#39;</span><span class="p">).</span><span class="nx">exists</span><span class="p">).</span><span class="nx">notOk</span><span class="p">()</span>

<span class="p">});</span>
</code></pre></div></li>
</ol>

<p>Again, since we&#39;re not handling errors yet, let&#39;s hold off on the following test case: <em>should throw an error if the credentials are incorrect</em>.</p>

<h4 id="logout">Logout</h4>

<p>Let&#39;s just add <em>should log a user out</em> to the previous test case in <em>login.test.js</em>:</p>
<div class="highlight"><pre><code class="language-javascript" data-lang="javascript"><span class="nx">test</span><span class="p">(</span><span class="err">`</span><span class="nx">should</span> <span class="nx">allow</span> <span class="nx">a</span> <span class="nx">user</span> <span class="nx">to</span> <span class="nx">sign</span> <span class="k">in</span><span class="err">`</span><span class="p">,</span> <span class="nx">async</span> <span class="p">(</span><span class="nx">t</span><span class="p">)</span> <span class="o">=&gt;</span> <span class="p">{</span>

  <span class="c1">// register user</span>
  <span class="nx">await</span> <span class="nx">t</span>
    <span class="p">.</span><span class="nx">navigateTo</span><span class="p">(</span><span class="err">`</span><span class="nx">$</span><span class="p">{</span><span class="nx">TEST_URL</span><span class="p">}</span><span class="o">/</span><span class="nx">register</span><span class="err">`</span><span class="p">)</span>
    <span class="p">.</span><span class="nx">typeText</span><span class="p">(</span><span class="s1">&#39;input[name=&quot;username&quot;]&#39;</span><span class="p">,</span> <span class="nx">username</span><span class="p">)</span>
    <span class="p">.</span><span class="nx">typeText</span><span class="p">(</span><span class="s1">&#39;input[name=&quot;email&quot;]&#39;</span><span class="p">,</span> <span class="nx">email</span><span class="p">)</span>
    <span class="p">.</span><span class="nx">typeText</span><span class="p">(</span><span class="s1">&#39;input[name=&quot;password&quot;]&#39;</span><span class="p">,</span> <span class="s1">&#39;test&#39;</span><span class="p">)</span>
    <span class="p">.</span><span class="nx">click</span><span class="p">(</span><span class="nx">Selector</span><span class="p">(</span><span class="s1">&#39;input[type=&quot;submit&quot;]&#39;</span><span class="p">))</span>

  <span class="c1">// log a user out</span>
  <span class="nx">await</span> <span class="nx">t</span>
    <span class="p">.</span><span class="nx">click</span><span class="p">(</span><span class="nx">Selector</span><span class="p">(</span><span class="s1">&#39;a&#39;</span><span class="p">).</span><span class="nx">withText</span><span class="p">(</span><span class="s1">&#39;Log Out&#39;</span><span class="p">))</span>

  <span class="c1">// log a user in</span>
  <span class="nx">await</span> <span class="nx">t</span>
    <span class="p">.</span><span class="nx">navigateTo</span><span class="p">(</span><span class="err">`</span><span class="nx">$</span><span class="p">{</span><span class="nx">TEST_URL</span><span class="p">}</span><span class="o">/</span><span class="nx">login</span><span class="err">`</span><span class="p">)</span>
    <span class="p">.</span><span class="nx">typeText</span><span class="p">(</span><span class="s1">&#39;input[name=&quot;email&quot;]&#39;</span><span class="p">,</span> <span class="nx">email</span><span class="p">)</span>
    <span class="p">.</span><span class="nx">typeText</span><span class="p">(</span><span class="s1">&#39;input[name=&quot;password&quot;]&#39;</span><span class="p">,</span> <span class="s1">&#39;test&#39;</span><span class="p">)</span>
    <span class="p">.</span><span class="nx">click</span><span class="p">(</span><span class="nx">Selector</span><span class="p">(</span><span class="s1">&#39;input[type=&quot;submit&quot;]&#39;</span><span class="p">))</span>

  <span class="c1">// assert user is redirected to &#39;/&#39;</span>
  <span class="c1">// assert &#39;/&#39; is displayed properly</span>
  <span class="kr">const</span> <span class="nx">tableRow</span> <span class="o">=</span> <span class="nx">Selector</span><span class="p">(</span><span class="s1">&#39;td&#39;</span><span class="p">).</span><span class="nx">withText</span><span class="p">(</span><span class="nx">username</span><span class="p">).</span><span class="nx">parent</span><span class="p">();</span>
  <span class="nx">await</span> <span class="nx">t</span>
    <span class="p">.</span><span class="nx">expect</span><span class="p">(</span><span class="nx">Selector</span><span class="p">(</span><span class="s1">&#39;H1&#39;</span><span class="p">).</span><span class="nx">withText</span><span class="p">(</span><span class="s1">&#39;All Users&#39;</span><span class="p">).</span><span class="nx">exists</span><span class="p">).</span><span class="nx">ok</span><span class="p">()</span>
    <span class="p">.</span><span class="nx">expect</span><span class="p">(</span><span class="nx">tableRow</span><span class="p">.</span><span class="nx">child</span><span class="p">().</span><span class="nx">withText</span><span class="p">(</span><span class="nx">username</span><span class="p">).</span><span class="nx">exists</span><span class="p">).</span><span class="nx">ok</span><span class="p">()</span>
    <span class="p">.</span><span class="nx">expect</span><span class="p">(</span><span class="nx">tableRow</span><span class="p">.</span><span class="nx">child</span><span class="p">().</span><span class="nx">withText</span><span class="p">(</span><span class="nx">email</span><span class="p">).</span><span class="nx">exists</span><span class="p">).</span><span class="nx">ok</span><span class="p">()</span>
    <span class="p">.</span><span class="nx">expect</span><span class="p">(</span><span class="nx">Selector</span><span class="p">(</span><span class="s1">&#39;a&#39;</span><span class="p">).</span><span class="nx">withText</span><span class="p">(</span><span class="s1">&#39;User Status&#39;</span><span class="p">).</span><span class="nx">exists</span><span class="p">).</span><span class="nx">ok</span><span class="p">()</span>
    <span class="p">.</span><span class="nx">expect</span><span class="p">(</span><span class="nx">Selector</span><span class="p">(</span><span class="s1">&#39;a&#39;</span><span class="p">).</span><span class="nx">withText</span><span class="p">(</span><span class="s1">&#39;Log Out&#39;</span><span class="p">).</span><span class="nx">exists</span><span class="p">).</span><span class="nx">ok</span><span class="p">()</span>
    <span class="p">.</span><span class="nx">expect</span><span class="p">(</span><span class="nx">Selector</span><span class="p">(</span><span class="s1">&#39;a&#39;</span><span class="p">).</span><span class="nx">withText</span><span class="p">(</span><span class="s1">&#39;Register&#39;</span><span class="p">).</span><span class="nx">exists</span><span class="p">).</span><span class="nx">notOk</span><span class="p">()</span>
    <span class="p">.</span><span class="nx">expect</span><span class="p">(</span><span class="nx">Selector</span><span class="p">(</span><span class="s1">&#39;a&#39;</span><span class="p">).</span><span class="nx">withText</span><span class="p">(</span><span class="s1">&#39;Log In&#39;</span><span class="p">).</span><span class="nx">exists</span><span class="p">).</span><span class="nx">notOk</span><span class="p">()</span>

  <span class="c1">// log a user out</span>
  <span class="nx">await</span> <span class="nx">t</span>
    <span class="p">.</span><span class="nx">click</span><span class="p">(</span><span class="nx">Selector</span><span class="p">(</span><span class="s1">&#39;a&#39;</span><span class="p">).</span><span class="nx">withText</span><span class="p">(</span><span class="s1">&#39;Log Out&#39;</span><span class="p">))</span>

  <span class="c1">// assert &#39;/logout&#39; is displayed properly</span>
  <span class="nx">await</span> <span class="nx">t</span>
    <span class="p">.</span><span class="nx">expect</span><span class="p">(</span><span class="nx">Selector</span><span class="p">(</span><span class="s1">&#39;p&#39;</span><span class="p">).</span><span class="nx">withText</span><span class="p">(</span><span class="s1">&#39;You are now logged out&#39;</span><span class="p">).</span><span class="nx">exists</span><span class="p">).</span><span class="nx">ok</span><span class="p">()</span>
    <span class="p">.</span><span class="nx">expect</span><span class="p">(</span><span class="nx">Selector</span><span class="p">(</span><span class="s1">&#39;a&#39;</span><span class="p">).</span><span class="nx">withText</span><span class="p">(</span><span class="s1">&#39;User Status&#39;</span><span class="p">).</span><span class="nx">exists</span><span class="p">).</span><span class="nx">notOk</span><span class="p">()</span>
    <span class="p">.</span><span class="nx">expect</span><span class="p">(</span><span class="nx">Selector</span><span class="p">(</span><span class="s1">&#39;a&#39;</span><span class="p">).</span><span class="nx">withText</span><span class="p">(</span><span class="s1">&#39;Log Out&#39;</span><span class="p">).</span><span class="nx">exists</span><span class="p">).</span><span class="nx">notOk</span><span class="p">()</span>
    <span class="p">.</span><span class="nx">expect</span><span class="p">(</span><span class="nx">Selector</span><span class="p">(</span><span class="s1">&#39;a&#39;</span><span class="p">).</span><span class="nx">withText</span><span class="p">(</span><span class="s1">&#39;Register&#39;</span><span class="p">).</span><span class="nx">exists</span><span class="p">).</span><span class="nx">ok</span><span class="p">()</span>
    <span class="p">.</span><span class="nx">expect</span><span class="p">(</span><span class="nx">Selector</span><span class="p">(</span><span class="s1">&#39;a&#39;</span><span class="p">).</span><span class="nx">withText</span><span class="p">(</span><span class="s1">&#39;Log In&#39;</span><span class="p">).</span><span class="nx">exists</span><span class="p">).</span><span class="nx">ok</span><span class="p">()</span>

<span class="p">});</span>
</code></pre></div>
<h4 id="status">Status</h4>

<p>Add a new file called <em>status.test.js</em> to the &quot;e2e&quot; directory:</p>
<div class="highlight"><pre><code class="language-javascript" data-lang="javascript"><span class="kr">import</span> <span class="p">{</span> <span class="nx">Selector</span> <span class="p">}</span> <span class="nx">from</span> <span class="s1">&#39;testcafe&#39;</span><span class="p">;</span>

<span class="kr">const</span> <span class="nx">randomstring</span> <span class="o">=</span> <span class="nx">require</span><span class="p">(</span><span class="s1">&#39;randomstring&#39;</span><span class="p">);</span>

<span class="kr">const</span> <span class="nx">username</span> <span class="o">=</span> <span class="nx">randomstring</span><span class="p">.</span><span class="nx">generate</span><span class="p">();</span>
<span class="kr">const</span> <span class="nx">email</span> <span class="o">=</span> <span class="err">`</span><span class="nx">$</span><span class="p">{</span><span class="nx">username</span><span class="p">}</span><span class="err">@</span><span class="nx">test</span><span class="p">.</span><span class="nx">com</span><span class="err">`</span><span class="p">;</span>
<span class="kr">const</span> <span class="nx">currentDate</span> <span class="o">=</span> <span class="k">new</span> <span class="nb">Date</span><span class="p">();</span>

<span class="kr">const</span> <span class="nx">TEST_URL</span> <span class="o">=</span> <span class="nx">process</span><span class="p">.</span><span class="nx">env</span><span class="p">.</span><span class="nx">TEST_URL</span><span class="p">;</span>

<span class="nx">fixture</span><span class="p">(</span><span class="s1">&#39;/status&#39;</span><span class="p">).</span><span class="nx">page</span><span class="p">(</span><span class="err">`</span><span class="nx">$</span><span class="p">{</span><span class="nx">TEST_URL</span><span class="p">}</span><span class="o">/</span><span class="nx">status</span><span class="err">`</span><span class="p">);</span>
</code></pre></div>
<p>Add the following test specs:</p>

<ol>
<li><p><em>should display the page if user is not logged in</em></p>
<div class="highlight"><pre><code class="language-javascript" data-lang="javascript"><span class="nx">test</span><span class="p">(</span><span class="err">`</span><span class="nx">should</span> <span class="nx">display</span> <span class="nx">the</span> <span class="nx">page</span> <span class="k">if</span> <span class="nx">user</span> <span class="nx">is</span> <span class="nx">not</span> <span class="nx">logged</span> <span class="k">in</span><span class="err">`</span><span class="p">,</span> <span class="nx">async</span> <span class="p">(</span><span class="nx">t</span><span class="p">)</span> <span class="o">=&gt;</span> <span class="p">{</span>
  <span class="nx">await</span> <span class="nx">t</span>
    <span class="p">.</span><span class="nx">navigateTo</span><span class="p">(</span><span class="err">`</span><span class="nx">$</span><span class="p">{</span><span class="nx">TEST_URL</span><span class="p">}</span><span class="o">/</span><span class="nx">status</span><span class="err">`</span><span class="p">)</span>
    <span class="p">.</span><span class="nx">expect</span><span class="p">(</span><span class="nx">Selector</span><span class="p">(</span><span class="s1">&#39;p&#39;</span><span class="p">).</span><span class="nx">withText</span><span class="p">(</span>
      <span class="s1">&#39;You must be logged in to view this.&#39;</span><span class="p">).</span><span class="nx">exists</span><span class="p">).</span><span class="nx">ok</span><span class="p">()</span>
    <span class="p">.</span><span class="nx">expect</span><span class="p">(</span><span class="nx">Selector</span><span class="p">(</span><span class="s1">&#39;a&#39;</span><span class="p">).</span><span class="nx">withText</span><span class="p">(</span><span class="s1">&#39;User Status&#39;</span><span class="p">).</span><span class="nx">exists</span><span class="p">).</span><span class="nx">notOk</span><span class="p">()</span>
    <span class="p">.</span><span class="nx">expect</span><span class="p">(</span><span class="nx">Selector</span><span class="p">(</span><span class="s1">&#39;a&#39;</span><span class="p">).</span><span class="nx">withText</span><span class="p">(</span><span class="s1">&#39;Log Out&#39;</span><span class="p">).</span><span class="nx">exists</span><span class="p">).</span><span class="nx">notOk</span><span class="p">()</span>
    <span class="p">.</span><span class="nx">expect</span><span class="p">(</span><span class="nx">Selector</span><span class="p">(</span><span class="s1">&#39;a&#39;</span><span class="p">).</span><span class="nx">withText</span><span class="p">(</span><span class="s1">&#39;Register&#39;</span><span class="p">).</span><span class="nx">exists</span><span class="p">).</span><span class="nx">ok</span><span class="p">()</span>
    <span class="p">.</span><span class="nx">expect</span><span class="p">(</span><span class="nx">Selector</span><span class="p">(</span><span class="s1">&#39;a&#39;</span><span class="p">).</span><span class="nx">withText</span><span class="p">(</span><span class="s1">&#39;Log In&#39;</span><span class="p">).</span><span class="nx">exists</span><span class="p">).</span><span class="nx">ok</span><span class="p">()</span>
<span class="p">});</span>
</code></pre></div></li>
<li><p><em>should display user info if user is logged in</em></p>
<div class="highlight"><pre><code class="language-javascript" data-lang="javascript"><span class="nx">test</span><span class="p">(</span><span class="err">`</span><span class="nx">should</span> <span class="nx">display</span> <span class="nx">user</span> <span class="nx">info</span> <span class="k">if</span> <span class="nx">user</span> <span class="nx">is</span> <span class="nx">logged</span> <span class="k">in</span><span class="err">`</span><span class="p">,</span> <span class="nx">async</span> <span class="p">(</span><span class="nx">t</span><span class="p">)</span> <span class="o">=&gt;</span> <span class="p">{</span>

  <span class="c1">// register user</span>
  <span class="nx">await</span> <span class="nx">t</span>
    <span class="p">.</span><span class="nx">navigateTo</span><span class="p">(</span><span class="err">`</span><span class="nx">$</span><span class="p">{</span><span class="nx">TEST_URL</span><span class="p">}</span><span class="o">/</span><span class="nx">register</span><span class="err">`</span><span class="p">)</span>
    <span class="p">.</span><span class="nx">typeText</span><span class="p">(</span><span class="s1">&#39;input[name=&quot;username&quot;]&#39;</span><span class="p">,</span> <span class="nx">username</span><span class="p">)</span>
    <span class="p">.</span><span class="nx">typeText</span><span class="p">(</span><span class="s1">&#39;input[name=&quot;email&quot;]&#39;</span><span class="p">,</span> <span class="nx">email</span><span class="p">)</span>
    <span class="p">.</span><span class="nx">typeText</span><span class="p">(</span><span class="s1">&#39;input[name=&quot;password&quot;]&#39;</span><span class="p">,</span> <span class="s1">&#39;test&#39;</span><span class="p">)</span>
    <span class="p">.</span><span class="nx">click</span><span class="p">(</span><span class="nx">Selector</span><span class="p">(</span><span class="s1">&#39;input[type=&quot;submit&quot;]&#39;</span><span class="p">))</span>

  <span class="c1">// assert &#39;/status&#39; is displayed properly</span>
  <span class="nx">await</span> <span class="nx">t</span>
    <span class="p">.</span><span class="nx">navigateTo</span><span class="p">(</span><span class="err">`</span><span class="nx">$</span><span class="p">{</span><span class="nx">TEST_URL</span><span class="p">}</span><span class="o">/</span><span class="nx">status</span><span class="err">`</span><span class="p">)</span>
    <span class="p">.</span><span class="nx">expect</span><span class="p">(</span><span class="nx">Selector</span><span class="p">(</span><span class="s1">&#39;li &gt; strong&#39;</span><span class="p">).</span><span class="nx">withText</span><span class="p">(</span><span class="s1">&#39;User ID:&#39;</span><span class="p">).</span><span class="nx">exists</span><span class="p">).</span><span class="nx">ok</span><span class="p">()</span>
    <span class="p">.</span><span class="nx">expect</span><span class="p">(</span><span class="nx">Selector</span><span class="p">(</span><span class="s1">&#39;li &gt; strong&#39;</span><span class="p">).</span><span class="nx">withText</span><span class="p">(</span><span class="s1">&#39;Email:&#39;</span><span class="p">).</span><span class="nx">exists</span><span class="p">).</span><span class="nx">ok</span><span class="p">()</span>
    <span class="p">.</span><span class="nx">expect</span><span class="p">(</span><span class="nx">Selector</span><span class="p">(</span><span class="s1">&#39;li&#39;</span><span class="p">).</span><span class="nx">withText</span><span class="p">(</span><span class="nx">email</span><span class="p">).</span><span class="nx">exists</span><span class="p">).</span><span class="nx">ok</span><span class="p">()</span>
    <span class="p">.</span><span class="nx">expect</span><span class="p">(</span><span class="nx">Selector</span><span class="p">(</span><span class="s1">&#39;li &gt; strong&#39;</span><span class="p">).</span><span class="nx">withText</span><span class="p">(</span><span class="s1">&#39;Username:&#39;</span><span class="p">).</span><span class="nx">exists</span><span class="p">).</span><span class="nx">ok</span><span class="p">()</span>
    <span class="p">.</span><span class="nx">expect</span><span class="p">(</span><span class="nx">Selector</span><span class="p">(</span><span class="s1">&#39;li&#39;</span><span class="p">).</span><span class="nx">withText</span><span class="p">(</span><span class="nx">username</span><span class="p">).</span><span class="nx">exists</span><span class="p">).</span><span class="nx">ok</span><span class="p">()</span>
    <span class="p">.</span><span class="nx">expect</span><span class="p">(</span><span class="nx">Selector</span><span class="p">(</span><span class="s1">&#39;a&#39;</span><span class="p">).</span><span class="nx">withText</span><span class="p">(</span><span class="s1">&#39;User Status&#39;</span><span class="p">).</span><span class="nx">exists</span><span class="p">).</span><span class="nx">ok</span><span class="p">()</span>
    <span class="p">.</span><span class="nx">expect</span><span class="p">(</span><span class="nx">Selector</span><span class="p">(</span><span class="s1">&#39;a&#39;</span><span class="p">).</span><span class="nx">withText</span><span class="p">(</span><span class="s1">&#39;Log Out&#39;</span><span class="p">).</span><span class="nx">exists</span><span class="p">).</span><span class="nx">ok</span><span class="p">()</span>
    <span class="p">.</span><span class="nx">expect</span><span class="p">(</span><span class="nx">Selector</span><span class="p">(</span><span class="s1">&#39;a&#39;</span><span class="p">).</span><span class="nx">withText</span><span class="p">(</span><span class="s1">&#39;Register&#39;</span><span class="p">).</span><span class="nx">exists</span><span class="p">).</span><span class="nx">notOk</span><span class="p">()</span>
    <span class="p">.</span><span class="nx">expect</span><span class="p">(</span><span class="nx">Selector</span><span class="p">(</span><span class="s1">&#39;a&#39;</span><span class="p">).</span><span class="nx">withText</span><span class="p">(</span><span class="s1">&#39;Log In&#39;</span><span class="p">).</span><span class="nx">exists</span><span class="p">).</span><span class="nx">notOk</span><span class="p">()</span>

<span class="p">});</span>
</code></pre></div></li>
</ol>

<h4 id="main-page">Main Page</h4>

<p>Within <em>index.test.js</em>, remove <em>users should be able to view the page</em> and, in its place, add <em>should display the page correctly if a user is not logged in</em>:</p>
<div class="highlight"><pre><code class="language-javascript" data-lang="javascript"><span class="nx">test</span><span class="p">(</span><span class="err">`</span><span class="nx">should</span> <span class="nx">display</span> <span class="nx">the</span> <span class="nx">page</span> <span class="nx">correctly</span> <span class="k">if</span> <span class="nx">a</span> <span class="nx">user</span> <span class="nx">is</span> <span class="nx">not</span> <span class="nx">logged</span> <span class="k">in</span><span class="err">`</span><span class="p">,</span> <span class="nx">async</span> <span class="p">(</span><span class="nx">t</span><span class="p">)</span> <span class="o">=&gt;</span> <span class="p">{</span>
  <span class="nx">await</span> <span class="nx">t</span>
    <span class="p">.</span><span class="nx">navigateTo</span><span class="p">(</span><span class="nx">TEST_URL</span><span class="p">)</span>
    <span class="p">.</span><span class="nx">expect</span><span class="p">(</span><span class="nx">Selector</span><span class="p">(</span><span class="s1">&#39;H1&#39;</span><span class="p">).</span><span class="nx">withText</span><span class="p">(</span><span class="s1">&#39;All Users&#39;</span><span class="p">).</span><span class="nx">exists</span><span class="p">).</span><span class="nx">ok</span><span class="p">()</span>
    <span class="p">.</span><span class="nx">expect</span><span class="p">(</span><span class="nx">Selector</span><span class="p">(</span><span class="s1">&#39;a&#39;</span><span class="p">).</span><span class="nx">withText</span><span class="p">(</span><span class="s1">&#39;User Status&#39;</span><span class="p">).</span><span class="nx">exists</span><span class="p">).</span><span class="nx">notOk</span><span class="p">()</span>
    <span class="p">.</span><span class="nx">expect</span><span class="p">(</span><span class="nx">Selector</span><span class="p">(</span><span class="s1">&#39;a&#39;</span><span class="p">).</span><span class="nx">withText</span><span class="p">(</span><span class="s1">&#39;Log Out&#39;</span><span class="p">).</span><span class="nx">exists</span><span class="p">).</span><span class="nx">notOk</span><span class="p">()</span>
    <span class="p">.</span><span class="nx">expect</span><span class="p">(</span><span class="nx">Selector</span><span class="p">(</span><span class="s1">&#39;a&#39;</span><span class="p">).</span><span class="nx">withText</span><span class="p">(</span><span class="s1">&#39;Register&#39;</span><span class="p">).</span><span class="nx">exists</span><span class="p">).</span><span class="nx">ok</span><span class="p">()</span>
    <span class="p">.</span><span class="nx">expect</span><span class="p">(</span><span class="nx">Selector</span><span class="p">(</span><span class="s1">&#39;a&#39;</span><span class="p">).</span><span class="nx">withText</span><span class="p">(</span><span class="s1">&#39;Log In&#39;</span><span class="p">).</span><span class="nx">exists</span><span class="p">).</span><span class="nx">ok</span><span class="p">()</span>
<span class="p">});</span>
</code></pre></div>
<h4 id="docker-compose">Docker Compose</h4>

<p>Before running the tests, update the build context for each service to the local environment, to pull in the latest changes locally:</p>
<div class="highlight"><pre><code class="language-yaml" data-lang="yaml"><span class="l-Scalar-Plain">version</span><span class="p-Indicator">:</span> <span class="s">&#39;2.1&#39;</span>

<span class="l-Scalar-Plain">services</span><span class="p-Indicator">:</span>
  <span class="l-Scalar-Plain">users-db</span><span class="p-Indicator">:</span>
    <span class="l-Scalar-Plain">container_name</span><span class="p-Indicator">:</span> <span class="l-Scalar-Plain">users-db</span>
    <span class="l-Scalar-Plain">build</span><span class="p-Indicator">:</span>
      <span class="l-Scalar-Plain">context</span><span class="p-Indicator">:</span> <span class="l-Scalar-Plain">../flask-microservices-users/project/db</span>
    <span class="l-Scalar-Plain">ports</span><span class="p-Indicator">:</span>
        <span class="p-Indicator">-</span> <span class="l-Scalar-Plain">5435:5432</span>  <span class="c1"># expose ports - HOST:CONTAINER</span>
    <span class="l-Scalar-Plain">environment</span><span class="p-Indicator">:</span>
      <span class="p-Indicator">-</span> <span class="l-Scalar-Plain">POSTGRES_USER=postgres</span>
      <span class="p-Indicator">-</span> <span class="l-Scalar-Plain">POSTGRES_PASSWORD=postgres</span>
    <span class="l-Scalar-Plain">healthcheck</span><span class="p-Indicator">:</span>
      <span class="l-Scalar-Plain">test</span><span class="p-Indicator">:</span> <span class="l-Scalar-Plain">exit 0</span>

  <span class="l-Scalar-Plain">users-service</span><span class="p-Indicator">:</span>
    <span class="l-Scalar-Plain">container_name</span><span class="p-Indicator">:</span> <span class="l-Scalar-Plain">users-service</span>
    <span class="l-Scalar-Plain">build</span><span class="p-Indicator">:</span>
      <span class="l-Scalar-Plain">context</span><span class="p-Indicator">:</span> <span class="l-Scalar-Plain">../flask-microservices-users</span>
    <span class="l-Scalar-Plain">ports</span><span class="p-Indicator">:</span>
      <span class="p-Indicator">-</span> <span class="l-Scalar-Plain">5001:5000</span> <span class="c1"># expose ports - HOST:CONTAINER</span>
    <span class="l-Scalar-Plain">environment</span><span class="p-Indicator">:</span>
      <span class="p-Indicator">-</span> <span class="l-Scalar-Plain">APP_SETTINGS=project.config.DevelopmentConfig</span>
      <span class="p-Indicator">-</span> <span class="l-Scalar-Plain">DATABASE_URL=postgres://postgres:postgres@users-db:5432/users_dev</span>
      <span class="p-Indicator">-</span> <span class="l-Scalar-Plain">DATABASE_TEST_URL=postgres://postgres:postgres@users-db:5432/users_test</span>
      <span class="p-Indicator">-</span> <span class="l-Scalar-Plain">SECRET_KEY=my_precious</span>
    <span class="l-Scalar-Plain">depends_on</span><span class="p-Indicator">:</span>
      <span class="l-Scalar-Plain">users-db</span><span class="p-Indicator">:</span>
        <span class="l-Scalar-Plain">condition</span><span class="p-Indicator">:</span> <span class="l-Scalar-Plain">service_healthy</span>
    <span class="l-Scalar-Plain">links</span><span class="p-Indicator">:</span>
      <span class="p-Indicator">-</span> <span class="l-Scalar-Plain">users-db</span>

  <span class="l-Scalar-Plain">nginx</span><span class="p-Indicator">:</span>
    <span class="l-Scalar-Plain">container_name</span><span class="p-Indicator">:</span> <span class="l-Scalar-Plain">nginx</span>
    <span class="l-Scalar-Plain">build</span><span class="p-Indicator">:</span> <span class="l-Scalar-Plain">./nginx/</span>
    <span class="l-Scalar-Plain">restart</span><span class="p-Indicator">:</span> <span class="l-Scalar-Plain">always</span>
    <span class="l-Scalar-Plain">ports</span><span class="p-Indicator">:</span>
      <span class="p-Indicator">-</span> <span class="l-Scalar-Plain">80:80</span>
    <span class="l-Scalar-Plain">depends_on</span><span class="p-Indicator">:</span>
      <span class="l-Scalar-Plain">users-service</span><span class="p-Indicator">:</span>
        <span class="l-Scalar-Plain">condition</span><span class="p-Indicator">:</span> <span class="l-Scalar-Plain">service_started</span>
      <span class="l-Scalar-Plain">web-service</span><span class="p-Indicator">:</span>
        <span class="l-Scalar-Plain">condition</span><span class="p-Indicator">:</span> <span class="l-Scalar-Plain">service_started</span>
    <span class="l-Scalar-Plain">links</span><span class="p-Indicator">:</span>
      <span class="p-Indicator">-</span> <span class="l-Scalar-Plain">users-service</span>
      <span class="p-Indicator">-</span> <span class="l-Scalar-Plain">web-service</span>

  <span class="l-Scalar-Plain">web-service</span><span class="p-Indicator">:</span>
    <span class="l-Scalar-Plain">container_name</span><span class="p-Indicator">:</span> <span class="l-Scalar-Plain">web-service</span>
    <span class="l-Scalar-Plain">build</span><span class="p-Indicator">:</span>
      <span class="l-Scalar-Plain">context</span><span class="p-Indicator">:</span> <span class="l-Scalar-Plain">../flask-microservices-client</span>
      <span class="l-Scalar-Plain">args</span><span class="p-Indicator">:</span>
        <span class="p-Indicator">-</span> <span class="l-Scalar-Plain">NODE_ENV=development</span>
        <span class="p-Indicator">-</span> <span class="l-Scalar-Plain">REACT_APP_USERS_SERVICE_URL=${REACT_APP_USERS_SERVICE_URL}</span>
    <span class="l-Scalar-Plain">ports</span><span class="p-Indicator">:</span>
      <span class="p-Indicator">-</span> <span class="s">&#39;9000:9000&#39;</span> <span class="c1"># expose ports - HOST:CONTAINER</span>
    <span class="l-Scalar-Plain">depends_on</span><span class="p-Indicator">:</span>
      <span class="l-Scalar-Plain">users-service</span><span class="p-Indicator">:</span>
        <span class="l-Scalar-Plain">condition</span><span class="p-Indicator">:</span> <span class="l-Scalar-Plain">service_started</span>
    <span class="l-Scalar-Plain">links</span><span class="p-Indicator">:</span>
      <span class="p-Indicator">-</span> <span class="l-Scalar-Plain">users-service</span>
</code></pre></div>
<h4 id="test">Test!</h4>

<p>Set the environment variable:</p>
<div class="highlight"><pre><code class="language-sh" data-lang="sh"><span class="nv">$ </span><span class="nb">export </span><span class="nv">REACT_APP_USERS_SERVICE_URL</span><span class="o">=</span>DOCKER_MACHINE_DEV_IP
</code></pre></div>
<p>Update the containers:</p>
<div class="highlight"><pre><code class="language-sh" data-lang="sh"><span class="nv">$ </span>docker-compose up -d
</code></pre></div>
<p>Set the <code>TEST_URL</code> variable:</p>
<div class="highlight"><pre><code class="language-sh" data-lang="sh"><span class="nv">$ </span><span class="nb">export </span><span class="nv">TEST_URL</span><span class="o">=</span>DOCKER_MACHINE_DEV_IP
</code></pre></div>
<p>Run the tests. You should see <em>should display user info if user is logged in</em> fail. Why? Well, in that test we logged a user in and then instead of clicking the link for user status, we navigated to it in the browser. Try manually testing both scenarios - clicking the <code>/status</code> link and navigating to the route in the browser. Essentially, when we navigate to the route in the browser, <code>isAuthenticated</code> is reset to its initial value of false.</p>

<p>To fix this, we can set the state of <code>isAuthenticated</code> to <code>true</code> if there is a token in LocalStorage by adding the following <a href="https://facebook.github.io/react/docs/react-component.html#the-component-lifecycle">Lifecycle Method</a> to the <code>App</code> component:</p>
<div class="highlight"><pre><code class="language-javascript" data-lang="javascript"><span class="nx">componentWillMount</span><span class="p">()</span> <span class="p">{</span>
  <span class="k">if</span> <span class="p">(</span><span class="nb">window</span><span class="p">.</span><span class="nx">localStorage</span><span class="p">.</span><span class="nx">getItem</span><span class="p">(</span><span class="s1">&#39;authToken&#39;</span><span class="p">))</span> <span class="p">{</span>
    <span class="k">this</span><span class="p">.</span><span class="nx">setState</span><span class="p">({</span> <span class="nx">isAuthenticated</span><span class="o">:</span> <span class="kc">true</span> <span class="p">});</span>
  <span class="p">}</span>
<span class="p">}</span>
</code></pre></div>
<blockquote>
<p>What would happen at this point if an unauthorized user simply added an object to LocalStorage with a key of <code>authToken</code> and a dummy value? What would be displayed? Would they have access to any sensitive data for the server-side? Why or why not?</p>
</blockquote>

<p>Update the containers, and then run the tests again to ensure they pass:</p>
<div class="highlight"><pre><code class="language-text" data-lang="text">$ testcafe chrome e2e
Running tests in:
- Chrome 58.0.3029 / Mac OS X 10.11.6

/
should display the page correctly if a user is not logged in

/login
should display the sign in form
should allow a user to sign in

/register
should display the registration form
should allow a user to register

/status
should display the page if user is not logged in
should display user info if user is logged in


7 passed (20s)
</code></pre></div>
<blockquote>
<p>Want to run a single test or fixture to debug? Use the <a href="https://devexpress.github.io/testcafe/documentation/test-api/test-code-structure.html#skipping-tests">only</a> method.</p>
</blockquote>

<hr>

<p>Keep in mind that these tests are nowhere near being DRY. Plus, multiple tests are testing the same thing. Although this is fine on the first go around, you generally want to avoid this, especially with end-to-end tests since they are so expensive. Now is a great time to refactor! Do this on your own.</p>

<p>Commit your code once done.</p>


          <div class="page-nav">
            
              <a class="prev btn left-align" href="/part-four-e2e-test-setup">&laquo; End-to-End Test Setup</a>
            
            
              <a class="next btn right-align" href="/part-four-react-component-refactor">React Component Refactor &raquo;</a>
            
          </div>

          
  <br>
  <a class="twitter-share-button" data-show-count="false" href="https://twitter.com/intent/tweet?text=Microservices with Docker, Flask, and React - End-to-End Test Specs&amp;url=http%3A%2F%2Ftestdriven.io/part-four-e2e-test-specs&amp;via=RealPython" rel="nofollow" target="_blank" title="Share on Twitter"></a><script async src="//platform.twitter.com/widgets.js" charset="utf-8"></script>



        </div>

        <div class="hide-on-med-and-up">

          <h2>End-to-End Test Specs</h2>

          <p>With TestCafe in place, we can now write tests...</p>

<hr>

<p>What should we test?</p>

<p>Turn to your app. Navigate through it as an end user. What are some common user interactions? How about frequent error cases that you expect <em>most</em> users to encounter?</p>

<p>Turn your answers into test cases...</p>

<h4 id="test-cases">Test Cases</h4>

<p><code>/register</code>:</p>

<ol>
<li>should display the registration form</li>
<li>should allow a user to register</li>
<li>should throw an error if the username is taken</li>
<li>should throw an error if the email is taken</li>
</ol>

<p><code>/login</code>:</p>

<ol>
<li>should display the sign in form</li>
<li>should allow a user to sign in</li>
<li>should throw an error if the credentials are incorrect</li>
</ol>

<p><code>/logout</code>:</p>

<ol>
<li>should log a user out</li>
</ol>

<p><code>/status</code>:</p>

<ol>
<li>should display user info if user is logged in</li>
<li>should display the page if user is not logged in</li>
</ol>

<p><code>/</code>:</p>

<ol>
<li>should display the page correctly if a user is not logged in</li>
</ol>

<h4 id="register">Register</h4>

<p>Add a new file called <em>register.test.js</em> to the &quot;e2e&quot; directory:</p>
<div class="highlight"><pre><code class="language-javascript" data-lang="javascript"><span class="kr">import</span> <span class="p">{</span> <span class="nx">Selector</span> <span class="p">}</span> <span class="nx">from</span> <span class="s1">&#39;testcafe&#39;</span><span class="p">;</span>

<span class="kr">const</span> <span class="nx">TEST_URL</span> <span class="o">=</span> <span class="nx">process</span><span class="p">.</span><span class="nx">env</span><span class="p">.</span><span class="nx">TEST_URL</span><span class="p">;</span>


<span class="nx">fixture</span><span class="p">(</span><span class="s1">&#39;/register&#39;</span><span class="p">).</span><span class="nx">page</span><span class="p">(</span><span class="err">`</span><span class="nx">$</span><span class="p">{</span><span class="nx">TEST_URL</span><span class="p">}</span><span class="o">/</span><span class="nx">register</span><span class="err">`</span><span class="p">);</span>
</code></pre></div>
<p>Now add the following test specs:</p>

<ol>
<li><p><em>should display the registration form</em></p>
<div class="highlight"><pre><code class="language-javascript" data-lang="javascript"><span class="nx">test</span><span class="p">(</span><span class="err">`</span><span class="nx">should</span> <span class="nx">display</span> <span class="nx">the</span> <span class="nx">registration</span> <span class="nx">form</span><span class="err">`</span><span class="p">,</span> <span class="nx">async</span> <span class="p">(</span><span class="nx">t</span><span class="p">)</span> <span class="o">=&gt;</span> <span class="p">{</span>
  <span class="nx">await</span> <span class="nx">t</span>
    <span class="p">.</span><span class="nx">navigateTo</span><span class="p">(</span><span class="err">`</span><span class="nx">$</span><span class="p">{</span><span class="nx">TEST_URL</span><span class="p">}</span><span class="o">/</span><span class="nx">register</span><span class="err">`</span><span class="p">)</span>
    <span class="p">.</span><span class="nx">expect</span><span class="p">(</span><span class="nx">Selector</span><span class="p">(</span><span class="s1">&#39;H1&#39;</span><span class="p">).</span><span class="nx">withText</span><span class="p">(</span><span class="s1">&#39;Register&#39;</span><span class="p">).</span><span class="nx">exists</span><span class="p">).</span><span class="nx">ok</span><span class="p">()</span>
    <span class="p">.</span><span class="nx">expect</span><span class="p">(</span><span class="nx">Selector</span><span class="p">(</span><span class="s1">&#39;form&#39;</span><span class="p">).</span><span class="nx">exists</span><span class="p">).</span><span class="nx">ok</span><span class="p">()</span>
<span class="p">});</span>
</code></pre></div></li>
<li><p><em>should allow a user to register</em></p>
<div class="highlight"><pre><code class="language-javascript" data-lang="javascript"><span class="nx">test</span><span class="p">(</span><span class="err">`</span><span class="nx">should</span> <span class="nx">allow</span> <span class="nx">a</span> <span class="nx">user</span> <span class="nx">to</span> <span class="nx">register</span><span class="err">`</span><span class="p">,</span> <span class="nx">async</span> <span class="p">(</span><span class="nx">t</span><span class="p">)</span> <span class="o">=&gt;</span> <span class="p">{</span>

  <span class="c1">// register user</span>
  <span class="nx">await</span> <span class="nx">t</span>
    <span class="p">.</span><span class="nx">navigateTo</span><span class="p">(</span><span class="err">`</span><span class="nx">$</span><span class="p">{</span><span class="nx">TEST_URL</span><span class="p">}</span><span class="o">/</span><span class="nx">register</span><span class="err">`</span><span class="p">)</span>
    <span class="p">.</span><span class="nx">typeText</span><span class="p">(</span><span class="s1">&#39;input[name=&quot;username&quot;]&#39;</span><span class="p">,</span> <span class="nx">username</span><span class="p">)</span>
    <span class="p">.</span><span class="nx">typeText</span><span class="p">(</span><span class="s1">&#39;input[name=&quot;email&quot;]&#39;</span><span class="p">,</span> <span class="nx">email</span><span class="p">)</span>
    <span class="p">.</span><span class="nx">typeText</span><span class="p">(</span><span class="s1">&#39;input[name=&quot;password&quot;]&#39;</span><span class="p">,</span> <span class="s1">&#39;test&#39;</span><span class="p">)</span>
    <span class="p">.</span><span class="nx">click</span><span class="p">(</span><span class="nx">Selector</span><span class="p">(</span><span class="s1">&#39;input[type=&quot;submit&quot;]&#39;</span><span class="p">))</span>

  <span class="c1">// assert user is redirected to &#39;/&#39;</span>
  <span class="c1">// assert &#39;/&#39; is displayed properly</span>
  <span class="kr">const</span> <span class="nx">tableRow</span> <span class="o">=</span> <span class="nx">Selector</span><span class="p">(</span><span class="s1">&#39;td&#39;</span><span class="p">).</span><span class="nx">withText</span><span class="p">(</span><span class="nx">username</span><span class="p">).</span><span class="nx">parent</span><span class="p">();</span>
  <span class="nx">await</span> <span class="nx">t</span>
    <span class="p">.</span><span class="nx">expect</span><span class="p">(</span><span class="nx">Selector</span><span class="p">(</span><span class="s1">&#39;H1&#39;</span><span class="p">).</span><span class="nx">withText</span><span class="p">(</span><span class="s1">&#39;All Users&#39;</span><span class="p">).</span><span class="nx">exists</span><span class="p">).</span><span class="nx">ok</span><span class="p">()</span>
    <span class="p">.</span><span class="nx">expect</span><span class="p">(</span><span class="nx">tableRow</span><span class="p">.</span><span class="nx">child</span><span class="p">().</span><span class="nx">withText</span><span class="p">(</span><span class="nx">username</span><span class="p">).</span><span class="nx">exists</span><span class="p">).</span><span class="nx">ok</span><span class="p">()</span>
    <span class="p">.</span><span class="nx">expect</span><span class="p">(</span><span class="nx">tableRow</span><span class="p">.</span><span class="nx">child</span><span class="p">().</span><span class="nx">withText</span><span class="p">(</span><span class="nx">email</span><span class="p">).</span><span class="nx">exists</span><span class="p">).</span><span class="nx">ok</span><span class="p">()</span>
    <span class="p">.</span><span class="nx">expect</span><span class="p">(</span><span class="nx">Selector</span><span class="p">(</span><span class="s1">&#39;a&#39;</span><span class="p">).</span><span class="nx">withText</span><span class="p">(</span><span class="s1">&#39;User Status&#39;</span><span class="p">).</span><span class="nx">exists</span><span class="p">).</span><span class="nx">ok</span><span class="p">()</span>
    <span class="p">.</span><span class="nx">expect</span><span class="p">(</span><span class="nx">Selector</span><span class="p">(</span><span class="s1">&#39;a&#39;</span><span class="p">).</span><span class="nx">withText</span><span class="p">(</span><span class="s1">&#39;Log Out&#39;</span><span class="p">).</span><span class="nx">exists</span><span class="p">).</span><span class="nx">ok</span><span class="p">()</span>
    <span class="p">.</span><span class="nx">expect</span><span class="p">(</span><span class="nx">Selector</span><span class="p">(</span><span class="s1">&#39;a&#39;</span><span class="p">).</span><span class="nx">withText</span><span class="p">(</span><span class="s1">&#39;Register&#39;</span><span class="p">).</span><span class="nx">exists</span><span class="p">).</span><span class="nx">notOk</span><span class="p">()</span>
    <span class="p">.</span><span class="nx">expect</span><span class="p">(</span><span class="nx">Selector</span><span class="p">(</span><span class="s1">&#39;a&#39;</span><span class="p">).</span><span class="nx">withText</span><span class="p">(</span><span class="s1">&#39;Log In&#39;</span><span class="p">).</span><span class="nx">exists</span><span class="p">).</span><span class="nx">notOk</span><span class="p">()</span>

<span class="p">});</span>
</code></pre></div>
<p>Add the import and global variables at the top:</p>
<div class="highlight"><pre><code class="language-javascript" data-lang="javascript"><span class="kr">const</span> <span class="nx">randomstring</span> <span class="o">=</span> <span class="nx">require</span><span class="p">(</span><span class="s1">&#39;randomstring&#39;</span><span class="p">);</span>

<span class="kr">const</span> <span class="nx">username</span> <span class="o">=</span> <span class="nx">randomstring</span><span class="p">.</span><span class="nx">generate</span><span class="p">();</span>
<span class="kr">const</span> <span class="nx">email</span> <span class="o">=</span> <span class="err">`</span><span class="nx">$</span><span class="p">{</span><span class="nx">username</span><span class="p">}</span><span class="err">@</span><span class="nx">test</span><span class="p">.</span><span class="nx">com</span><span class="err">`</span><span class="p">;</span>
</code></pre></div>
<p>Make sure to install the dependency as well:</p>
<div class="highlight"><pre><code class="language-sh" data-lang="sh"><span class="nv">$ </span>npm install randomstring --save
</code></pre></div></li>
</ol>

<p>Since we&#39;re not handling errors yet, let&#39;s hold off on these two test cases:</p>

<ol>
<li><em>should throw an error if the username is taken</em></li>
<li><em>should throw an error if the email is taken</em></li>
</ol>

<h4 id="login">Login</h4>

<blockquote>
<p>Try writing the next few tests on your own!</p>
</blockquote>

<p>Add a new file called <em>login.test.js</em> to the &quot;e2e&quot; directory:</p>
<div class="highlight"><pre><code class="language-javascript" data-lang="javascript"><span class="kr">import</span> <span class="p">{</span> <span class="nx">Selector</span> <span class="p">}</span> <span class="nx">from</span> <span class="s1">&#39;testcafe&#39;</span><span class="p">;</span>

<span class="kr">const</span> <span class="nx">randomstring</span> <span class="o">=</span> <span class="nx">require</span><span class="p">(</span><span class="s1">&#39;randomstring&#39;</span><span class="p">);</span>

<span class="kr">const</span> <span class="nx">username</span> <span class="o">=</span> <span class="nx">randomstring</span><span class="p">.</span><span class="nx">generate</span><span class="p">();</span>
<span class="kr">const</span> <span class="nx">email</span> <span class="o">=</span> <span class="err">`</span><span class="nx">$</span><span class="p">{</span><span class="nx">username</span><span class="p">}</span><span class="err">@</span><span class="nx">test</span><span class="p">.</span><span class="nx">com</span><span class="err">`</span><span class="p">;</span>

<span class="kr">const</span> <span class="nx">TEST_URL</span> <span class="o">=</span> <span class="nx">process</span><span class="p">.</span><span class="nx">env</span><span class="p">.</span><span class="nx">TEST_URL</span><span class="p">;</span>

<span class="nx">fixture</span><span class="p">(</span><span class="s1">&#39;/login&#39;</span><span class="p">).</span><span class="nx">page</span><span class="p">(</span><span class="err">`</span><span class="nx">$</span><span class="p">{</span><span class="nx">TEST_URL</span><span class="p">}</span><span class="o">/</span><span class="nx">login</span><span class="err">`</span><span class="p">);</span>
</code></pre></div>
<p>Now add the following test specs:</p>

<ol>
<li><p><em>should display the sign in form</em></p>
<div class="highlight"><pre><code class="language-javascript" data-lang="javascript"><span class="nx">test</span><span class="p">(</span><span class="err">`</span><span class="nx">should</span> <span class="nx">display</span> <span class="nx">the</span> <span class="nx">sign</span> <span class="k">in</span> <span class="nx">form</span><span class="err">`</span><span class="p">,</span> <span class="nx">async</span> <span class="p">(</span><span class="nx">t</span><span class="p">)</span> <span class="o">=&gt;</span> <span class="p">{</span>
  <span class="nx">await</span> <span class="nx">t</span>
    <span class="p">.</span><span class="nx">navigateTo</span><span class="p">(</span><span class="err">`</span><span class="nx">$</span><span class="p">{</span><span class="nx">TEST_URL</span><span class="p">}</span><span class="o">/</span><span class="nx">login</span><span class="err">`</span><span class="p">)</span>
    <span class="p">.</span><span class="nx">expect</span><span class="p">(</span><span class="nx">Selector</span><span class="p">(</span><span class="s1">&#39;H1&#39;</span><span class="p">).</span><span class="nx">withText</span><span class="p">(</span><span class="s1">&#39;Login&#39;</span><span class="p">).</span><span class="nx">exists</span><span class="p">).</span><span class="nx">ok</span><span class="p">()</span>
    <span class="p">.</span><span class="nx">expect</span><span class="p">(</span><span class="nx">Selector</span><span class="p">(</span><span class="s1">&#39;form&#39;</span><span class="p">).</span><span class="nx">exists</span><span class="p">).</span><span class="nx">ok</span><span class="p">()</span>
<span class="p">});</span>
</code></pre></div></li>
<li><p><em>should allow a user to sign in</em></p>
<div class="highlight"><pre><code class="language-javascript" data-lang="javascript"><span class="nx">test</span><span class="p">(</span><span class="err">`</span><span class="nx">should</span> <span class="nx">allow</span> <span class="nx">a</span> <span class="nx">user</span> <span class="nx">to</span> <span class="nx">sign</span> <span class="k">in</span><span class="err">`</span><span class="p">,</span> <span class="nx">async</span> <span class="p">(</span><span class="nx">t</span><span class="p">)</span> <span class="o">=&gt;</span> <span class="p">{</span>

  <span class="c1">// register user</span>
  <span class="nx">await</span> <span class="nx">t</span>
    <span class="p">.</span><span class="nx">navigateTo</span><span class="p">(</span><span class="err">`</span><span class="nx">$</span><span class="p">{</span><span class="nx">TEST_URL</span><span class="p">}</span><span class="o">/</span><span class="nx">register</span><span class="err">`</span><span class="p">)</span>
    <span class="p">.</span><span class="nx">typeText</span><span class="p">(</span><span class="s1">&#39;input[name=&quot;username&quot;]&#39;</span><span class="p">,</span> <span class="nx">username</span><span class="p">)</span>
    <span class="p">.</span><span class="nx">typeText</span><span class="p">(</span><span class="s1">&#39;input[name=&quot;email&quot;]&#39;</span><span class="p">,</span> <span class="nx">email</span><span class="p">)</span>
    <span class="p">.</span><span class="nx">typeText</span><span class="p">(</span><span class="s1">&#39;input[name=&quot;password&quot;]&#39;</span><span class="p">,</span> <span class="s1">&#39;test&#39;</span><span class="p">)</span>
    <span class="p">.</span><span class="nx">click</span><span class="p">(</span><span class="nx">Selector</span><span class="p">(</span><span class="s1">&#39;input[type=&quot;submit&quot;]&#39;</span><span class="p">))</span>

  <span class="c1">// log a user out</span>
  <span class="nx">await</span> <span class="nx">t</span>
    <span class="p">.</span><span class="nx">click</span><span class="p">(</span><span class="nx">Selector</span><span class="p">(</span><span class="s1">&#39;a&#39;</span><span class="p">).</span><span class="nx">withText</span><span class="p">(</span><span class="s1">&#39;Log Out&#39;</span><span class="p">))</span>

  <span class="c1">// log a user in</span>
  <span class="nx">await</span> <span class="nx">t</span>
    <span class="p">.</span><span class="nx">navigateTo</span><span class="p">(</span><span class="err">`</span><span class="nx">$</span><span class="p">{</span><span class="nx">TEST_URL</span><span class="p">}</span><span class="o">/</span><span class="nx">login</span><span class="err">`</span><span class="p">)</span>
    <span class="p">.</span><span class="nx">typeText</span><span class="p">(</span><span class="s1">&#39;input[name=&quot;email&quot;]&#39;</span><span class="p">,</span> <span class="nx">email</span><span class="p">)</span>
    <span class="p">.</span><span class="nx">typeText</span><span class="p">(</span><span class="s1">&#39;input[name=&quot;password&quot;]&#39;</span><span class="p">,</span> <span class="s1">&#39;test&#39;</span><span class="p">)</span>
    <span class="p">.</span><span class="nx">click</span><span class="p">(</span><span class="nx">Selector</span><span class="p">(</span><span class="s1">&#39;input[type=&quot;submit&quot;]&#39;</span><span class="p">))</span>

  <span class="c1">// assert user is redirected to &#39;/&#39;</span>
  <span class="c1">// assert &#39;/&#39; is displayed properly</span>
  <span class="kr">const</span> <span class="nx">tableRow</span> <span class="o">=</span> <span class="nx">Selector</span><span class="p">(</span><span class="s1">&#39;td&#39;</span><span class="p">).</span><span class="nx">withText</span><span class="p">(</span><span class="nx">username</span><span class="p">).</span><span class="nx">parent</span><span class="p">();</span>
  <span class="nx">await</span> <span class="nx">t</span>
    <span class="p">.</span><span class="nx">expect</span><span class="p">(</span><span class="nx">Selector</span><span class="p">(</span><span class="s1">&#39;H1&#39;</span><span class="p">).</span><span class="nx">withText</span><span class="p">(</span><span class="s1">&#39;All Users&#39;</span><span class="p">).</span><span class="nx">exists</span><span class="p">).</span><span class="nx">ok</span><span class="p">()</span>
    <span class="p">.</span><span class="nx">expect</span><span class="p">(</span><span class="nx">tableRow</span><span class="p">.</span><span class="nx">child</span><span class="p">().</span><span class="nx">withText</span><span class="p">(</span><span class="nx">username</span><span class="p">).</span><span class="nx">exists</span><span class="p">).</span><span class="nx">ok</span><span class="p">()</span>
    <span class="p">.</span><span class="nx">expect</span><span class="p">(</span><span class="nx">tableRow</span><span class="p">.</span><span class="nx">child</span><span class="p">().</span><span class="nx">withText</span><span class="p">(</span><span class="nx">email</span><span class="p">).</span><span class="nx">exists</span><span class="p">).</span><span class="nx">ok</span><span class="p">()</span>
    <span class="p">.</span><span class="nx">expect</span><span class="p">(</span><span class="nx">Selector</span><span class="p">(</span><span class="s1">&#39;a&#39;</span><span class="p">).</span><span class="nx">withText</span><span class="p">(</span><span class="s1">&#39;User Status&#39;</span><span class="p">).</span><span class="nx">exists</span><span class="p">).</span><span class="nx">ok</span><span class="p">()</span>
    <span class="p">.</span><span class="nx">expect</span><span class="p">(</span><span class="nx">Selector</span><span class="p">(</span><span class="s1">&#39;a&#39;</span><span class="p">).</span><span class="nx">withText</span><span class="p">(</span><span class="s1">&#39;Log Out&#39;</span><span class="p">).</span><span class="nx">exists</span><span class="p">).</span><span class="nx">ok</span><span class="p">()</span>
    <span class="p">.</span><span class="nx">expect</span><span class="p">(</span><span class="nx">Selector</span><span class="p">(</span><span class="s1">&#39;a&#39;</span><span class="p">).</span><span class="nx">withText</span><span class="p">(</span><span class="s1">&#39;Register&#39;</span><span class="p">).</span><span class="nx">exists</span><span class="p">).</span><span class="nx">notOk</span><span class="p">()</span>
    <span class="p">.</span><span class="nx">expect</span><span class="p">(</span><span class="nx">Selector</span><span class="p">(</span><span class="s1">&#39;a&#39;</span><span class="p">).</span><span class="nx">withText</span><span class="p">(</span><span class="s1">&#39;Log In&#39;</span><span class="p">).</span><span class="nx">exists</span><span class="p">).</span><span class="nx">notOk</span><span class="p">()</span>

<span class="p">});</span>
</code></pre></div></li>
</ol>

<p>Again, since we&#39;re not handling errors yet, let&#39;s hold off on the following test case: <em>should throw an error if the credentials are incorrect</em>.</p>

<h4 id="logout">Logout</h4>

<p>Let&#39;s just add <em>should log a user out</em> to the previous test case in <em>login.test.js</em>:</p>
<div class="highlight"><pre><code class="language-javascript" data-lang="javascript"><span class="nx">test</span><span class="p">(</span><span class="err">`</span><span class="nx">should</span> <span class="nx">allow</span> <span class="nx">a</span> <span class="nx">user</span> <span class="nx">to</span> <span class="nx">sign</span> <span class="k">in</span><span class="err">`</span><span class="p">,</span> <span class="nx">async</span> <span class="p">(</span><span class="nx">t</span><span class="p">)</span> <span class="o">=&gt;</span> <span class="p">{</span>

  <span class="c1">// register user</span>
  <span class="nx">await</span> <span class="nx">t</span>
    <span class="p">.</span><span class="nx">navigateTo</span><span class="p">(</span><span class="err">`</span><span class="nx">$</span><span class="p">{</span><span class="nx">TEST_URL</span><span class="p">}</span><span class="o">/</span><span class="nx">register</span><span class="err">`</span><span class="p">)</span>
    <span class="p">.</span><span class="nx">typeText</span><span class="p">(</span><span class="s1">&#39;input[name=&quot;username&quot;]&#39;</span><span class="p">,</span> <span class="nx">username</span><span class="p">)</span>
    <span class="p">.</span><span class="nx">typeText</span><span class="p">(</span><span class="s1">&#39;input[name=&quot;email&quot;]&#39;</span><span class="p">,</span> <span class="nx">email</span><span class="p">)</span>
    <span class="p">.</span><span class="nx">typeText</span><span class="p">(</span><span class="s1">&#39;input[name=&quot;password&quot;]&#39;</span><span class="p">,</span> <span class="s1">&#39;test&#39;</span><span class="p">)</span>
    <span class="p">.</span><span class="nx">click</span><span class="p">(</span><span class="nx">Selector</span><span class="p">(</span><span class="s1">&#39;input[type=&quot;submit&quot;]&#39;</span><span class="p">))</span>

  <span class="c1">// log a user out</span>
  <span class="nx">await</span> <span class="nx">t</span>
    <span class="p">.</span><span class="nx">click</span><span class="p">(</span><span class="nx">Selector</span><span class="p">(</span><span class="s1">&#39;a&#39;</span><span class="p">).</span><span class="nx">withText</span><span class="p">(</span><span class="s1">&#39;Log Out&#39;</span><span class="p">))</span>

  <span class="c1">// log a user in</span>
  <span class="nx">await</span> <span class="nx">t</span>
    <span class="p">.</span><span class="nx">navigateTo</span><span class="p">(</span><span class="err">`</span><span class="nx">$</span><span class="p">{</span><span class="nx">TEST_URL</span><span class="p">}</span><span class="o">/</span><span class="nx">login</span><span class="err">`</span><span class="p">)</span>
    <span class="p">.</span><span class="nx">typeText</span><span class="p">(</span><span class="s1">&#39;input[name=&quot;email&quot;]&#39;</span><span class="p">,</span> <span class="nx">email</span><span class="p">)</span>
    <span class="p">.</span><span class="nx">typeText</span><span class="p">(</span><span class="s1">&#39;input[name=&quot;password&quot;]&#39;</span><span class="p">,</span> <span class="s1">&#39;test&#39;</span><span class="p">)</span>
    <span class="p">.</span><span class="nx">click</span><span class="p">(</span><span class="nx">Selector</span><span class="p">(</span><span class="s1">&#39;input[type=&quot;submit&quot;]&#39;</span><span class="p">))</span>

  <span class="c1">// assert user is redirected to &#39;/&#39;</span>
  <span class="c1">// assert &#39;/&#39; is displayed properly</span>
  <span class="kr">const</span> <span class="nx">tableRow</span> <span class="o">=</span> <span class="nx">Selector</span><span class="p">(</span><span class="s1">&#39;td&#39;</span><span class="p">).</span><span class="nx">withText</span><span class="p">(</span><span class="nx">username</span><span class="p">).</span><span class="nx">parent</span><span class="p">();</span>
  <span class="nx">await</span> <span class="nx">t</span>
    <span class="p">.</span><span class="nx">expect</span><span class="p">(</span><span class="nx">Selector</span><span class="p">(</span><span class="s1">&#39;H1&#39;</span><span class="p">).</span><span class="nx">withText</span><span class="p">(</span><span class="s1">&#39;All Users&#39;</span><span class="p">).</span><span class="nx">exists</span><span class="p">).</span><span class="nx">ok</span><span class="p">()</span>
    <span class="p">.</span><span class="nx">expect</span><span class="p">(</span><span class="nx">tableRow</span><span class="p">.</span><span class="nx">child</span><span class="p">().</span><span class="nx">withText</span><span class="p">(</span><span class="nx">username</span><span class="p">).</span><span class="nx">exists</span><span class="p">).</span><span class="nx">ok</span><span class="p">()</span>
    <span class="p">.</span><span class="nx">expect</span><span class="p">(</span><span class="nx">tableRow</span><span class="p">.</span><span class="nx">child</span><span class="p">().</span><span class="nx">withText</span><span class="p">(</span><span class="nx">email</span><span class="p">).</span><span class="nx">exists</span><span class="p">).</span><span class="nx">ok</span><span class="p">()</span>
    <span class="p">.</span><span class="nx">expect</span><span class="p">(</span><span class="nx">Selector</span><span class="p">(</span><span class="s1">&#39;a&#39;</span><span class="p">).</span><span class="nx">withText</span><span class="p">(</span><span class="s1">&#39;User Status&#39;</span><span class="p">).</span><span class="nx">exists</span><span class="p">).</span><span class="nx">ok</span><span class="p">()</span>
    <span class="p">.</span><span class="nx">expect</span><span class="p">(</span><span class="nx">Selector</span><span class="p">(</span><span class="s1">&#39;a&#39;</span><span class="p">).</span><span class="nx">withText</span><span class="p">(</span><span class="s1">&#39;Log Out&#39;</span><span class="p">).</span><span class="nx">exists</span><span class="p">).</span><span class="nx">ok</span><span class="p">()</span>
    <span class="p">.</span><span class="nx">expect</span><span class="p">(</span><span class="nx">Selector</span><span class="p">(</span><span class="s1">&#39;a&#39;</span><span class="p">).</span><span class="nx">withText</span><span class="p">(</span><span class="s1">&#39;Register&#39;</span><span class="p">).</span><span class="nx">exists</span><span class="p">).</span><span class="nx">notOk</span><span class="p">()</span>
    <span class="p">.</span><span class="nx">expect</span><span class="p">(</span><span class="nx">Selector</span><span class="p">(</span><span class="s1">&#39;a&#39;</span><span class="p">).</span><span class="nx">withText</span><span class="p">(</span><span class="s1">&#39;Log In&#39;</span><span class="p">).</span><span class="nx">exists</span><span class="p">).</span><span class="nx">notOk</span><span class="p">()</span>

  <span class="c1">// log a user out</span>
  <span class="nx">await</span> <span class="nx">t</span>
    <span class="p">.</span><span class="nx">click</span><span class="p">(</span><span class="nx">Selector</span><span class="p">(</span><span class="s1">&#39;a&#39;</span><span class="p">).</span><span class="nx">withText</span><span class="p">(</span><span class="s1">&#39;Log Out&#39;</span><span class="p">))</span>

  <span class="c1">// assert &#39;/logout&#39; is displayed properly</span>
  <span class="nx">await</span> <span class="nx">t</span>
    <span class="p">.</span><span class="nx">expect</span><span class="p">(</span><span class="nx">Selector</span><span class="p">(</span><span class="s1">&#39;p&#39;</span><span class="p">).</span><span class="nx">withText</span><span class="p">(</span><span class="s1">&#39;You are now logged out&#39;</span><span class="p">).</span><span class="nx">exists</span><span class="p">).</span><span class="nx">ok</span><span class="p">()</span>
    <span class="p">.</span><span class="nx">expect</span><span class="p">(</span><span class="nx">Selector</span><span class="p">(</span><span class="s1">&#39;a&#39;</span><span class="p">).</span><span class="nx">withText</span><span class="p">(</span><span class="s1">&#39;User Status&#39;</span><span class="p">).</span><span class="nx">exists</span><span class="p">).</span><span class="nx">notOk</span><span class="p">()</span>
    <span class="p">.</span><span class="nx">expect</span><span class="p">(</span><span class="nx">Selector</span><span class="p">(</span><span class="s1">&#39;a&#39;</span><span class="p">).</span><span class="nx">withText</span><span class="p">(</span><span class="s1">&#39;Log Out&#39;</span><span class="p">).</span><span class="nx">exists</span><span class="p">).</span><span class="nx">notOk</span><span class="p">()</span>
    <span class="p">.</span><span class="nx">expect</span><span class="p">(</span><span class="nx">Selector</span><span class="p">(</span><span class="s1">&#39;a&#39;</span><span class="p">).</span><span class="nx">withText</span><span class="p">(</span><span class="s1">&#39;Register&#39;</span><span class="p">).</span><span class="nx">exists</span><span class="p">).</span><span class="nx">ok</span><span class="p">()</span>
    <span class="p">.</span><span class="nx">expect</span><span class="p">(</span><span class="nx">Selector</span><span class="p">(</span><span class="s1">&#39;a&#39;</span><span class="p">).</span><span class="nx">withText</span><span class="p">(</span><span class="s1">&#39;Log In&#39;</span><span class="p">).</span><span class="nx">exists</span><span class="p">).</span><span class="nx">ok</span><span class="p">()</span>

<span class="p">});</span>
</code></pre></div>
<h4 id="status">Status</h4>

<p>Add a new file called <em>status.test.js</em> to the &quot;e2e&quot; directory:</p>
<div class="highlight"><pre><code class="language-javascript" data-lang="javascript"><span class="kr">import</span> <span class="p">{</span> <span class="nx">Selector</span> <span class="p">}</span> <span class="nx">from</span> <span class="s1">&#39;testcafe&#39;</span><span class="p">;</span>

<span class="kr">const</span> <span class="nx">randomstring</span> <span class="o">=</span> <span class="nx">require</span><span class="p">(</span><span class="s1">&#39;randomstring&#39;</span><span class="p">);</span>

<span class="kr">const</span> <span class="nx">username</span> <span class="o">=</span> <span class="nx">randomstring</span><span class="p">.</span><span class="nx">generate</span><span class="p">();</span>
<span class="kr">const</span> <span class="nx">email</span> <span class="o">=</span> <span class="err">`</span><span class="nx">$</span><span class="p">{</span><span class="nx">username</span><span class="p">}</span><span class="err">@</span><span class="nx">test</span><span class="p">.</span><span class="nx">com</span><span class="err">`</span><span class="p">;</span>
<span class="kr">const</span> <span class="nx">currentDate</span> <span class="o">=</span> <span class="k">new</span> <span class="nb">Date</span><span class="p">();</span>

<span class="kr">const</span> <span class="nx">TEST_URL</span> <span class="o">=</span> <span class="nx">process</span><span class="p">.</span><span class="nx">env</span><span class="p">.</span><span class="nx">TEST_URL</span><span class="p">;</span>

<span class="nx">fixture</span><span class="p">(</span><span class="s1">&#39;/status&#39;</span><span class="p">).</span><span class="nx">page</span><span class="p">(</span><span class="err">`</span><span class="nx">$</span><span class="p">{</span><span class="nx">TEST_URL</span><span class="p">}</span><span class="o">/</span><span class="nx">status</span><span class="err">`</span><span class="p">);</span>
</code></pre></div>
<p>Add the following test specs:</p>

<ol>
<li><p><em>should display the page if user is not logged in</em></p>
<div class="highlight"><pre><code class="language-javascript" data-lang="javascript"><span class="nx">test</span><span class="p">(</span><span class="err">`</span><span class="nx">should</span> <span class="nx">display</span> <span class="nx">the</span> <span class="nx">page</span> <span class="k">if</span> <span class="nx">user</span> <span class="nx">is</span> <span class="nx">not</span> <span class="nx">logged</span> <span class="k">in</span><span class="err">`</span><span class="p">,</span> <span class="nx">async</span> <span class="p">(</span><span class="nx">t</span><span class="p">)</span> <span class="o">=&gt;</span> <span class="p">{</span>
  <span class="nx">await</span> <span class="nx">t</span>
    <span class="p">.</span><span class="nx">navigateTo</span><span class="p">(</span><span class="err">`</span><span class="nx">$</span><span class="p">{</span><span class="nx">TEST_URL</span><span class="p">}</span><span class="o">/</span><span class="nx">status</span><span class="err">`</span><span class="p">)</span>
    <span class="p">.</span><span class="nx">expect</span><span class="p">(</span><span class="nx">Selector</span><span class="p">(</span><span class="s1">&#39;p&#39;</span><span class="p">).</span><span class="nx">withText</span><span class="p">(</span>
      <span class="s1">&#39;You must be logged in to view this.&#39;</span><span class="p">).</span><span class="nx">exists</span><span class="p">).</span><span class="nx">ok</span><span class="p">()</span>
    <span class="p">.</span><span class="nx">expect</span><span class="p">(</span><span class="nx">Selector</span><span class="p">(</span><span class="s1">&#39;a&#39;</span><span class="p">).</span><span class="nx">withText</span><span class="p">(</span><span class="s1">&#39;User Status&#39;</span><span class="p">).</span><span class="nx">exists</span><span class="p">).</span><span class="nx">notOk</span><span class="p">()</span>
    <span class="p">.</span><span class="nx">expect</span><span class="p">(</span><span class="nx">Selector</span><span class="p">(</span><span class="s1">&#39;a&#39;</span><span class="p">).</span><span class="nx">withText</span><span class="p">(</span><span class="s1">&#39;Log Out&#39;</span><span class="p">).</span><span class="nx">exists</span><span class="p">).</span><span class="nx">notOk</span><span class="p">()</span>
    <span class="p">.</span><span class="nx">expect</span><span class="p">(</span><span class="nx">Selector</span><span class="p">(</span><span class="s1">&#39;a&#39;</span><span class="p">).</span><span class="nx">withText</span><span class="p">(</span><span class="s1">&#39;Register&#39;</span><span class="p">).</span><span class="nx">exists</span><span class="p">).</span><span class="nx">ok</span><span class="p">()</span>
    <span class="p">.</span><span class="nx">expect</span><span class="p">(</span><span class="nx">Selector</span><span class="p">(</span><span class="s1">&#39;a&#39;</span><span class="p">).</span><span class="nx">withText</span><span class="p">(</span><span class="s1">&#39;Log In&#39;</span><span class="p">).</span><span class="nx">exists</span><span class="p">).</span><span class="nx">ok</span><span class="p">()</span>
<span class="p">});</span>
</code></pre></div></li>
<li><p><em>should display user info if user is logged in</em></p>
<div class="highlight"><pre><code class="language-javascript" data-lang="javascript"><span class="nx">test</span><span class="p">(</span><span class="err">`</span><span class="nx">should</span> <span class="nx">display</span> <span class="nx">user</span> <span class="nx">info</span> <span class="k">if</span> <span class="nx">user</span> <span class="nx">is</span> <span class="nx">logged</span> <span class="k">in</span><span class="err">`</span><span class="p">,</span> <span class="nx">async</span> <span class="p">(</span><span class="nx">t</span><span class="p">)</span> <span class="o">=&gt;</span> <span class="p">{</span>

  <span class="c1">// register user</span>
  <span class="nx">await</span> <span class="nx">t</span>
    <span class="p">.</span><span class="nx">navigateTo</span><span class="p">(</span><span class="err">`</span><span class="nx">$</span><span class="p">{</span><span class="nx">TEST_URL</span><span class="p">}</span><span class="o">/</span><span class="nx">register</span><span class="err">`</span><span class="p">)</span>
    <span class="p">.</span><span class="nx">typeText</span><span class="p">(</span><span class="s1">&#39;input[name=&quot;username&quot;]&#39;</span><span class="p">,</span> <span class="nx">username</span><span class="p">)</span>
    <span class="p">.</span><span class="nx">typeText</span><span class="p">(</span><span class="s1">&#39;input[name=&quot;email&quot;]&#39;</span><span class="p">,</span> <span class="nx">email</span><span class="p">)</span>
    <span class="p">.</span><span class="nx">typeText</span><span class="p">(</span><span class="s1">&#39;input[name=&quot;password&quot;]&#39;</span><span class="p">,</span> <span class="s1">&#39;test&#39;</span><span class="p">)</span>
    <span class="p">.</span><span class="nx">click</span><span class="p">(</span><span class="nx">Selector</span><span class="p">(</span><span class="s1">&#39;input[type=&quot;submit&quot;]&#39;</span><span class="p">))</span>

  <span class="c1">// assert &#39;/status&#39; is displayed properly</span>
  <span class="nx">await</span> <span class="nx">t</span>
    <span class="p">.</span><span class="nx">navigateTo</span><span class="p">(</span><span class="err">`</span><span class="nx">$</span><span class="p">{</span><span class="nx">TEST_URL</span><span class="p">}</span><span class="o">/</span><span class="nx">status</span><span class="err">`</span><span class="p">)</span>
    <span class="p">.</span><span class="nx">expect</span><span class="p">(</span><span class="nx">Selector</span><span class="p">(</span><span class="s1">&#39;li &gt; strong&#39;</span><span class="p">).</span><span class="nx">withText</span><span class="p">(</span><span class="s1">&#39;User ID:&#39;</span><span class="p">).</span><span class="nx">exists</span><span class="p">).</span><span class="nx">ok</span><span class="p">()</span>
    <span class="p">.</span><span class="nx">expect</span><span class="p">(</span><span class="nx">Selector</span><span class="p">(</span><span class="s1">&#39;li &gt; strong&#39;</span><span class="p">).</span><span class="nx">withText</span><span class="p">(</span><span class="s1">&#39;Email:&#39;</span><span class="p">).</span><span class="nx">exists</span><span class="p">).</span><span class="nx">ok</span><span class="p">()</span>
    <span class="p">.</span><span class="nx">expect</span><span class="p">(</span><span class="nx">Selector</span><span class="p">(</span><span class="s1">&#39;li&#39;</span><span class="p">).</span><span class="nx">withText</span><span class="p">(</span><span class="nx">email</span><span class="p">).</span><span class="nx">exists</span><span class="p">).</span><span class="nx">ok</span><span class="p">()</span>
    <span class="p">.</span><span class="nx">expect</span><span class="p">(</span><span class="nx">Selector</span><span class="p">(</span><span class="s1">&#39;li &gt; strong&#39;</span><span class="p">).</span><span class="nx">withText</span><span class="p">(</span><span class="s1">&#39;Username:&#39;</span><span class="p">).</span><span class="nx">exists</span><span class="p">).</span><span class="nx">ok</span><span class="p">()</span>
    <span class="p">.</span><span class="nx">expect</span><span class="p">(</span><span class="nx">Selector</span><span class="p">(</span><span class="s1">&#39;li&#39;</span><span class="p">).</span><span class="nx">withText</span><span class="p">(</span><span class="nx">username</span><span class="p">).</span><span class="nx">exists</span><span class="p">).</span><span class="nx">ok</span><span class="p">()</span>
    <span class="p">.</span><span class="nx">expect</span><span class="p">(</span><span class="nx">Selector</span><span class="p">(</span><span class="s1">&#39;a&#39;</span><span class="p">).</span><span class="nx">withText</span><span class="p">(</span><span class="s1">&#39;User Status&#39;</span><span class="p">).</span><span class="nx">exists</span><span class="p">).</span><span class="nx">ok</span><span class="p">()</span>
    <span class="p">.</span><span class="nx">expect</span><span class="p">(</span><span class="nx">Selector</span><span class="p">(</span><span class="s1">&#39;a&#39;</span><span class="p">).</span><span class="nx">withText</span><span class="p">(</span><span class="s1">&#39;Log Out&#39;</span><span class="p">).</span><span class="nx">exists</span><span class="p">).</span><span class="nx">ok</span><span class="p">()</span>
    <span class="p">.</span><span class="nx">expect</span><span class="p">(</span><span class="nx">Selector</span><span class="p">(</span><span class="s1">&#39;a&#39;</span><span class="p">).</span><span class="nx">withText</span><span class="p">(</span><span class="s1">&#39;Register&#39;</span><span class="p">).</span><span class="nx">exists</span><span class="p">).</span><span class="nx">notOk</span><span class="p">()</span>
    <span class="p">.</span><span class="nx">expect</span><span class="p">(</span><span class="nx">Selector</span><span class="p">(</span><span class="s1">&#39;a&#39;</span><span class="p">).</span><span class="nx">withText</span><span class="p">(</span><span class="s1">&#39;Log In&#39;</span><span class="p">).</span><span class="nx">exists</span><span class="p">).</span><span class="nx">notOk</span><span class="p">()</span>

<span class="p">});</span>
</code></pre></div></li>
</ol>

<h4 id="main-page">Main Page</h4>

<p>Within <em>index.test.js</em>, remove <em>users should be able to view the page</em> and, in its place, add <em>should display the page correctly if a user is not logged in</em>:</p>
<div class="highlight"><pre><code class="language-javascript" data-lang="javascript"><span class="nx">test</span><span class="p">(</span><span class="err">`</span><span class="nx">should</span> <span class="nx">display</span> <span class="nx">the</span> <span class="nx">page</span> <span class="nx">correctly</span> <span class="k">if</span> <span class="nx">a</span> <span class="nx">user</span> <span class="nx">is</span> <span class="nx">not</span> <span class="nx">logged</span> <span class="k">in</span><span class="err">`</span><span class="p">,</span> <span class="nx">async</span> <span class="p">(</span><span class="nx">t</span><span class="p">)</span> <span class="o">=&gt;</span> <span class="p">{</span>
  <span class="nx">await</span> <span class="nx">t</span>
    <span class="p">.</span><span class="nx">navigateTo</span><span class="p">(</span><span class="nx">TEST_URL</span><span class="p">)</span>
    <span class="p">.</span><span class="nx">expect</span><span class="p">(</span><span class="nx">Selector</span><span class="p">(</span><span class="s1">&#39;H1&#39;</span><span class="p">).</span><span class="nx">withText</span><span class="p">(</span><span class="s1">&#39;All Users&#39;</span><span class="p">).</span><span class="nx">exists</span><span class="p">).</span><span class="nx">ok</span><span class="p">()</span>
    <span class="p">.</span><span class="nx">expect</span><span class="p">(</span><span class="nx">Selector</span><span class="p">(</span><span class="s1">&#39;a&#39;</span><span class="p">).</span><span class="nx">withText</span><span class="p">(</span><span class="s1">&#39;User Status&#39;</span><span class="p">).</span><span class="nx">exists</span><span class="p">).</span><span class="nx">notOk</span><span class="p">()</span>
    <span class="p">.</span><span class="nx">expect</span><span class="p">(</span><span class="nx">Selector</span><span class="p">(</span><span class="s1">&#39;a&#39;</span><span class="p">).</span><span class="nx">withText</span><span class="p">(</span><span class="s1">&#39;Log Out&#39;</span><span class="p">).</span><span class="nx">exists</span><span class="p">).</span><span class="nx">notOk</span><span class="p">()</span>
    <span class="p">.</span><span class="nx">expect</span><span class="p">(</span><span class="nx">Selector</span><span class="p">(</span><span class="s1">&#39;a&#39;</span><span class="p">).</span><span class="nx">withText</span><span class="p">(</span><span class="s1">&#39;Register&#39;</span><span class="p">).</span><span class="nx">exists</span><span class="p">).</span><span class="nx">ok</span><span class="p">()</span>
    <span class="p">.</span><span class="nx">expect</span><span class="p">(</span><span class="nx">Selector</span><span class="p">(</span><span class="s1">&#39;a&#39;</span><span class="p">).</span><span class="nx">withText</span><span class="p">(</span><span class="s1">&#39;Log In&#39;</span><span class="p">).</span><span class="nx">exists</span><span class="p">).</span><span class="nx">ok</span><span class="p">()</span>
<span class="p">});</span>
</code></pre></div>
<h4 id="docker-compose">Docker Compose</h4>

<p>Before running the tests, update the build context for each service to the local environment, to pull in the latest changes locally:</p>
<div class="highlight"><pre><code class="language-yaml" data-lang="yaml"><span class="l-Scalar-Plain">version</span><span class="p-Indicator">:</span> <span class="s">&#39;2.1&#39;</span>

<span class="l-Scalar-Plain">services</span><span class="p-Indicator">:</span>
  <span class="l-Scalar-Plain">users-db</span><span class="p-Indicator">:</span>
    <span class="l-Scalar-Plain">container_name</span><span class="p-Indicator">:</span> <span class="l-Scalar-Plain">users-db</span>
    <span class="l-Scalar-Plain">build</span><span class="p-Indicator">:</span>
      <span class="l-Scalar-Plain">context</span><span class="p-Indicator">:</span> <span class="l-Scalar-Plain">../flask-microservices-users/project/db</span>
    <span class="l-Scalar-Plain">ports</span><span class="p-Indicator">:</span>
        <span class="p-Indicator">-</span> <span class="l-Scalar-Plain">5435:5432</span>  <span class="c1"># expose ports - HOST:CONTAINER</span>
    <span class="l-Scalar-Plain">environment</span><span class="p-Indicator">:</span>
      <span class="p-Indicator">-</span> <span class="l-Scalar-Plain">POSTGRES_USER=postgres</span>
      <span class="p-Indicator">-</span> <span class="l-Scalar-Plain">POSTGRES_PASSWORD=postgres</span>
    <span class="l-Scalar-Plain">healthcheck</span><span class="p-Indicator">:</span>
      <span class="l-Scalar-Plain">test</span><span class="p-Indicator">:</span> <span class="l-Scalar-Plain">exit 0</span>

  <span class="l-Scalar-Plain">users-service</span><span class="p-Indicator">:</span>
    <span class="l-Scalar-Plain">container_name</span><span class="p-Indicator">:</span> <span class="l-Scalar-Plain">users-service</span>
    <span class="l-Scalar-Plain">build</span><span class="p-Indicator">:</span>
      <span class="l-Scalar-Plain">context</span><span class="p-Indicator">:</span> <span class="l-Scalar-Plain">../flask-microservices-users</span>
    <span class="l-Scalar-Plain">ports</span><span class="p-Indicator">:</span>
      <span class="p-Indicator">-</span> <span class="l-Scalar-Plain">5001:5000</span> <span class="c1"># expose ports - HOST:CONTAINER</span>
    <span class="l-Scalar-Plain">environment</span><span class="p-Indicator">:</span>
      <span class="p-Indicator">-</span> <span class="l-Scalar-Plain">APP_SETTINGS=project.config.DevelopmentConfig</span>
      <span class="p-Indicator">-</span> <span class="l-Scalar-Plain">DATABASE_URL=postgres://postgres:postgres@users-db:5432/users_dev</span>
      <span class="p-Indicator">-</span> <span class="l-Scalar-Plain">DATABASE_TEST_URL=postgres://postgres:postgres@users-db:5432/users_test</span>
      <span class="p-Indicator">-</span> <span class="l-Scalar-Plain">SECRET_KEY=my_precious</span>
    <span class="l-Scalar-Plain">depends_on</span><span class="p-Indicator">:</span>
      <span class="l-Scalar-Plain">users-db</span><span class="p-Indicator">:</span>
        <span class="l-Scalar-Plain">condition</span><span class="p-Indicator">:</span> <span class="l-Scalar-Plain">service_healthy</span>
    <span class="l-Scalar-Plain">links</span><span class="p-Indicator">:</span>
      <span class="p-Indicator">-</span> <span class="l-Scalar-Plain">users-db</span>

  <span class="l-Scalar-Plain">nginx</span><span class="p-Indicator">:</span>
    <span class="l-Scalar-Plain">container_name</span><span class="p-Indicator">:</span> <span class="l-Scalar-Plain">nginx</span>
    <span class="l-Scalar-Plain">build</span><span class="p-Indicator">:</span> <span class="l-Scalar-Plain">./nginx/</span>
    <span class="l-Scalar-Plain">restart</span><span class="p-Indicator">:</span> <span class="l-Scalar-Plain">always</span>
    <span class="l-Scalar-Plain">ports</span><span class="p-Indicator">:</span>
      <span class="p-Indicator">-</span> <span class="l-Scalar-Plain">80:80</span>
    <span class="l-Scalar-Plain">depends_on</span><span class="p-Indicator">:</span>
      <span class="l-Scalar-Plain">users-service</span><span class="p-Indicator">:</span>
        <span class="l-Scalar-Plain">condition</span><span class="p-Indicator">:</span> <span class="l-Scalar-Plain">service_started</span>
      <span class="l-Scalar-Plain">web-service</span><span class="p-Indicator">:</span>
        <span class="l-Scalar-Plain">condition</span><span class="p-Indicator">:</span> <span class="l-Scalar-Plain">service_started</span>
    <span class="l-Scalar-Plain">links</span><span class="p-Indicator">:</span>
      <span class="p-Indicator">-</span> <span class="l-Scalar-Plain">users-service</span>
      <span class="p-Indicator">-</span> <span class="l-Scalar-Plain">web-service</span>

  <span class="l-Scalar-Plain">web-service</span><span class="p-Indicator">:</span>
    <span class="l-Scalar-Plain">container_name</span><span class="p-Indicator">:</span> <span class="l-Scalar-Plain">web-service</span>
    <span class="l-Scalar-Plain">build</span><span class="p-Indicator">:</span>
      <span class="l-Scalar-Plain">context</span><span class="p-Indicator">:</span> <span class="l-Scalar-Plain">../flask-microservices-client</span>
      <span class="l-Scalar-Plain">args</span><span class="p-Indicator">:</span>
        <span class="p-Indicator">-</span> <span class="l-Scalar-Plain">NODE_ENV=development</span>
        <span class="p-Indicator">-</span> <span class="l-Scalar-Plain">REACT_APP_USERS_SERVICE_URL=${REACT_APP_USERS_SERVICE_URL}</span>
    <span class="l-Scalar-Plain">ports</span><span class="p-Indicator">:</span>
      <span class="p-Indicator">-</span> <span class="s">&#39;9000:9000&#39;</span> <span class="c1"># expose ports - HOST:CONTAINER</span>
    <span class="l-Scalar-Plain">depends_on</span><span class="p-Indicator">:</span>
      <span class="l-Scalar-Plain">users-service</span><span class="p-Indicator">:</span>
        <span class="l-Scalar-Plain">condition</span><span class="p-Indicator">:</span> <span class="l-Scalar-Plain">service_started</span>
    <span class="l-Scalar-Plain">links</span><span class="p-Indicator">:</span>
      <span class="p-Indicator">-</span> <span class="l-Scalar-Plain">users-service</span>
</code></pre></div>
<h4 id="test">Test!</h4>

<p>Set the environment variable:</p>
<div class="highlight"><pre><code class="language-sh" data-lang="sh"><span class="nv">$ </span><span class="nb">export </span><span class="nv">REACT_APP_USERS_SERVICE_URL</span><span class="o">=</span>DOCKER_MACHINE_DEV_IP
</code></pre></div>
<p>Update the containers:</p>
<div class="highlight"><pre><code class="language-sh" data-lang="sh"><span class="nv">$ </span>docker-compose up -d
</code></pre></div>
<p>Set the <code>TEST_URL</code> variable:</p>
<div class="highlight"><pre><code class="language-sh" data-lang="sh"><span class="nv">$ </span><span class="nb">export </span><span class="nv">TEST_URL</span><span class="o">=</span>DOCKER_MACHINE_DEV_IP
</code></pre></div>
<p>Run the tests. You should see <em>should display user info if user is logged in</em> fail. Why? Well, in that test we logged a user in and then instead of clicking the link for user status, we navigated to it in the browser. Try manually testing both scenarios - clicking the <code>/status</code> link and navigating to the route in the browser. Essentially, when we navigate to the route in the browser, <code>isAuthenticated</code> is reset to its initial value of false.</p>

<p>To fix this, we can set the state of <code>isAuthenticated</code> to <code>true</code> if there is a token in LocalStorage by adding the following <a href="https://facebook.github.io/react/docs/react-component.html#the-component-lifecycle">Lifecycle Method</a> to the <code>App</code> component:</p>
<div class="highlight"><pre><code class="language-javascript" data-lang="javascript"><span class="nx">componentWillMount</span><span class="p">()</span> <span class="p">{</span>
  <span class="k">if</span> <span class="p">(</span><span class="nb">window</span><span class="p">.</span><span class="nx">localStorage</span><span class="p">.</span><span class="nx">getItem</span><span class="p">(</span><span class="s1">&#39;authToken&#39;</span><span class="p">))</span> <span class="p">{</span>
    <span class="k">this</span><span class="p">.</span><span class="nx">setState</span><span class="p">({</span> <span class="nx">isAuthenticated</span><span class="o">:</span> <span class="kc">true</span> <span class="p">});</span>
  <span class="p">}</span>
<span class="p">}</span>
</code></pre></div>
<blockquote>
<p>What would happen at this point if an unauthorized user simply added an object to LocalStorage with a key of <code>authToken</code> and a dummy value? What would be displayed? Would they have access to any sensitive data for the server-side? Why or why not?</p>
</blockquote>

<p>Update the containers, and then run the tests again to ensure they pass:</p>
<div class="highlight"><pre><code class="language-text" data-lang="text">$ testcafe chrome e2e
Running tests in:
- Chrome 58.0.3029 / Mac OS X 10.11.6

/
should display the page correctly if a user is not logged in

/login
should display the sign in form
should allow a user to sign in

/register
should display the registration form
should allow a user to register

/status
should display the page if user is not logged in
should display user info if user is logged in


7 passed (20s)
</code></pre></div>
<blockquote>
<p>Want to run a single test or fixture to debug? Use the <a href="https://devexpress.github.io/testcafe/documentation/test-api/test-code-structure.html#skipping-tests">only</a> method.</p>
</blockquote>

<hr>

<p>Keep in mind that these tests are nowhere near being DRY. Plus, multiple tests are testing the same thing. Although this is fine on the first go around, you generally want to avoid this, especially with end-to-end tests since they are so expensive. Now is a great time to refactor! Do this on your own.</p>

<p>Commit your code once done.</p>


          
  <br>
  <a class="twitter-share-button" data-show-count="false" href="https://twitter.com/intent/tweet?text=Microservices with Docker, Flask, and React - End-to-End Test Specs&amp;url=http%3A%2F%2Ftestdriven.io/part-four-e2e-test-specs&amp;via=RealPython" rel="nofollow" target="_blank" title="Share on Twitter"></a><script async src="//platform.twitter.com/widgets.js" charset="utf-8"></script>



          <div class="page-nav">
            
              <a class="prev btn left-align" href="/part-four-e2e-test-setup">&laquo; End-to-End Test Setup</a>
            
            
              <a class="next btn right-align" href="/part-four-react-component-refactor">React Component Refactor &raquo;</a>
            
          </div>

        </div>

      </div>
    </div>

     <footer class="page-footer white">
  <div class="container footer-container center-align">
    <ul>
      <li><small>Content by Michael Herman (michael@realpython.com)</small></li>
      <li><small>&copy; Copyright 2017 <a href="http://realpython.com">Real Python</a></small></li>
    </ul>
  </div>
</footer>


    <script type="text/javascript" src="//code.jquery.com/jquery-2.1.1.min.js"></script>
    <script src="//cdnjs.cloudflare.com/ajax/libs/materialize/0.100.2/js/materialize.min.js"></script>

    
  <script>
    (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
    (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
    m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
    })(window,document,'script','https://www.google-analytics.com/analytics.js','ga');

    ga('create', 'UA-100160465-1', 'auto');
    ga('send', 'pageview');

  </script>



  </body>
</html>
